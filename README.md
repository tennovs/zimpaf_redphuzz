# ZIMPAF_RedPhuzz

**ZIMPAF_RedPhuzz** is a high-fidelity grey-box fuzzing framework for PHP web applications.

## Research Context

ZIMPAF_RedPhuzz is developed as part of ongoing security research at Computer Science and Engineering Department, College of Engineering, The University of Texas at Arlington.
It combines Zend VMâ€“level instrumentation with feedback mechanism to provide deep runtime visibility and highly-targeted vulnerability detection.

---

## What is ZIMPAF?

**ZIMPAF** stands for:

> **Zend Instrumentation Module for PHP Application Fuzzing**

It is an interpreter instrumentation engine to achieve a high-fidelity web application fuzzing via
branch, error and exception, language construct and function call monitoring. See ZIMPAF's README for details.

## What is RedPhuzz?

**RedPhuzz** is a redesigned fuzzer based on:

Phuzz â€” Neef, Sebastian, Lorenz Kleissner, and Jean-Pierre Seifert.
*"What all the phuzz is about: A coverage-guided fuzzer for finding vulnerabilities in PHP web applications."*
Proceedings of the 19th ACM Asia Conference on Computer and Communications Security, 2024.

Original Phuzz repository:
https://github.com/gehaxelt/phuzz/tree/main/code/fuzzer


---

# ðŸš€ Getting Started
We suggest to run our framework directly on host computer due to

## 1. Start the Environment
Go to project root: zimpaf_redphuzz and open terminal in this folder and execute

Run:

```bash
docker compose up
```

---

## 2. Running the Fuzzer

### Batch Run â€” Multiprocessing (Recommended)

- Runs all 86 test cases.
- You can modify the number of processes created:
  - Open `redphuzz/fuzzer_redphuzz_batch_mp.py`
  - Scroll to the bottom (around line 2549)

Run:

```bash
docker exec -it zimpaf_redphuzz python3 fuzzer_redphuzz_batch_mp.py
```

---

### Batch Run â€” Single Process

- Runs most test cases (excluding heavy/large WordPress plugins).

Run:

```bash
docker exec -it zimpaf_redphuzz python3 fuzzer_redphuzz_batch_sp.py
```

---

### Single Test Case Run

- Open `redphuzz/fuzzer_redphuzz.py`
- Scroll to the bottom
- Uncomment the test case you want to fuzz

Run:

```bash
docker exec -it zimpaf_redphuzz python3 fuzzer_redphuzz.py
```

---

## Output

All detected vulnerabilities are stored on the host:

```
redphuzz/output/fuzzer[id]
```

---

## Instrumentation Logs (Inside Container)

```
/shared-tmpfs/coverage-reports
/shared-tmpfs/error-reports
/shared-tmpfs/exception-reports
/shared-tmpfs/function-call-traces
/shared-tmpfs/input_params_comparisons
/shared-tmpfs/mysql-error-reports
/shared-tmpfs/shell-error-reports
```

### Log Descriptions

- **coverage-reports** â€” Coverage data collected from Zend VM
- **error-reports** â€” Generated by `zend_error_cb` and error observer
- **exception-reports** â€” Generated by `zend_throw_hook` and `ZEND_THROW` handler
- **function-call-traces** â€” Traces of vulnerable and sanitization functions
- **input_params_comparisons** â€” Branch instructions influenced by input
- **mysql-error-reports** â€” MySQL error traces via mysqlnd and PDO
- **shell-error-reports** â€” Command injection handler traces

Although these directories contain the name `tmpfs`, they are NOT memory-backed.
The system runs on a 16GB RAM machine, and storing large logs/traces purely in memory is inefficient.
If you have larger memory, it is better to use memory. However, please consider that 1 request submission
for big wordpress plugin can produce >30MB logs.

---

## Input Directory

```
/sync-tmpfs/
```

If you want a clean fuzzing start, delete this directory first.
Otherwise, incomplete inputs may be restored automatically.

---

---

## âš¡ Performance Optimization: UFS vs. Host Execution

While this framework is fully containerized for reproducibility, the **Docker Union File System (UFS)** can introduce significant I/O latency. High-frequency file writes generated in the `/shared-tmpfs/` directory can trigger I/O bottlenecks.

**For this reason, we highly suggest running the framework on the host directly for maximum throughput.** For large targets (e.g., complex **WordPress plugins**), ZIMPAF can generate bursts exceeding **30 MB per write**. While the framework utilizes **large-scale batch writing** to minimize syscall overhead, the Docker storage driver (Overlay2) can struggle with these heavy bursts on standard hardware.

### **Optimizing I/O Throughput**
If you are **still opting for a Docker run** and experience performance degradation or high Disk Wait (I/O Wait) on a host with limited resources (e.g., **16 GB RAM / SATA SSD**), which was the evaluation environment for this framework:

1. **Volume Binding:** The default `docker-compose.yml` only maps `redphuzz/output` to the host, keeping other files isolated. To mitigate UFS overhead, you can extend volume binding to the `/shared-tmpfs/` and `/sync-tmpfs/` directories in your Compose file.
2. **Native Execution:** For maximum throughput and detection accuracy, we recommend running the framework directly on the **host machine**.
    * Ensure the host has `php-dev` headers and `build-essential` installed.
    * Compile ZIMPAF locally: `phpize && ./configure && make`.
    * This eliminates the Docker storage abstraction layer, providing direct NVMe/SSD access for the mutation engine.
3. Currently, all logs are not deleted so that you can view and analyze the log. However, to save disk storage, please consider to remove them after certain time when the logs are not useful anymore or when every input completed.

> **Note on Memory:** Although the logging directories are named `tmpfs`, they are currently mapped to physical storage to prevent **Out-Of-Memory (OOM)** errors on 16 GB systems.

### ðŸ§¹ Disk Space & Log Management
Currently, the framework retains all instrumentation logs in `/shared-tmpfs/` to allow for deep post-mortem analysis of every mutation. However, due to the high-volume nature of ZIMPAF traces (can reach 30 MB+ per burst):

* **Manual Cleanup:** Users are advised to periodically clear the `/shared-tmpfs/` subdirectories between major benchmark runs to prevent disk saturation or you can add a function to remove them from RedPhuzz. You can also clean up the output in `/redphuzz/output`
* **Planned Feature:** Future version of **the front-end fuzzer** will include this feature.

## Reporting Bugs

If you discover a bug or security issue, please open an issue on GitHub.
For responsible disclosure of security vulnerabilities, you may contact:

Tennov Simanjuntak
<tennov.simanjuntak@uta.edu>

---

## License

Copyright (c) 2026 Tennov Simanjuntak

All rights reserved.

