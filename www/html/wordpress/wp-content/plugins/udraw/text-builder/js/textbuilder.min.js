var fabric=fabric||{version:"3.2.0"},jsdom,virtualWindow,eventjs,Event;("undefined"!=typeof exports?exports.fabric=fabric:"function"==typeof define&&define.amd&&define([],function(){return fabric}),"undefined"!=typeof document&&"undefined"!=typeof window)?(fabric.document=document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),fabric.window=window):(jsdom=require("jsdom"),virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window,fabric.document=virtualWindow.document,fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=virtualWindow,DOMParser=fabric.window.DOMParser);fabric.isTouchSupported="ontouchstart"in fabric.window||"ontouchstart"in fabric.document||fabric.window&&fabric.window.navigator&&fabric.window.navigator.maxTouchPoints>0;fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window;fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)";fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.textureSize=2048;fabric.disableStyleCopyPaste=!1;fabric.enableGLFiltering=!0;fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;fabric.browserShadowBlurConstant=1;fabric.arcToSegmentsCache={};fabric.boundsOfCurveCache={};fabric.cachesBoundsOfCurve=!0;fabric.forceGLPutImageData=!1;fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0};"undefined"==typeof eventjs&&(eventjs={}),(function(n){"use strict";n.modifyEventListener=!1;n.modifySelectors=!1;n.configure=function(t){isFinite(t.modifyEventListener)&&(n.modifyEventListener=t.modifyEventListener);isFinite(t.modifySelectors)&&(n.modifySelectors=t.modifySelectors);v===!1&&n.modifyEventListener&&y();p===!1&&n.modifySelectors&&w()};n.add=function(n,t,r,u){return i(n,t,r,u,"add")};n.remove=function(n,t,r,u){return i(n,t,r,u,"remove")};n.returnFalse=function(){return!1};n.stop=function(n){n&&(n.stopPropagation&&n.stopPropagation(),n.cancelBubble=!0,n.cancelBubbleCount=0)};n.prevent=function(n){n&&(n.preventDefault?n.preventDefault():n.preventManipulation?n.preventManipulation():n.returnValue=!1)};n.cancel=function(t){n.stop(t);n.prevent(t)};n.blur=function(){var n=document.activeElement,t;n&&(t=document.activeElement.nodeName,("INPUT"===t||"TEXTAREA"===t||"true"===n.contentEditable)&&n.blur&&n.blur())};n.getEventSupport=function(n,t){if("string"==typeof n&&(t=n,n=window),t="on"+t,t in n)return!0;if(n.setAttribute||(n=document.createElement("div")),n.setAttribute&&n.removeAttribute){n.setAttribute(t,"");var i="function"==typeof n[t];return"undefined"!=typeof n[t]&&(n[t]=null),n.removeAttribute(t),i}};var r=function(n){var i,t;if(!n||"object"!=typeof n)return n;i=new n.constructor;for(t in n)i[t]=n[t]&&"object"==typeof n[t]?r(n[t]):n[t];return i},i=function(s,h,c,v,y,p){var w,ut,ht,ct,c,it,d,rt,ft,vt,et,yt,b,st,k,pt,nt,ot,g;if(v=v||{},"[object Object]"===String(s)){if(w=s,s=w.target,delete w.target,!w.type||!w.listener){for(ut in w)ht=w[ut],"function"!=typeof ht&&(v[ut]=ht);ct={};for(b in w){var ut=b.split(","),tt=w[b],lt={};for(it in v)lt[it]=v[it];if("function"==typeof tt)c=tt;else{if("function"!=typeof tt.listener)continue;c=tt.listener;for(it in tt)"function"!=typeof tt[it]&&(lt[it]=tt[it])}for(g=0;g<ut.length;g++)ct[b]=eventjs.add(s,ut[g],c,lt,y)}return ct}h=w.type;delete w.type;c=w.listener;delete w.listener;for(b in w)v[b]=w[b]}if(s&&h&&c){if("string"==typeof s&&"ready"===h){if(!window.eventjs_stallOnReady){var wt=(new Date).getTime(),bt=v.timeout,kt=v.interval||1e3/60,at=window.setInterval(function(){(new Date).getTime()-wt>bt&&window.clearInterval(at);document.querySelector(s)&&(window.clearInterval(at),setTimeout(c,1))},kt);return}h="load";s=window}if("string"==typeof s){if(s=document.querySelectorAll(s),0===s.length)return u("Missing target on listener!",arguments);1===s.length&&(s=s[0])}if(rt={},s.length>0&&s!==window){for(ft=0,vt=s.length;vt>ft;ft++)d=i(s[ft],h,c,r(v),y),d&&(rt[ft]=d);return f(rt)}if("string"==typeof h&&(h=h.toLowerCase(),-1!==h.indexOf(" ")?h=h.split(" "):-1!==h.indexOf(",")&&(h=h.split(","))),"string"!=typeof h){if("number"==typeof h.length)for(et=0,yt=h.length;yt>et;et++)d=i(s,h[et],c,r(v),y),d&&(rt[h[et]]=d);else for(b in h)d="function"==typeof h[b]?i(s,b,h[b],r(v),y):i(s,b,h[b].listener,r(h[b]),y),d&&(rt[b]=d);return f(rt)}if(0===h.indexOf("on")&&(h=h.substr(2)),"object"!=typeof s)return u("Target is not defined!",arguments);if("function"!=typeof c)return u("Listener is not a function!",arguments);if(st=v.useCapture||!1,k=o(s)+"."+o(c)+"."+(st?1:0),n.Gesture&&n.Gesture._gestureHandlers[h]){if(k=h+k,"remove"===y){if(!t[k])return;t[k].remove();delete t[k]}else if("add"===y){if(t[k])return t[k].add(),t[k];v.useCall&&!n.modifyEventListener&&(pt=c,c=function(n,t){for(var i in t)n[i]=t[i];return pt.call(s,n)});v.gesture=h;v.target=s;v.listener=c;v.fromOverwrite=p;t[k]=n.proxy[h](v)}return t[k]}for(ot=e(h),g=0;g<ot.length;g++)if(h=ot[g],nt=h+"."+k,"remove"===y){if(!t[nt])continue;s[a](h,c,st);delete t[nt]}else if("add"===y){if(t[nt])return t[nt];s[l](h,c,st);t[nt]={id:nt,type:h,target:s,listener:c,remove:function(){for(var t=0;t<ot.length;t++)n.remove(s,ot[t],c,v)}}}return t[nt]}},f=function(n){return{remove:function(){for(var t in n)n[t].remove()},add:function(){for(var t in n)n[t].add()}}},u=function(n,t){"undefined"!=typeof console&&"undefined"!=typeof console.error&&console.error(n,t)},s={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]},h={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2},e=(function(){n.supports={};window.navigator.msPointerEnabled&&(n.supports.msPointer=!0);n.getEventSupport("touchstart")&&(n.supports.touch=!0);n.getEventSupport("mousedown")&&(n.supports.mouse=!0)}(),function(){return function(t){var r=document.addEventListener?"":"on",u=h[t],i,f;if(isFinite(u)){i=[];for(f in n.supports)i.push(r+s[f][u]);return i}return[r+t]}}()),t={},c=0,o=function(n){return n===window?"#window":n===document?"#document":(n.uniqueID||(n.uniqueID="e"+c++),n.uniqueID)},l=document.addEventListener?"addEventListener":"attachEvent",a=document.removeEventListener?"removeEventListener":"detachEvent";n.createPointerEvent=function(t,i,r){var h=i.gesture,c=i.target,e=t.changedTouches||n.proxy.getCoords(t),o,u,f,s;e.length&&(o=e[0],i.pointers=r?[]:e,i.pageX=o.pageX,i.pageY=o.pageY,i.x=i.pageX,i.y=i.pageY);u=document.createEvent("Event");u.initEvent(h,!0,!0);u.originalEvent=t;for(f in i)"target"!==f&&(u[f]=i[f]);s=u.type;n.Gesture&&n.Gesture._gestureHandlers[s]&&i.oldListener.call(c,u,i,!1)};var v=!1,y=function(){if(window.HTMLElement){var t=function(t){var r=function(r){var u=r+"EventListener",f=t[u];t[u]=function(t,u,o){var s,c,h;if(n.Gesture&&n.Gesture._gestureHandlers[t])s=o,"object"==typeof o?s.useCall=!0:s={useCall:!0,useCapture:o},i(this,t,u,s,r,!0);else for(c=e(t),h=0;h<c.length;h++)f.call(this,c[h],u,o)}};r("add");r("remove")};navigator.userAgent.match(/Firefox/)?(t(HTMLDivElement.prototype),t(HTMLCanvasElement.prototype)):t(HTMLElement.prototype);t(document);t(window)}},p=!1,w=function(){var n=NodeList.prototype;n.removeEventListener=function(n,t,i){for(var r=0,u=this.length;u>r;r++)this[r].removeEventListener(n,t,i)};n.addEventListener=function(n,t,i){for(var r=0,u=this.length;u>r;r++)this[r].addEventListener(n,t,i)}};return n}(eventjs),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";var i,t;return n.pointerSetup=function(n,t){n.target=n.target||window;n.doc=n.target.ownerDocument||n.target;n.minFingers=n.minFingers||n.fingers||1;n.maxFingers=n.maxFingers||n.fingers||1/0;n.position=n.position||"relative";delete n.fingers;t=t||{};t.enabled=!0;t.gesture=n.gesture;t.target=n.target;t.env=n.env;eventjs.modifyEventListener&&n.fromOverwrite&&(n.oldListener=n.listener,n.listener=eventjs.createPointerEvent);var r=0,i=0===t.gesture.indexOf("pointer")&&eventjs.modifyEventListener?"pointer":"mouse";return n.oldListener&&(t.oldListener=n.oldListener),t.listener=n.listener,t.proxy=function(i){t.defaultListener=n.listener;n.listener=i;i(n.event,t)},t.add=function(){t.enabled!==!0&&(n.onPointerDown&&eventjs.add(n.target,i+"down",n.onPointerDown),n.onPointerMove&&eventjs.add(n.doc,i+"move",n.onPointerMove),n.onPointerUp&&eventjs.add(n.doc,i+"up",n.onPointerUp),t.enabled=!0)},t.remove=function(){t.enabled!==!1&&(n.onPointerDown&&eventjs.remove(n.target,i+"down",n.onPointerDown),n.onPointerMove&&eventjs.remove(n.doc,i+"move",n.onPointerMove),n.onPointerUp&&eventjs.remove(n.doc,i+"up",n.onPointerUp),t.reset(),t.enabled=!1)},t.pause=function(t){n.onPointerMove&&(!t||t.move)&&eventjs.remove(n.doc,i+"move",n.onPointerMove);!n.onPointerUp||t&&!t.up||eventjs.remove(n.doc,i+"up",n.onPointerUp);r=n.fingers;n.fingers=0},t.resume=function(t){n.onPointerMove&&(!t||t.move)&&eventjs.add(n.doc,i+"move",n.onPointerMove);!n.onPointerUp||t&&!t.up||eventjs.add(n.doc,i+"up",n.onPointerUp);n.fingers=r},t.reset=function(){n.tracker={};n.fingers=0},t},i=eventjs.supports,eventjs.isMouse=!!i.mouse,eventjs.isMSPointer=!!i.touch,eventjs.isTouch=!!i.msPointer,n.pointerStart=function(t,i,r){var h=(t.type||"mousedown").toUpperCase(),s,o,y,l,e,u;0===h.indexOf("MOUSE")?(eventjs.isMouse=!0,eventjs.isTouch=!1,eventjs.isMSPointer=!1):0===h.indexOf("TOUCH")?(eventjs.isMouse=!1,eventjs.isTouch=!0,eventjs.isMSPointer=!1):0===h.indexOf("MSPOINTER")&&(eventjs.isMouse=!1,eventjs.isTouch=!1,eventjs.isMSPointer=!0);s=function(n,t){var u=r.bbox,i=f[t]={},e,o;switch(r.position){case"absolute":i.offsetX=0;i.offsetY=0;break;case"differenceFromLast":i.offsetX=n.pageX;i.offsetY=n.pageY;break;case"difference":i.offsetX=n.pageX;i.offsetY=n.pageY;break;case"move":i.offsetX=n.pageX-u.x1;i.offsetY=n.pageY-u.y1;break;default:i.offsetX=u.x1-u.scrollLeft;i.offsetY=u.y1-u.scrollTop}e=n.pageX-i.offsetX;o=n.pageY-i.offsetY;i.rotation=0;i.scale=1;i.startTime=i.moveTime=(new Date).getTime();i.move={x:e,y:o};i.start={x:e,y:o};r.fingers++};r.event=t;i.defaultListener&&(r.listener=i.defaultListener,delete i.defaultListener);for(var a=!r.fingers,f=r.tracker,v=t.changedTouches||n.getCoords(t),p=v.length,c=0;p>c;c++)if(o=v[c],u=o.identifier||1/0,r.fingers){if(r.fingers>=r.maxFingers){e=[];for(u in r.tracker)e.push(u);return i.identifier=e.join(","),a}y=0;for(l in f){if(f[l].up){delete f[l];s(o,u);r.cancel=!0;break}y++}if(f[u])continue;s(o,u)}else f=r.tracker={},i.bbox=r.bbox=n.getBoundingBox(r.target),r.fingers=0,r.cancel=!1,s(o,u);e=[];for(u in r.tracker)e.push(u);return i.identifier=e.join(","),a},n.pointerEnd=function(n,t,i,r){for(var c,f,o,u,s=n.touches||[],l=s.length,h={},e=0;l>e;e++)c=s[e],u=c.identifier,h[u||1/0]=!0;for(u in i.tracker)f=i.tracker[u],h[u]||f.up||(r&&r({pageX:f.pageX,pageY:f.pageY,changedTouches:[{pageX:f.pageX,pageY:f.pageY,identifier:"Infinity"===u?1/0:u}]},"up"),f.up=!0,i.fingers--);if(0!==i.fingers)return!1;o=[];i.gestureFingers=0;for(u in i.tracker)i.gestureFingers++,o.push(u);return t.identifier=o.join(","),!0},n.getCoords=function(t){return n.getCoords="undefined"!=typeof t.pageX?function(n){return Array({type:"mouse",x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,identifier:n.pointerId||1/0})}:function(n){var t=document.documentElement;return n=n||window.event,Array({type:"mouse",x:n.clientX+t.scrollLeft,y:n.clientY+t.scrollTop,pageX:n.clientX+t.scrollLeft,pageY:n.clientY+t.scrollTop,identifier:1/0})},n.getCoords(t)},n.getCoord=function(t){if("ontouchstart"in window){var i=0,r=0;n.getCoord=function(n){var t=n.changedTouches;return t&&t.length?{x:i=t[0].pageX,y:r=t[0].pageY}:{x:i,y:r}}}else n.getCoord="undefined"!=typeof t.pageX&&"undefined"!=typeof t.pageY?function(n){return{x:n.pageX,y:n.pageY}}:function(n){var t=document.documentElement;return n=n||window.event,{x:n.clientX+t.scrollLeft,y:n.clientY+t.scrollTop}};return n.getCoord(t)},t=function(n,t){var i=parseFloat(n.getPropertyValue(t),10);return isFinite(i)?i:0},n.getBoundingBox=function(n){var i,f,h,r,u,e;if((n===window||n===document)&&(n=document.body),i={},f=n.getBoundingClientRect(),i.width=f.width,i.height=f.height,i.x1=f.left,i.y1=f.top,i.scaleX=f.width/n.offsetWidth||1,i.scaleY=f.height/n.offsetHeight||1,i.scrollLeft=0,i.scrollTop=0,u=window.getComputedStyle(n),h="border-box"===u.getPropertyValue("box-sizing"),h===!1){var o=t(u,"border-left-width"),c=t(u,"border-right-width"),l=t(u,"border-bottom-width"),s=t(u,"border-top-width");i.border=[o,c,s,l];i.x1+=o;i.y1+=s;i.width-=c+o;i.height-=l+s}for(i.x2=i.x1+i.width,i.y2=i.y1+i.height,e=u.getPropertyValue("position"),r="fixed"===e?n:n.parentNode;null!==r&&r!==document.body&&void 0!==r.scrollTop;){if(u=window.getComputedStyle(r),e=u.getPropertyValue("position"),"absolute"!==e){if("fixed"===e){i.scrollTop-=r.parentNode.scrollTop;i.scrollLeft-=r.parentNode.scrollLeft;break}i.scrollLeft+=r.scrollLeft;i.scrollTop+=r.scrollTop}r=r.parentNode}return i.scrollBodyLeft=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,i.scrollBodyTop=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,i.scrollLeft-=i.scrollBodyLeft,i.scrollTop-=i.scrollBodyTop,i},function(){var i,t=navigator.userAgent.toLowerCase(),r=-1!==t.indexOf("macintosh");i=r&&-1!==t.indexOf("khtml")?{91:!0,93:!0}:r&&-1!==t.indexOf("firefox")?{224:!0}:{17:!0};(n.metaTrackerReset=function(){eventjs.fnKey=n.fnKey=!1;eventjs.metaKey=n.metaKey=!1;eventjs.escKey=n.escKey=!1;eventjs.ctrlKey=n.ctrlKey=!1;eventjs.shiftKey=n.shiftKey=!1;eventjs.altKey=n.altKey=!1})();n.metaTracker=function(t){var r="keydown"===t.type;27===t.keyCode&&(eventjs.escKey=n.escKey=r);i[t.keyCode]&&(eventjs.metaKey=n.metaKey=r);eventjs.ctrlKey=n.ctrlKey=t.ctrlKey;eventjs.shiftKey=n.shiftKey=t.shiftKey;eventjs.altKey=n.altKey=t.altKey}}(),n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});(eventjs.MutationObserver=function(){var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,t=!n&&function(){var n=document.createElement("p"),t=!1,i=function(){t=!0};if(n.addEventListener)n.addEventListener("DOMAttrModified",i,!1);else{if(!n.attachEvent)return!1;n.attachEvent("onDOMAttrModified",i)}return n.setAttribute("id","target"),t}();return function(i,r){if(n){var u=new n(function(n){n.forEach(function(n){r.call(n.target,n.attributeName)})});u.observe(i,{subtree:!1,attributes:!0})}else t?eventjs.add(i,"DOMAttrModified",function(n){r.call(i,n.attrName)}):"onpropertychange"in document.body&&eventjs.add(i,"propertychange",function(){r.call(i,window.event.propertyName)})}}(),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";return n.click=function(t){t.gesture=t.gesture||"click";t.maxFingers=t.maxFingers||t.fingers||1;t.onPointerDown=function(r){n.pointerStart(r,i,t)&&eventjs.add(t.target,"mouseup",t.onPointerUp)};t.onPointerUp=function(r){var c,e;if(n.pointerEnd(r,i,t)){eventjs.remove(t.target,"mouseup",t.onPointerUp);var l=r.changedTouches||n.getCoords(r),o=l[0],u=t.bbox,f=n.getBoundingBox(t.target),s=o.pageY-f.scrollBodyTop,h=o.pageX-f.scrollBodyLeft;if(h>u.x1&&s>u.y1&&h<u.x2&&s<u.y2&&u.scrollTop===f.scrollTop){for(c in t.tracker)break;e=t.tracker[c];i.x=e.start.x;i.y=e.start.y;t.listener(r,i)}}};var i=n.pointerSetup(t);return i.state="click",eventjs.add(t.target,"mousedown",t.onPointerDown),i},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.click=n.click,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";return n.dbltap=n.dblclick=function(t){var r,u,e,o,f,s,i;return t.gesture=t.gesture||"dbltap",t.maxFingers=t.maxFingers||t.fingers||1,s=700,t.onPointerDown=function(h){var c=h.changedTouches||n.getCoords(h);r&&!u?(f=c[0],u=(new Date).getTime()-r):(o=c[0],r=(new Date).getTime(),u=0,clearTimeout(e),e=setTimeout(function(){r=0},s));n.pointerStart(h,i,t)&&(eventjs.add(t.target,"mousemove",t.onPointerMove).listener(h),eventjs.add(t.target,"mouseup",t.onPointerUp))},t.onPointerMove=function(i){var h;r&&!u&&(h=i.changedTouches||n.getCoords(i),f=h[0]);var s=t.bbox,c=f.pageX-s.x1,l=f.pageY-s.y1;c>0&&c<s.width&&l>0&&l<s.height&&Math.abs(f.pageX-o.pageX)<=25&&Math.abs(f.pageY-o.pageY)<=25||(eventjs.remove(t.target,"mousemove",t.onPointerMove),clearTimeout(e),r=u=0)},t.onPointerUp=function(f){var h,o;if(n.pointerEnd(f,i,t)&&(eventjs.remove(t.target,"mousemove",t.onPointerMove),eventjs.remove(t.target,"mouseup",t.onPointerUp)),r&&u){if(s>=u){i.state=t.gesture;for(h in t.tracker)break;o=t.tracker[h];i.x=o.start.x;i.y=o.start.y;t.listener(f,i)}clearTimeout(e);r=u=0}},i=n.pointerSetup(t),i.state="dblclick",eventjs.add(t.target,"mousedown",t.onPointerDown),i},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.dbltap=n.dbltap,eventjs.Gesture._gestureHandlers.dblclick=n.dblclick,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";return n.dragElement=function(t,i){n.drag({event:i,target:t,position:"move",listener:function(n,i){t.style.left=i.x+"px";t.style.top=i.y+"px";eventjs.prevent(n)}})},n.drag=function(t){t.gesture="drag";t.onPointerDown=function(r){n.pointerStart(r,i,t)&&(t.monitor||(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp)));t.onPointerMove(r,"down")};t.onPointerMove=function(r,u){if(!t.tracker)return t.onPointerDown(r);for(var s=(t.bbox,r.changedTouches||n.getCoords(r)),c=s.length,e=0;c>e;e++){var o=s[e],h=o.identifier||1/0,f=t.tracker[h];f&&(f.pageX=o.pageX,f.pageY=o.pageY,i.state=u||"move",i.identifier=h,i.start=f.start,i.fingers=t.fingers,"differenceFromLast"===t.position?(i.x=f.pageX-f.offsetX,i.y=f.pageY-f.offsetY,f.offsetX=f.pageX,f.offsetY=f.pageY):(i.x=f.pageX-f.offsetX,i.y=f.pageY-f.offsetY),t.listener(r,i))}};t.onPointerUp=function(r){n.pointerEnd(r,i,t,t.onPointerMove)&&(t.monitor||(eventjs.remove(t.doc,"mousemove",t.onPointerMove),eventjs.remove(t.doc,"mouseup",t.onPointerUp)))};var i=n.pointerSetup(t);return t.event?t.onPointerDown(t.event):(eventjs.add(t.target,"mousedown",t.onPointerDown),t.monitor&&(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp))),i},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.drag=n.drag,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";var t=Math.PI/180,i=function(n,t){var u=0,f=0,r=0,e,i;for(e in t)i=t[e],i.up||(u+=i.move.x,f+=i.move.y,r++);return n.x=u/=r,n.y=f/=r,n};return n.gesture=function(r){r.gesture=r.gesture||"gesture";r.minFingers=r.minFingers||r.fingers||2;r.onPointerDown=function(t){var o=r.fingers,f,e;if(n.pointerStart(t,u,r)&&(eventjs.add(r.doc,"mousemove",r.onPointerMove),eventjs.add(r.doc,"mouseup",r.onPointerUp)),r.fingers===r.minFingers&&o!==r.fingers){u.fingers=r.minFingers;u.scale=1;u.rotation=0;u.state="start";f="";for(e in r.tracker)f+=e;u.identifier=parseInt(f);i(u,r.tracker);r.listener(t,u)}};r.onPointerMove=function(f){for(var y,e,o,s,h,d,c,w=r.bbox,l=r.tracker,a=f.changedTouches||n.getCoords(f),g=a.length,v=0;g>v;v++){var e=a[v],y=e.identifier||1/0,p=l[y];p&&(p.move.x=e.pageX-w.x1,p.move.y=e.pageY-w.y1)}if(!(r.fingers<r.minFingers)){var a=[],b=0,k=0;i(u,l);for(y in l)if(e=l[y],!e.up){o=e.start;o.distance||(s=o.x-u.x,h=o.y-u.y,o.distance=Math.sqrt(s*s+h*h),o.angle=Math.atan2(s,h)/t);var s=e.move.x-u.x,h=e.move.y-u.y,nt=Math.sqrt(s*s+h*h);b+=nt/o.distance;d=Math.atan2(s,h)/t;c=(o.angle-d+360)%360-180;e.DEG2=e.DEG1;e.DEG1=c>0?c:-c;"undefined"!=typeof e.DEG2&&(c>0?e.rotation+=e.DEG1-e.DEG2:e.rotation-=e.DEG1-e.DEG2,k+=e.rotation);a.push(e.move)}u.touches=a;u.fingers=r.fingers;u.scale=b/r.fingers;u.rotation=k/r.fingers;u.state="change";r.listener(f,u)}};r.onPointerUp=function(t){var i=r.fingers;n.pointerEnd(t,u,r)&&(eventjs.remove(r.doc,"mousemove",r.onPointerMove),eventjs.remove(r.doc,"mouseup",r.onPointerUp));i===r.minFingers&&r.fingers<r.minFingers&&(u.fingers=r.fingers,u.state="end",r.listener(t,u))};var u=n.pointerSetup(r);return eventjs.add(r.target,"mousedown",r.onPointerDown),u},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.gesture=n.gesture,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";return n.pointerdown=n.pointermove=n.pointerup=function(t){var r,i;if(t.gesture=t.gesture||"pointer",!t.target.isPointerEmitter)return r=!0,t.onPointerDown=function(n){r=!1;i.gesture="pointerdown";t.listener(n,i)},t.onPointerMove=function(n){i.gesture="pointermove";t.listener(n,i,r)},t.onPointerUp=function(n){r=!0;i.gesture="pointerup";t.listener(n,i,!0)},i=n.pointerSetup(t),eventjs.add(t.target,"mousedown",t.onPointerDown),eventjs.add(t.target,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp),t.target.isPointerEmitter=!0,i},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.pointerdown=n.pointerdown,eventjs.Gesture._gestureHandlers.pointermove=n.pointermove,eventjs.Gesture._gestureHandlers.pointerup=n.pointerup,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";return n.shake=function(n){var i={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:n.target,listener:n.listener,remove:function(){window.removeEventListener("devicemotion",u,!1)}},f=4,e=1e3,o=200,s=3,r=(new Date).getTime(),t={x:0,y:0,z:0},h={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},u=function(u){var l=.8,a=u.accelerationIncludingGravity,v,g;if(t.x=l*t.x+(1-l)*a.x,t.y=l*t.y+(1-l)*a.y,t.z=l*t.z+(1-l)*a.z,i.accelerationIncludingGravity=t,i.acceleration.x=a.x-t.x,i.acceleration.y=a.y-t.y,i.acceleration.z=a.z-t.z,"devicemotion"===n.gesture)return void n.listener(u,i);for(var w="xyz",y=(new Date).getTime(),p=0,nt=w.length;nt>p;p++){var b=w[p],k=i.acceleration[b],c=h[b],d=Math.abs(k);!(e>y-r)&&d>f&&(v=y*k/d,g=Math.abs(v+c.value),c.value&&o>g?(c.value=v,c.count++,c.count===s&&(n.listener(u,i),r=y,c.value=0,c.count=0)):(c.value=v,c.count=1))}};if(window.addEventListener)return(window.addEventListener("devicemotion",u,!1),i)},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.shake=n.shake,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";var t=Math.PI/180;return n.swipe=function(i){i.snap=i.snap||90;i.threshold=i.threshold||1;i.gesture=i.gesture||"swipe";i.onPointerDown=function(t){n.pointerStart(t,r,i)&&(eventjs.add(i.doc,"mousemove",i.onPointerMove).listener(t),eventjs.add(i.doc,"mouseup",i.onPointerUp))};i.onPointerMove=function(t){for(var e=t.changedTouches||n.getCoords(t),o=e.length,u=0;o>u;u++){var f=e[u],s=f.identifier||1/0,r=i.tracker[s];r&&(r.move.x=f.pageX,r.move.y=f.pageY,r.moveTime=(new Date).getTime())}};i.onPointerUp=function(u){var b,c;if(n.pointerEnd(u,r,i)){eventjs.remove(i.doc,"mousemove",i.onPointerMove);eventjs.remove(i.doc,"mouseup",i.onPointerUp);var o,y,e,l,s={x:0,y:0},p=0,w=0,h=0;for(b in i.tracker){var f=i.tracker[b],a=f.move.x-f.start.x,v=f.move.y-f.start.y;p+=f.move.x;w+=f.move.y;s.x+=f.start.x;s.y+=f.start.y;h++;var d=Math.sqrt(a*a+v*v),k=f.moveTime-f.startTime,l=Math.atan2(a,v)/t+180,y=k?d/k:0;if("undefined"==typeof e)e=l,o=y;else{if(!(Math.abs(l-e)<=20))return;e=(e+l)/2;o=(o+y)/2}}c=i.gestureFingers;i.minFingers<=c&&i.maxFingers>=c&&o>i.threshold&&(s.x/=h,s.y/=h,r.start=s,r.x=p/h,r.y=w/h,r.angle=-(((e/i.snap+.5>>0)*i.snap||360)-360),r.velocity=o,r.fingers=c,r.state="swipe",i.listener(u,r))}};var r=n.pointerSetup(i);return eventjs.add(i.target,"mousedown",i.onPointerDown),r},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.swipe=n.swipe,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";return n.longpress=function(t){return t.gesture="longpress",n.tap(t)},n.tap=function(t){var r,u,i;return t.delay=t.delay||500,t.timeout=t.timeout||250,t.driftDeviance=t.driftDeviance||10,t.gesture=t.gesture||"tap",t.onPointerDown=function(f){if(n.pointerStart(f,i,t)){if(r=(new Date).getTime(),eventjs.add(t.doc,"mousemove",t.onPointerMove).listener(f),eventjs.add(t.doc,"mouseup",t.onPointerUp),"longpress"!==t.gesture)return;u=setTimeout(function(){var n,u,r;if(!(f.cancelBubble&&++f.cancelBubbleCount>1)){n=0;for(u in t.tracker){if(r=t.tracker[u],r.end===!0)return;if(t.cancel)return;n++}t.minFingers<=n&&t.maxFingers>=n&&(i.state="start",i.fingers=n,i.x=r.start.x,i.y=r.start.y,t.listener(f,i))}},t.delay)}},t.onPointerMove=function(i){for(var r=t.bbox,h=i.changedTouches||n.getCoords(i),a=h.length,u=0;a>u;u++){var f=h[u],v=f.identifier||1/0,e=t.tracker[v];if(e){var o=f.pageX-r.x1,s=f.pageY-r.y1,c=o-e.start.x,l=s-e.start.y,y=Math.sqrt(c*c+l*l);if(!(o>0&&o<r.width&&s>0&&s<r.height&&y<=t.driftDeviance))return eventjs.remove(t.doc,"mousemove",t.onPointerMove),void(t.cancel=!0)}}},t.onPointerUp=function(f){if(n.pointerEnd(f,i,t)){if(clearTimeout(u),eventjs.remove(t.doc,"mousemove",t.onPointerMove),eventjs.remove(t.doc,"mouseup",t.onPointerUp),f.cancelBubble&&++f.cancelBubbleCount>1)return;if("longpress"===t.gesture)return void("start"===i.state&&(i.state="end",t.listener(f,i)));if(t.cancel)return;if((new Date).getTime()-r>t.timeout)return;var e=t.gestureFingers;t.minFingers<=e&&t.maxFingers>=e&&(i.state="tap",i.fingers=t.gestureFingers,t.listener(f,i))}},i=n.pointerSetup(t),eventjs.add(t.target,"mousedown",t.onPointerDown),i},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.tap=n.tap,eventjs.Gesture._gestureHandlers.longpress=n.longpress,n}(eventjs.proxy),"undefined"==typeof eventjs)&&(eventjs={});("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";return n.wheelPreventElasticBounce=function(n){n&&("string"==typeof n&&(n=document.querySelector(n)),eventjs.add(n,"wheel",function(n,t){t.preventElasticBounce();eventjs.stop(n)}))},n.wheel=function(n){var u,o=n.timeout||150,f=0,t={gesture:"wheel",state:"start",wheelDelta:0,target:n.target,listener:n.listener,preventElasticBounce:function(n){var t=this.target,i=t.scrollTop,r=i+t.offsetHeight,u=t.scrollHeight;r===u&&this.wheelDelta<=0?eventjs.cancel(n):0===i&&this.wheelDelta>=0&&eventjs.cancel(n);eventjs.stop(n)},add:function(){n.target[e](r,i,!1)},remove:function(){n.target[s](r,i,!1)}},i=function(i){i=i||window.event;t.state=f++?"change":"start";t.wheelDelta=i.detail?-20*i.detail:i.wheelDelta;n.listener(i,t);clearTimeout(u);u=setTimeout(function(){f=0;t.state="end";t.wheelDelta=0;n.listener(i,t)},o)},e=document.addEventListener?"addEventListener":"attachEvent",s=document.removeEventListener?"removeEventListener":"detachEvent",r=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";return n.target[e](r,i,!1),t},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.wheel=n.wheel,n}(eventjs.proxy),"undefined"==typeof Event)&&(Event={});"undefined"==typeof Event.proxy&&(Event.proxy={});Event.proxy=function(n){"use strict";return n.orientation=function(n){var t={gesture:"orientationchange",previous:null,current:window.orientation,target:n.target,listener:n.listener,remove:function(){window.removeEventListener("orientationchange",i,!1)}},i=function(i){return t.previous=t.current,t.current=window.orientation,null!==t.previous&&t.previous!=t.current?void n.listener(i,t):void 0};return window.DeviceOrientationEvent&&window.addEventListener("orientationchange",i,!1),t},Event.Gesture=Event.Gesture||{},Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{},Event.Gesture._gestureHandlers.orientation=n.orientation,n}(Event.proxy);!function(){function n(n,t){if(this.__eventListeners[n]){var i=this.__eventListeners[n];t?i[i.indexOf(t)]=!1:fabric.util.array.fill(i,!1)}}function t(n,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in n)this.on(i,n[i]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t);return this}function i(t,i){if(!this.__eventListeners)return this;if(0===arguments.length)for(t in this.__eventListeners)n.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var r in t)n.call(this,r,t[r]);else n.call(this,t,i);return this}function r(n,t){var i,r,u;if(!this.__eventListeners||(i=this.__eventListeners[n],!i))return this;for(r=0,u=i.length;u>r;r++)i[r]&&i[r].call(this,t||{});return this.__eventListeners[n]=i.filter(function(n){return n!==!1}),this}fabric.Observable={observe:t,stopObserving:i,fire:r,on:t,off:i,trigger:r}}();fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var n=0,t=arguments.length;t>n;n++)this._onObjectAdded(arguments[n]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(n,t,i){var r=this._objects;return i?r[t]=n:r.splice(t,0,n),this._onObjectAdded&&this._onObjectAdded(n),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t,i=this._objects,r=!1,n=0,u=arguments.length;u>n;n++)t=i.indexOf(arguments[n]),-1!==t&&(r=!0,i.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&r&&this.requestRenderAll(),this},forEachObject:function(n,t){for(var r=this.getObjects(),i=0,u=r.length;u>i;i++)n.call(t,r[i],i,r);return this},getObjects:function(n){return"undefined"==typeof n?this._objects.concat():this._objects.filter(function(t){return t.type===n})},item:function(n){return this._objects[n]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(n){return this._objects.indexOf(n)>-1},complexity:function(){return this._objects.reduce(function(n,t){return n+(t.complexity?t.complexity():0)},0)}};fabric.CommonMethods={_setOptions:function(n){for(var t in n)this.set(t,n[t])},_initGradient:function(n,t){!n||!n.colorStops||n instanceof fabric.Gradient||this.set(t,new fabric.Gradient(n))},_initPattern:function(n,t,i){!n||!n.source||n instanceof fabric.Pattern?i&&i():this.set(t,new fabric.Pattern(n,i))},_initClipping:function(n){if(n.clipTo&&"string"==typeof n.clipTo){var t=fabric.util.getFunctionBody(n.clipTo);"undefined"!=typeof t&&(this.clipTo=new Function("ctx",t))}},_setObject:function(n){for(var t in n)this._set(t,n[t])},set:function(n,t){return"object"==typeof n?this._setObject(n):"function"==typeof t&&"clipTo"!==n?this._set(n,t(this.get(n))):this._set(n,t),this},_set:function(n,t){this[n]=t},toggle:function(n){var t=this.get(n);return"boolean"==typeof t&&this.set(n,!t),this},get:function(n){return this[n]}};!function(n){var u=Math.sqrt,i=Math.atan2,f=Math.pow,r=Math.abs,t=Math.PI/180,e=Math.PI/2;fabric.util={cos:function(n){if(0===n)return 1;0>n&&(n=-n);var t=n/e;switch(t){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},sin:function(n){if(0===n)return 0;var i=n/e,t=1;switch(0>n&&(t=-1),i){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(n)},removeFromArray:function(n,t){var i=n.indexOf(t);return-1!==i&&n.splice(i,1),n},getRandomInt:function(n,t){return Math.floor(Math.random()*(t-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,t,i){n.subtractEquals(t);var r=fabric.util.rotateVector(n,i);return new fabric.Point(r.x,r.y).addEquals(t)},rotateVector:function(n,t){var i=fabric.util.sin(t),r=fabric.util.cos(t),u=n.x*r-n.y*i,f=n.x*i+n.y*r;return{x:u,y:f}},transformPoint:function(n,t,i){return i?new fabric.Point(t[0]*n.x+t[2]*n.y,t[1]*n.x+t[3]*n.y):new fabric.Point(t[0]*n.x+t[2]*n.y+t[4],t[1]*n.x+t[3]*n.y+t[5])},makeBoundingBoxFromPoints:function(n){var t=[n[0].x,n[1].x,n[2].x,n[3].x],i=fabric.util.array.min(t),f=fabric.util.array.max(t),e=f-i,r=[n[0].y,n[1].y,n[2].y,n[3].y],u=fabric.util.array.min(r),o=fabric.util.array.max(r),s=o-u;return{left:i,top:u,width:e,height:s}},invertTransform:function(n){var t=1/(n[0]*n[3]-n[1]*n[2]),i=[t*n[3],-t*n[1],-t*n[2],t*n[0]],r=fabric.util.transformPoint({x:n[4],y:n[5]},i,!0);return i[4]=-r.x,i[5]=-r.y,i},toFixed:function(n,t){return parseFloat(Number(n).toFixed(t))},parseUnit:function(n,t){var r=/\D{0,2}$/.exec(n),i=parseFloat(n);switch(t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE),r[0]){case"mm":return i*fabric.DPI/25.4;case"cm":return i*fabric.DPI/2.54;case"in":return i*fabric.DPI;case"pt":return i*fabric.DPI/72;case"pc":return i*fabric.DPI/6;case"em":return i*t;default:return i}},falseFunction:function(){return!1},getKlass:function(n,t){return n=fabric.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),fabric.util.resolveNamespace(t)[n]},getSvgAttributes:function(n){var t=["instantiated_by_use","style","id","class"];switch(n){case"linearGradient":t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":t=t.concat(["offset","stop-color","stop-opacity"])}return t},resolveNamespace:function(t){if(!t)return fabric;for(var u=t.split("."),f=u.length,r=n||fabric.window,i=0;f>i;++i)r=r[u[i]];return r},loadImage:function(n,t,i,r){if(!n)return void(t&&t.call(i,n));var u=fabric.util.createImage(),f=function(){t&&t.call(i,u);u=u.onload=u.onerror=null};u.onload=f;u.onerror=function(){fabric.log("Error loading "+u.src);t&&t.call(i,null,!0);u=u.onload=u.onerror=null};0!==n.indexOf("data")&&r&&(u.crossOrigin=r);"data:image/svg"===n.substring(0,14)&&(u.onload=null,fabric.util.loadImageInDom(u,f));u.src=n},loadImageInDom:function(n,t){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px";i.style.left=i.style.top="-100%";i.style.position="absolute";i.appendChild(n);fabric.document.querySelector("body").appendChild(i);n.onload=function(){t();i.parentNode.removeChild(i);i=null}},enlivenObjects:function(n,t,i,r){function f(){++o===e&&t&&t(u.filter(function(n){return n}))}n=n||[];var u=[],o=0,e=n.length;return e?void n.forEach(function(n,t){if(!n||!n.type)return void f();var e=fabric.util.getKlass(n.type,i);e.fromObject(n,function(i,e){e||(u[t]=i);r&&r(n,i,e);f()})}):void(t&&t(u))},enlivenPatterns:function(n,t){function r(){++f===u&&t&&t(i)}n=n||[];var i=[],f=0,u=n.length;return u?void n.forEach(function(n,t){n&&n.source?new fabric.Pattern(n,function(n){i[t]=n;r()}):(i[t]=n,r())}):void(t&&t(i))},groupSVGElements:function(n,t,i){var r;return n&&1===n.length?n[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),r=new fabric.Group(n,t),"undefined"!=typeof i&&(r.sourcePath=i),r)},populateWithProperties:function(n,t,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var r=0,u=i.length;u>r;r++)i[r]in n&&(t[i[r]]=n[i[r]])},drawDashedLine:function(n,t,r,f,e,o){var s=f-t,h=e-r,c=u(s*s+h*h),a=i(h,s),v=o.length,y=0,l=!0;for(n.save(),n.translate(t,r),n.moveTo(0,0),n.rotate(a),t=0;c>t;)t+=o[y++%v],t>c&&(t=c),n[l?"lineTo":"moveTo"](t,0),l=!l;n.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(n){var t=fabric.util.createCanvasElement();return t.width=n.width,t.height=n.height,t.getContext("2d").drawImage(n,0,0),t},toDataURL:function(n,t,i){return n.toDataURL("image/"+t,i)},createImage:function(){return fabric.document.createElement("img")},clipContext:function(n,t){t.save();t.beginPath();n.clipTo(t);t.clip()},multiplyTransformMatrices:function(n,t,i){return[n[0]*t[0]+n[2]*t[1],n[1]*t[0]+n[3]*t[1],n[0]*t[2]+n[2]*t[3],n[1]*t[2]+n[3]*t[3],i?0:n[0]*t[4]+n[2]*t[5]+n[4],i?0:n[1]*t[4]+n[3]*t[5]+n[5]]},qrDecompose:function(n){var o=i(n[1],n[0]),r=f(n[0],2)+f(n[1],2),e=u(r),s=(n[0]*n[3]-n[2]*n[1])/e,h=i(n[0]*n[2]+n[1]*n[3],r);return{angle:o/t,scaleX:e,scaleY:s,skewX:h/t,skewY:0,translateX:n[4],translateY:n[5]}},customTransformMatrix:function(n,i,u){var f=[1,0,r(Math.tan(u*t)),1],e=[r(n),0,0,r(i)];return fabric.util.multiplyTransformMatrices(e,f,!0)},resetObjectTransform:function(n){n.scaleX=1;n.scaleY=1;n.skewX=0;n.skewY=0;n.flipX=!1;n.flipY=!1;n.rotate(0)},saveObjectTransform:function(n){return{scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(n,t,i,r){r>0&&(t>r?t-=r:t=0,i>r?i-=r:i=0);for(var o,f=!0,e=n.getImageData(t,i,2*r||1,2*r||1),s=e.data.length,u=3;s>u&&(o=e.data[u],f=0>=o,f!==!1);u+=4);return e=null,f},parsePreserveAspectRatioAttribute:function(n){var t,i="meet",u="Mid",f="Mid",r=n.split(" ");return r&&r.length&&(i=r.pop(),"meet"!==i&&"slice"!==i?(t=i,i="meet"):r.length&&(t=r.pop())),u="none"!==t?t.slice(1,4):"none",f="none"!==t?t.slice(5,8):"none",{meetOrSlice:i,alignX:u,alignY:f}},clearFabricFontCache:function(n){n=(n||"").toLowerCase();n?fabric.charWidthsCache[n]&&delete fabric.charWidthsCache[n]:fabric.charWidthsCache={}},limitDimsByArea:function(n,t){var i=Math.sqrt(t*n),r=Math.floor(t/i);return{x:Math.floor(i),y:r}},capValue:function(n,t,i){return Math.max(n,Math.min(t,i))},findScaleToFit:function(n,t){return Math.min(t.width/n.width,t.height/n.height)},findScaleToCover:function(n,t){return Math.max(t.width/n.width,t.height/n.height)},matrixToSVG:function(n){return"matrix("+n.map(function(n){return fabric.util.toFixed(n,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}}("undefined"!=typeof exports?exports:this);!function(){function n(n,i,f,e,o,s,h){var it=r.call(arguments),ft;if(fabric.arcToSegmentsCache[it])return fabric.arcToSegmentsCache[it];var g=Math.PI,st=h*g/180,v=fabric.util.sin(st),y=fabric.util.cos(st),ht=0,ct=0;f=Math.abs(f);e=Math.abs(e);var c=-y*n*.5-v*i*.5,l=-y*i*.5+v*n*.5,nt=f*f,tt=e*e,lt=l*l,at=c*c,rt=nt*tt-nt*lt-tt*at,ut=0;0>rt?(ft=Math.sqrt(1-rt/(nt*tt)),f*=ft,e*=ft):ut=(o===s?-1:1)*Math.sqrt(rt/(nt*lt+tt*at));var p=ut*f*l/e,w=-ut*e*c/f,yt=y*p-v*w+.5*n,pt=v*p+y*w+.5*i,et=t(1,0,(c-p)/f,(l-w)/e),a=t((c-p)/f,(l-w)/e,(-c-p)/f,(-l-w)/e);0===s&&a>0?a-=2*g:1===s&&0>a&&(a+=2*g);for(var vt=Math.ceil(Math.abs(a/g*2)),b=[],k=a/vt,wt=8/3*Math.sin(k/4)*Math.sin(k/4)/Math.sin(k/2),ot=et+k,d=0;vt>d;d++)b[d]=u(et,ot,y,v,f,e,yt,pt,wt,ht,ct),ht=b[d][4],ct=b[d][5],et=ot,ot+=k;return fabric.arcToSegmentsCache[it]=b,b}function u(n,t,i,r,u,f,e,o,s,h,c){var v=fabric.util.cos(n),y=fabric.util.sin(n),l=fabric.util.cos(t),a=fabric.util.sin(t),p=i*u*l-r*f*a+e,w=r*u*l+i*f*a+o,b=h+s*(-i*u*y-r*f*v),k=c+s*(-r*u*y+i*f*v),d=p+s*(i*u*a+r*f*l),g=w+s*(r*u*a-i*f*l);return[b,k,d,g,p,w]}function t(n,t,i,r){var u=Math.atan2(t,n),f=Math.atan2(r,i);return f>=u?f-u:2*Math.PI-(u-f)}function i(n,t,i,u,f,e,o,s){var b,nt,ot,st,c,y,w,rt;if(fabric.cachesBoundsOfCurve&&(b=r.call(arguments),fabric.boundsOfCurveCache[b]))return fabric.boundsOfCurveCache[b];var v,a,k,h,d,g,tt,it,ht=Math.sqrt,ut=Math.min,ft=Math.max,et=Math.abs,p=[],l=[[],[]];for(a=6*n-12*i+6*f,v=-3*n+9*i-9*f+3*o,k=3*i-3*n,nt=0;2>nt;++nt)if(nt>0&&(a=6*t-12*u+6*e,v=-3*t+9*u-9*e+3*s,k=3*u-3*t),et(v)<1e-12){if(et(a)<1e-12)continue;h=-k/a;h>0&&1>h&&p.push(h)}else tt=a*a-4*k*v,0>tt||(it=ht(tt),d=(-a+it)/(2*v),d>0&&1>d&&p.push(d),g=(-a-it)/(2*v),g>0&&1>g&&p.push(g));for(y=p.length,w=y;y--;)h=p[y],c=1-h,ot=c*c*c*n+3*c*c*h*i+3*c*h*h*f+h*h*h*o,l[0][y]=ot,st=c*c*c*t+3*c*c*h*u+3*c*h*h*e+h*h*h*s,l[1][y]=st;return l[0][w]=n,l[1][w]=t,l[0][w+1]=o,l[1][w+1]=s,rt=[{x:ut.apply(null,l[0]),y:ut.apply(null,l[1])},{x:ft.apply(null,l[0]),y:ft.apply(null,l[1])}],fabric.cachesBoundsOfCurve&&(fabric.boundsOfCurveCache[b]=rt),rt}var r=Array.prototype.join;fabric.util.drawArc=function(t,i,r,u){for(var s=u[0],h=u[1],c=u[2],l=u[3],a=u[4],v=u[5],y=u[6],e=[[],[],[],[]],o=n(v-i,y-r,s,h,l,a,c),f=0,p=o.length;p>f;f++)e[f][0]=o[f][0]+i,e[f][1]=o[f][1]+r,e[f][2]=o[f][2]+i,e[f][3]=o[f][3]+r,e[f][4]=o[f][4]+i,e[f][5]=o[f][5]+r,t.bezierCurveTo.apply(t,e[f])};fabric.util.getBoundsOfArc=function(t,r,u,f,e,o,s,h,c){for(var v,p=0,w=0,y=[],a=n(h-t,c-r,u,f,o,s,e),l=0,b=a.length;b>l;l++)v=i(p,w,a[l][0],a[l][1],a[l][2],a[l][3],a[l][4],a[l][5]),y.push({x:v[0].x+t,y:v[0].y+r}),y.push({x:v[1].x+t,y:v[1].y+r}),p=a[l][4],w=a[l][5];return y};fabric.util.getBoundsOfCurve=i}();!function(){function t(n,t){for(var r=f.call(arguments,2),u=[],i=0,e=n.length;e>i;i++)u[i]=r.length?n[i][t].apply(n[i],r):n[i][t].call(n[i]);return u}function i(t,i){return n(t,i,function(n,t){return n>=t})}function r(t,i){return n(t,i,function(n,t){return t>n})}function u(n,t){for(var i=n.length;i--;)n[i]=t;return n}function n(n,t,i){if(n&&0!==n.length){var r=n.length-1,u=t?n[r][t]:n[r];if(t)for(;r--;)i(n[r][t],u)&&(u=n[r][t]);else for(;r--;)i(n[r],u)&&(u=n[r]);return u}}var f=Array.prototype.slice;fabric.util.array={fill:u,invoke:t,min:r,max:i}}();!function(){function n(t,i,r){var f,e,u;if(r)if(!fabric.isLikelyNode&&i instanceof Element)t=i;else if(i instanceof Array)for(t=[],f=0,e=i.length;e>f;f++)t[f]=n({},i[f],r);else if(i&&"object"==typeof i)for(u in i)"canvas"===u?t[u]=n({},i[u]):i.hasOwnProperty(u)&&(t[u]=n({},i[u],r));else t=i;else for(u in i)t[u]=i[u];return t}function t(t,i){return n({},t,i)}fabric.util.object={extend:n,clone:t};fabric.util.object.extend(fabric.util,fabric.Observable)}();!function(){function n(n){return n.replace(/-+(.)?/g,function(n,t){return t?t.toUpperCase():""})}function t(n,t){return n.charAt(0).toUpperCase()+(t?n.slice(1):n.slice(1).toLowerCase())}function i(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(n){var i,t=0,r=[];for(t=0,i;t<n.length;t++)(i=u(n,t))!==!1&&r.push(i);return r}function u(n,t){var i=n.charCodeAt(t),r,u;if(isNaN(i))return"";if(55296>i||i>57343)return n.charAt(t);if(i>=55296&&56319>=i){if(n.length<=t+1)throw"High surrogate without following low surrogate";if(r=n.charCodeAt(t+1),56320>r||r>57343)throw"High surrogate without following low surrogate";return n.charAt(t)+n.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";if(u=n.charCodeAt(t-1),55296>u||u>56319)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:n,capitalize:t,escapeXml:i,graphemeSplit:r}}();!function(){function n(){}function i(n){for(var u,r=null,i=this;i.constructor.superclass;){if(u=i.constructor.superclass.prototype[n],i[n]!==u){r=u;break}i=i.constructor.superclass.prototype}return r?arguments.length>1?r.apply(this,t.call(arguments,1)):r.call(this):console.log("tried to callSuper "+n+", method not found in prototype chain",this)}function r(){function r(){this.initialize.apply(this,arguments)}var f=null,o=t.call(arguments,0),s,h;for("function"==typeof o[0]&&(f=o.shift()),r.superclass=f,r.subclasses=[],f&&(n.prototype=f.prototype,r.prototype=new n,f.subclasses.push(r)),s=0,h=o.length;h>s;s++)e(r,o[s],f);return r.prototype.initialize||(r.prototype.initialize=u),r.prototype.constructor=r,r.prototype.callSuper=i,r}var t=Array.prototype.slice,u=function(){},f=function(){for(var n in{toString:1})if("toString"===n)return!1;return!0}(),e=function(n,t,i){for(var r in t)n.prototype[r]=r in n.prototype&&"function"==typeof n.prototype[r]&&(t[r]+"").indexOf("callSuper")>-1?function(n){return function(){var u=this.constructor.superclass,r;return this.constructor.superclass=i,r=t[n].apply(this,arguments),this.constructor.superclass=u,"initialize"!==n?r:void 0}}(r):t[r],f&&(t.toString!==Object.prototype.toString&&(n.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(n.prototype.valueOf=t.valueOf))};fabric.util.createClass=r}();!function(){function i(n){for(var i,r=Array.prototype.slice.call(arguments,1),u=r.length,t=0;u>t;t++)if(i=typeof n[r[t]],!/^(?:function|object|unknown)$/.test(i))return!1;return!0}function a(n,t){return{handler:t,wrappedHandler:v(n,t)}}function v(n,t){return function(i){t.call(c(n),i||fabric.window.event)}}function y(t,i){return function(r){if(n[t]&&n[t][i])for(var f=n[t][i],u=0,e=f.length;e>u;u++)f[u].call(this,r||fabric.window.event)}}function p(n){n||(n=fabric.window.event);var i=n.target||(typeof n.srcElement!==w?n.srcElement:null),t=fabric.util.getScrollLeftTop(i);return{x:o(n)+t.left,y:s(n)+t.top}}function h(n,t,i){var r,f="touchend"===n.type?"changedTouches":"touches",u=n[f];return u&&u[0]&&(r=u[0][i]),"undefined"==typeof r&&(r=n[i]),r}var c,l,w="unknown",r=function(){var n=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)}}(),o,s;!function(){var n={};c=function(t){return n[t]};l=function(t,i){n[t]=i}}();var u,f,b=i(fabric.document.documentElement,"addEventListener","removeEventListener")&&i(fabric.window,"addEventListener","removeEventListener"),e=i(fabric.document.documentElement,"attachEvent","detachEvent")&&i(fabric.window,"attachEvent","detachEvent"),t={},n={};b?(u=function(n,t,i,r){n&&n.addEventListener(t,i,e?!1:r)},f=function(n,t,i,r){n&&n.removeEventListener(t,i,e?!1:r)}):e?(u=function(n,i,u){var f,e;n&&(f=r(n),l(f,n),t[f]||(t[f]={}),t[f][i]||(t[f][i]=[]),e=a(f,u),t[f][i].push(e),n.attachEvent("on"+i,e.wrappedHandler))},f=function(n,i,u){var o,f,e,s;if(n&&(f=r(n),t[f]&&t[f][i]))for(e=0,s=t[f][i].length;s>e;e++)o=t[f][i][e],o&&o.handler===u&&(n.detachEvent("on"+i,o.wrappedHandler),t[f][i][e]=null)}):(u=function(t,i,u){var f,e;t&&(f=r(t),(n[f]||(n[f]={}),n[f][i])||(n[f][i]=[],e=t["on"+i],e&&n[f][i].push(e),t["on"+i]=y(f,i)),n[f][i].push(u))},f=function(t,i,u){var f;if(t&&(f=r(t),n[f]&&n[f][i]))for(var o=n[f][i],e=0,s=o.length;s>e;e++)o[e]===u&&o.splice(e,1)});fabric.util.addListener=u;fabric.util.removeListener=f;o=function(n){return n.clientX};s=function(n){return n.clientY};fabric.isTouchSupported&&(o=function(n){return h(n,"pageX","clientX")},s=function(n){return h(n,"pageY","clientY")});fabric.util.getPointer=p}();!function(){function r(t,i){var u=t.style,r,f;if(!u)return t;if("string"==typeof i)return t.style.cssText+=";"+i,i.indexOf("opacity")>-1?n(t,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(r in i)"opacity"===r?n(t,i[r]):(f="float"===r||"cssFloat"===r?"undefined"==typeof u.styleFloat?"cssFloat":"styleFloat":r,u[f]=i[r]);return t}var t=fabric.document.createElement("div"),u="string"==typeof t.style.opacity,f="string"==typeof t.style.filter,i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(n){return n};u?n=function(n,t){return n.style.opacity=t,n}:f&&(n=function(n,t){var r=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(r.zoom=1),i.test(r.filter)?(t=t>=.9999?"":"alpha(opacity="+100*t+")",r.filter=r.filter.replace(i,t)):r.filter+=" alpha(opacity="+100*t+")",n});fabric.util.setStyle=r}();!function(){function f(n){return"string"==typeof n?fabric.document.getElementById(n):n}function i(n,t){var r=fabric.document.createElement(n);for(var i in t)"class"===i?r.className=t[i]:"for"===i?r.htmlFor=t[i]:r.setAttribute(i,t[i]);return r}function e(n,t){n&&-1===(" "+n.className+" ").indexOf(" "+t+" ")&&(n.className+=(n.className?" ":"")+t)}function o(n,t,r){return"string"==typeof t&&(t=i(t,r)),n.parentNode&&n.parentNode.replaceChild(t,n),t.appendChild(n),t}function r(n){for(var t=0,i=0,r=fabric.document.documentElement,u=fabric.document.body||{scrollLeft:0,scrollTop:0};n&&(n.parentNode||n.host)&&(n=n.parentNode||n.host,n===fabric.document?(t=u.scrollLeft||r.scrollLeft||0,i=u.scrollTop||r.scrollTop||0):(t+=n.scrollLeft||0,i+=n.scrollTop||0),1!==n.nodeType||"fixed"!==n.style.position););return{left:t,top:i}}function s(n){var u,f,s=n&&n.ownerDocument,e={left:0,top:0},i={left:0,top:0},h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"},o;if(!s)return i;for(o in h)i[h[o]]+=parseInt(t(n,o),10)||0;return u=s.documentElement,"undefined"!=typeof n.getBoundingClientRect&&(e=n.getBoundingClientRect()),f=r(n),{left:e.left+f.left-(u.clientLeft||0)+i.left,top:e.top+f.top-(u.clientTop||0)+i.top}}function h(n){var t=fabric.jsdomImplForWrapper(n);return t._canvas||t._image}function c(n){if(fabric.isLikelyNode){var t=fabric.jsdomImplForWrapper(n);t&&(t._image=null,t._canvas=null,t._currentSrc=null,t._attributes=null,t._classList=null)}}var u,l=Array.prototype.slice,n=function(n){return l.call(n,0)},t;try{u=n(fabric.document.childNodes)instanceof Array}catch(a){}u||(n=function(n){for(var i=new Array(n.length),t=n.length;t--;)i[t]=n[t];return i});t=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(n,t){var i=fabric.document.defaultView.getComputedStyle(n,null);if(i)return i[t]}:function(n,t){var i=n.style[t];return!i&&n.currentStyle&&(i=n.currentStyle[t]),i},function(){function i(n){return"undefined"!=typeof n.onselectstart&&(n.onselectstart=fabric.util.falseFunction),t?n.style[t]="none":"string"==typeof n.unselectable&&(n.unselectable="on"),n}function r(n){return"undefined"!=typeof n.onselectstart&&(n.onselectstart=null),t?n.style[t]="":"string"==typeof n.unselectable&&(n.unselectable=""),n}var n=fabric.document.documentElement.style,t="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=i;fabric.util.makeElementSelectable=r}(),function(){function n(n,t){var u=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.onload=i.onreadystatechange=function(n){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1;t(n||fabric.window.event);i=i.onload=i.onreadystatechange=null}};i.src=n;u.appendChild(i)}fabric.util.getScript=n}();fabric.util.getById=f;fabric.util.toArray=n;fabric.util.makeElement=i;fabric.util.addClass=e;fabric.util.wrapElement=o;fabric.util.getScrollLeftTop=r;fabric.util.getElementOffset=s;fabric.util.getElementStyle=t;fabric.util.getNodeCanvas=h;fabric.util.cleanUpJsdomNode=c}();!function(){function n(n,t){return n+(/\?/.test(n)?"&":"?")+t}function t(){}function i(i,r){r||(r={});var f=r.method?r.method.toUpperCase():"GET",o=r.onComplete||function(){},u=new fabric.window.XMLHttpRequest,e=r.body||r.parameters;return u.onreadystatechange=function(){4===u.readyState&&(o(u),u.onreadystatechange=t)},"GET"===f&&(e=null,"string"==typeof r.parameters&&(i=n(i,r.parameters))),u.open(f,i,!0),("POST"===f||"PUT"===f)&&u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(e),u}fabric.util.request=i}();fabric.log=function(){};fabric.warn=function(){};"undefined"!=typeof console&&["log","warn"].forEach(function(n){"undefined"!=typeof console[n]&&"function"==typeof console[n].apply&&(fabric[n]=function(){return console[n].apply(console,arguments)})});!function(){function n(){return!1}function i(i){t(function(r){i||(i={});var u,e=r||+new Date,f=i.duration||500,s=e+f,l=i.onChange||n,a=i.abort||n,v=i.onComplete||n,y=i.easing||function(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t},o="startValue"in i?i.startValue:0,h="endValue"in i?i.endValue:100,c=i.byValue||h-o;i.onStart&&i.onStart(),function p(n){if(a())return void v(h,1,1);u=n||+new Date;var r=u>s?f:u-e,b=r/f,w=y(r,o,c,f),k=Math.abs((w-o)/c);return l(w,k,b),u>s?void(i.onComplete&&i.onComplete()):void t(p)}(e)})}function t(){return u.apply(fabric.window,arguments)}function r(){return f.apply(fabric.window,arguments)}var u=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(n){return fabric.window.setTimeout(n,1e3/60)},f=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=i;fabric.util.requestAnimFrame=t;fabric.util.cancelAnimFrame=r}();!function(){function n(n,t,i){var r="rgba("+parseInt(n[0]+i*(t[0]-n[0]),10)+","+parseInt(n[1]+i*(t[1]-n[1]),10)+","+parseInt(n[2]+i*(t[2]-n[2]),10);return r+=","+(n&&t?parseFloat(n[3]+i*(t[3]-n[3])):1),r+")"}function t(t,i,r,u){var e=new fabric.Color(t).getSource(),f=new fabric.Color(i).getSource();u=u||{};fabric.util.animate(fabric.util.object.extend(u,{duration:r||500,startValue:e,endValue:f,byValue:f,easing:function(t,i,r,f){var e=u.colorEasing?u.colorEasing(t,f):1-Math.cos(t/f*(Math.PI/2));return n(i,r,e)}}))}fabric.util.animateColor=t}();!function(){function n(n,t,i,r){return n<Math.abs(t)?(n=t,r=i/4):r=0===t&&0===n?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(t/n),{a:n,c:t,p:i,s:r}}function i(n,t,i){return n.a*Math.pow(2,10*(t-=1))*Math.sin(2*(t*i-n.s)*Math.PI/n.p)}function u(n,t,i,r){return i*((n=n/r-1)*n*n+1)+t}function f(n,t,i,r){return n/=r/2,1>n?i/2*n*n*n+t:i/2*((n-=2)*n*n+2)+t}function e(n,t,i,r){return i*(n/=r)*n*n*n+t}function o(n,t,i,r){return-i*((n=n/r-1)*n*n*n-1)+t}function s(n,t,i,r){return n/=r/2,1>n?i/2*n*n*n*n+t:-i/2*((n-=2)*n*n*n-2)+t}function h(n,t,i,r){return i*(n/=r)*n*n*n*n+t}function c(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t}function l(n,t,i,r){return n/=r/2,1>n?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t}function a(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t}function v(n,t,i,r){return i*Math.sin(n/r*(Math.PI/2))+t}function y(n,t,i,r){return-i/2*(Math.cos(Math.PI*n/r)-1)+t}function p(n,t,i,r){return 0===n?t:i*Math.pow(2,10*(n/r-1))+t}function w(n,t,i,r){return n===r?t+i:i*(-Math.pow(2,-10*n/r)+1)+t}function b(n,t,i,r){return 0===n?t:n===r?t+i:(n/=r/2,1>n?i/2*Math.pow(2,10*(n-1))+t:i/2*(-Math.pow(2,-10*--n)+2)+t)}function k(n,t,i,r){return-i*(Math.sqrt(1-(n/=r)*n)-1)+t}function d(n,t,i,r){return i*Math.sqrt(1-(n=n/r-1)*n)+t}function g(n,t,i,r){return n/=r/2,1>n?-i/2*(Math.sqrt(1-n*n)-1)+t:i/2*(Math.sqrt(1-(n-=2)*n)+1)+t}function nt(t,r,u,f){var e=0,s=u,o;return 0===t?r:(t/=f,1===t)?r+u:(e||(e=.3*f),o=n(s,u,e,1.70158),-i(o,t,f)+r)}function tt(t,i,r,u){var e=0,o=r,f;return 0===t?i:(t/=u,1===t)?i+r:(e||(e=.3*u),f=n(o,r,e,1.70158),f.a*Math.pow(2,-10*t)*Math.sin(2*(t*u-f.s)*Math.PI/f.p)+f.c+i)}function it(t,r,u,f){var o=0,s=u,e;return 0===t?r:(t/=f/2,2===t)?r+u:(o||(o=.3*f*1.5),e=n(s,u,o,1.70158),1>t?-.5*i(e,t,f)+r:e.a*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*f-e.s)*Math.PI/e.p)*.5+e.c+r)}function rt(n,t,i,r,u){return void 0===u&&(u=1.70158),i*(n/=r)*n*((u+1)*n-u)+t}function ut(n,t,i,r,u){return void 0===u&&(u=1.70158),i*((n=n/r-1)*n*((u+1)*n+u)+1)+t}function ft(n,t,i,r,u){return void 0===u&&(u=1.70158),n/=r/2,1>n?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t}function r(n,i,r,u){return r-t(u-n,0,r,u)+i}function t(n,t,i,r){return(n/=r)<1/2.75?7.5625*i*n*n+t:2/2.75>n?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:2.5/2.75>n?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function et(n,i,u,f){return f/2>n?.5*r(2*n,0,u,f)+i:.5*t(2*n-f,0,u,f)+.5*u+i}fabric.util.ease={easeInQuad:function(n,t,i,r){return i*(n/=r)*n+t},easeOutQuad:function(n,t,i,r){return-i*(n/=r)*(n-2)+t},easeInOutQuad:function(n,t,i,r){return n/=r/2,1>n?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t},easeInCubic:function(n,t,i,r){return i*(n/=r)*n*n+t},easeOutCubic:u,easeInOutCubic:f,easeInQuart:e,easeOutQuart:o,easeInOutQuart:s,easeInQuint:h,easeOutQuint:c,easeInOutQuint:l,easeInSine:a,easeOutSine:v,easeInOutSine:y,easeInExpo:p,easeOutExpo:w,easeInOutExpo:b,easeInCirc:k,easeOutCirc:d,easeInOutCirc:g,easeInElastic:nt,easeOutElastic:tt,easeInOutElastic:it,easeInBack:rt,easeOutBack:ut,easeInOutBack:ft,easeInBounce:r,easeOutBounce:t,easeInOutBounce:et}}();!function(n){"use strict";function y(n){return n in l?l[n]:n}function p(n,r,u,f){var e,h="[object Array]"===Object.prototype.toString.call(r);if("fill"!==n&&"stroke"!==n||"none"!==r)if("vector-effect"===n)r="non-scaling-stroke"===r;else if("strokeDashArray"===n)r="none"===r?null:r.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===n)r=u&&u.transformMatrix?ft(u.transformMatrix,t.parseTransformAttribute(r)):t.parseTransformAttribute(r);else if("visible"===n)r="none"!==r&&"hidden"!==r,u&&u.visible===!1&&(r=!1);else if("opacity"===n)r=parseFloat(r),u&&"undefined"!=typeof u.opacity&&(r*=u.opacity);else if("textAnchor"===n)r="start"===r?"left":"end"===r?"right":"center";else if("charSpacing"===n)e=i(r,f)/f*1e3;else if("paintFirst"===n){var o=r.indexOf("fill"),s=r.indexOf("stroke"),r="fill";o>-1&&s>-1&&o>s?r="stroke":-1===o&&s>-1&&(r="stroke")}else{if("href"===n||"xlink:href"===n)return r;e=h?r.map(i):i(r,f)}else r="";return!h&&isNaN(e)?r:e}function r(n){return new RegExp("^("+n.join("|")+")\\b","i")}function w(n){var i,r;for(i in e)if("undefined"!=typeof n[e[i]]&&""!==n[i]){if("undefined"==typeof n[i]){if(!t.Object.prototype[i])continue;n[i]=t.Object.prototype[i]}0!==n[i].indexOf("url(")&&(r=new t.Color(n[i]),n[i]=r.setAlpha(ut(r.getAlpha()*n[e[i]],2)).toRgba())}return n}function o(n,t){for(var u,f,r=[],i=0,e=t.length;e>i;i++)u=t[i],f=n.getElementsByTagName(u),r=r.concat(Array.prototype.slice.call(f));return r}function b(n,t){var i,r;n.replace(/;\s*$/,"").split(";").forEach(function(n){var u=n.split(":");i=u[0].trim().toLowerCase();r=u[1].trim();t[i]=r})}function k(n,t){var r,u;for(var i in n)"undefined"!=typeof n[i]&&(r=i.toLowerCase(),u=n[i],t[r]=u)}function d(n,i){var f={},r,u;for(r in t.cssRules[i])if(g(n,r.split(" ")))for(u in t.cssRules[i][r])f[u]=t.cssRules[i][r][u];return f}function g(n,t){var i,r=!0;return i=s(n,t.pop()),i&&t.length&&(r=nt(n,t)),i&&r&&0===t.length}function nt(n,t){for(var i,r=!0;n.parentNode&&1===n.parentNode.nodeType&&t.length;)r&&(i=t.pop()),n=n.parentNode,r=s(n,i);return 0===t.length}function s(n,t){var i,u,e=n.nodeName,r=n.getAttribute("class"),f=n.getAttribute("id");if(i=new RegExp("^"+e,"i"),t=t.replace(i,""),f&&t.length&&(i=new RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),r&&t.length)for(r=r.split(" "),u=r.length;u--;)i=new RegExp("\\."+r[u]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return 0===t.length}function h(n,t){var r,u,i,e,f;if(n.getElementById&&(r=n.getElementById(t)),r)return r;for(f=n.getElementsByTagName("*"),i=0,e=f.length;e>i;i++)if(u=f[i],t===u.getAttribute("id"))return u}function tt(n){for(var a,e=o(n,["use","svg:use"]),c=0;e.length&&c<e.length;){var y,i,r,s,l,u=e[c],p=(u.getAttribute("xlink:href")||u.getAttribute("href")).substr(1),w=u.getAttribute("x")||0,b=u.getAttribute("y")||0,t=h(n,p).cloneNode(!0),v=(t.getAttribute("transform")||"")+" translate("+w+", "+b+")",k=e.length;if(f(t),/^svg$/i.test(t.nodeName)){for(a=t.ownerDocument.createElement("g"),r=0,s=t.attributes,l=s.length;l>r;r++)i=s.item(r),a.setAttribute(i.nodeName,i.nodeValue);for(;t.firstChild;)a.appendChild(t.firstChild);t=a}for(r=0,s=u.attributes,l=s.length;l>r;r++)i=s.item(r),"x"!==i.nodeName&&"y"!==i.nodeName&&"xlink:href"!==i.nodeName&&"href"!==i.nodeName&&("transform"===i.nodeName?v=i.nodeValue+" "+v:t.setAttribute(i.nodeName,i.nodeValue));t.setAttribute("transform",v);t.setAttribute("instantiated_by_use","1");t.removeAttribute("id");y=u.parentNode;y.replaceChild(t,u);e.length===k&&c++}}function f(n){var c,l,h,s,o=n.getAttribute("viewBox"),u=1,f=1,b=0,k=0,v=n.getAttribute("width"),y=n.getAttribute("height"),d=n.getAttribute("x")||0,g=n.getAttribute("y")||0,e=n.getAttribute("preserveAspectRatio")||"",nt=!o||!t.svgViewBoxElementsRegEx.test(n.nodeName)||!(o=o.match(a)),tt=!v||!y||"100%"===v||"100%"===y,it=nt&&tt,r={},rt="",p=0,w=0;if(r.width=0,r.height=0,r.toBeParsed=it,it)return r;if(nt)return r.width=i(v),r.height=i(y),r;if(b=-parseFloat(o[1]),k=-parseFloat(o[2]),c=parseFloat(o[3]),l=parseFloat(o[4]),tt?(r.width=c,r.height=l):(r.width=i(v),r.height=i(y),u=r.width/c,f=r.height/l),e=t.util.parsePreserveAspectRatioAttribute(e),"none"!==e.alignX&&("meet"===e.meetOrSlice&&(f=u=u>f?f:u),"slice"===e.meetOrSlice&&(f=u=u>f?u:f),p=r.width-c*u,w=r.height-l*u,"Mid"===e.alignX&&(p/=2),"Mid"===e.alignY&&(w/=2),"Min"===e.alignX&&(p=0),"Min"===e.alignY&&(w=0)),1===u&&1===f&&0===b&&0===k&&0===d&&0===g)return r;if((d||g)&&(rt=" translate("+i(d)+" "+i(g)+") "),h=rt+" matrix("+u+" 0 0 "+f+" "+(b*u+p)+" "+(k*f+w)+") ",r.viewboxTransform=t.parseTransformAttribute(h),"svg"===n.nodeName){for(s=n.ownerDocument.createElement("g");n.firstChild;)s.appendChild(n.firstChild);n.appendChild(s)}else s=n,h=s.getAttribute("transform")+h;return s.setAttribute("transform",h),r}function it(n,t){for(;n&&(n=n.parentNode);)if(n.nodeName&&t.test(n.nodeName.replace("svg:",""))&&!n.getAttribute("instantiated_by_use"))return!0;return!1}function c(n,t){var r="xlink:href",f=t.getAttribute(r).substr(1),i=h(n,f),u;if(i&&i.getAttribute(r)&&c(n,i),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(n){t.hasAttribute(n)||t.setAttribute(n,i.getAttribute(n))}),!t.children.length)for(u=i.cloneNode(!0);u.firstChild;)t.appendChild(u.firstChild);t.removeAttribute(r)}var t=n.fabric||(n.fabric={}),u=t.util.object.extend,rt=t.util.object.clone,ut=t.util.toFixed,i=t.util.parseUnit,ft=t.util.multiplyTransformMatrices,l={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},e={stroke:"strokeOpacity",fill:"fillOpacity"},a,v;t.svgValidTagNamesRegEx=r(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);t.svgViewBoxElementsRegEx=r(["symbol","image","marker","pattern","view","svg"]);t.svgInvalidAncestorsRegEx=r(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);t.svgValidParentsRegEx=r(["symbol","g","a","svg","clipPath","defs"]);t.cssRules={};t.gradientDefs={};t.clipPaths={};t.parseTransformAttribute=function(){function e(n,i){var r=t.util.cos(i[0]),u=t.util.sin(i[0]),f=0,e=0;3===i.length&&(f=i[1],e=i[2]);n[0]=r;n[1]=u;n[2]=-u;n[3]=r;n[4]=f-(r*f-u*e);n[5]=e-(u*f+r*e)}function o(n,t){var i=t[0],r=2===t.length?t[1]:t[0];n[0]=i;n[3]=r}function u(n,i,r){n[r]=Math.tan(t.util.degreesToRadians(i[0]))}function s(n,t){n[4]=t[0];2===t.length&&(n[5]=t[1])}var f=t.iMatrix,n=t.reNum,i="(?:\\s+,?\\s*|,\\s*)",h="(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))",c="(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))",l="(?:(rotate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+")"+i+"("+n+"))?\\s*\\))",a="(?:(scale)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",v="(?:(translate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",y="(?:(matrix)\\s*\\(\\s*("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")\\s*\\))",r="(?:"+y+"|"+v+"|"+a+"|"+l+"|"+h+"|"+c+")",p="(?:"+r+"(?:"+i+"*"+r+")*)",w="^\\s*(?:"+p+"?)\\s*$",b=new RegExp(w),k=new RegExp(r,"g");return function(n){var i=f.concat(),h=[],c;if(!n||n&&!b.test(n))return i;for(n.replace(k,function(n){var l=new RegExp(r).exec(n).filter(function(n){return!!n}),a=l[1],c=l.slice(2).map(parseFloat);switch(a){case"translate":s(i,c);break;case"rotate":c[0]=t.util.degreesToRadians(c[0]);e(i,c);break;case"scale":o(i,c);break;case"skewX":u(i,c,2);break;case"skewY":u(i,c,1);break;case"matrix":i=c}h.push(i.concat());i=f.concat()}),c=h[0];h.length>1;)h.shift(),c=t.util.multiplyTransformMatrices(c,h[0]);return c}}();a=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");t.parseSVGDocument=function(n,i,r,u){var l,h,a;if(n){tt(n);var s,v,o=t.Object.__uid++,c=f(n),e=t.util.toArray(n.getElementsByTagName("*"));if(c.crossOrigin=u&&u.crossOrigin,c.svgUid=o,0===e.length&&t.isLikelyNode){for(e=n.selectNodes('//*[name(.)!="svg"]'),l=[],s=0,v=e.length;v>s;s++)l[s]=e[s];e=l}if(h=e.filter(function(n){return f(n),t.svgValidTagNamesRegEx.test(n.nodeName.replace("svg:",""))&&!it(n,t.svgInvalidAncestorsRegEx)}),!h||h&&!h.length)return void(i&&i([],{}));a={};e.filter(function(n){return"clipPath"===n.nodeName.replace("svg:","")}).forEach(function(n){var i=n.getAttribute("id");a[i]=t.util.toArray(n.getElementsByTagName("*")).filter(function(n){return t.svgValidTagNamesRegEx.test(n.nodeName.replace("svg:",""))})});t.gradientDefs[o]=t.getGradientDefs(n);t.cssRules[o]=t.getCSSRules(n);t.clipPaths[o]=a;t.parseElements(h,function(n,r){i&&(i(n,c,r,e),delete t.gradientDefs[o],delete t.cssRules[o],delete t.clipPaths[o])},rt(c),r,u)}};v=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");u(t,{parseFontDeclaration:function(n,t){var r=n.match(v);if(r){var e=r[1],u=r[3],o=r[4],f=r[5],s=r[6];e&&(t.fontStyle=e);u&&(t.fontWeight=isNaN(parseFloat(u))?u:parseFloat(u));o&&(t.fontSize=i(o));s&&(t.fontFamily=s);f&&(t.lineHeight="normal"===f?1:f)}},getGradientDefs:function(n){for(var t,r=o(n,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),i=0,u={},i=r.length;i--;)t=r[i],t.getAttribute("xlink:href")&&c(n,t),u[t.getAttribute("id")]=t;return u},parseAttributes:function(n,r,f){var h,c,b,s,e,l,k,o,a,v;if(n){s={};"undefined"==typeof f&&(f=n.getAttribute("svgUid"));n.parentNode&&t.svgValidParentsRegEx.test(n.parentNode.nodeName)&&(s=t.parseAttributes(n.parentNode,r,f));e=r.reduce(function(t,i){return h=n.getAttribute(i),h&&(t[i]=h),t},{});e=u(e,u(d(n,f),t.parseStyleAttribute(n)));c=b=s.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE;e["font-size"]&&(e["font-size"]=c=i(e["font-size"],b));o={};for(a in e)l=y(a),k=p(l,e[a],s,c),o[l]=k;return o&&o.font&&t.parseFontDeclaration(o.font,o),v=u(s,o),t.svgValidParentsRegEx.test(n.nodeName)?v:w(v)}},parseElements:function(n,i,r,u,f){new t.ElementsParser(n,i,r,u,f).parse()},parseStyleAttribute:function(n){var t={},i=n.getAttribute("style");return i?("string"==typeof i?b(i,t):k(i,t),t):t},parsePointsAttribute:function(n){if(!n)return null;n=n.replace(/,/g," ").trim();n=n.split(/\s+/);for(var r=[],t=0,i=n.length;i>t;t+=2)r.push({x:parseFloat(n[t]),y:parseFloat(n[t+1])});return r},getCSSRules:function(n){for(var f,o=n.getElementsByTagName("style"),e={},r,i=0,u=o.length;u>i;i++)r=o[i].textContent||o[i].text,r=r.replace(/\/\*[\s\S]*?\*\//g,""),""!==r.trim()&&(f=r.match(/[^{]*\{[\s\S]*?\}/g),f=f.map(function(n){return n.trim()}),f.forEach(function(n){var f=n.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},h=f[2].trim(),o=h.replace(/;$/,"").split(/\s*;\s*/);for(i=0,u=o.length;u>i;i++){var s=o[i].split(/\s*:\s*/),c=s[0],l=s[1];r[c]=l}n=f[1];n.split(",").forEach(function(n){n=n.replace(/^svg/i,"").trim();""!==n&&(e[n]?t.util.object.extend(e[n],r):e[n]=t.util.object.clone(r))})}));return e},loadSVGFromURL:function(n,i,r,u){function f(n){var f=n.responseXML;return f&&!f.documentElement&&t.window.ActiveXObject&&n.responseText&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(n.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),f&&f.documentElement?void t.parseSVGDocument(f.documentElement,function(n,t,r,u){i&&i(n,t,r,u)},r,u):(i&&i(null),!1)}n=n.replace(/^\n\s*/,"").trim();new t.util.request(n,{method:"get",onComplete:f})},loadSVGFromString:function(n,i,r,u){var f,e;n=n.trim();"undefined"!=typeof t.window.DOMParser?(e=new t.window.DOMParser,e&&e.parseFromString&&(f=e.parseFromString(n,"text/xml"))):t.window.ActiveXObject&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(n.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(f.documentElement,function(n,t,r,u){i(n,t,r,u)},r,u)}})}("undefined"!=typeof exports?exports:this);fabric.ElementsParser=function(n,t,i,r,u){this.elements=n;this.callback=t;this.options=i;this.reviver=r;this.svgUid=i&&i.svgUid||0;this.parsingOptions=u;this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g},function(n){n.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};n.createObjects=function(){var n=this;this.elements.forEach(function(t,i){t.setAttribute("svgUid",n.svgUid);n.createObject(t,i)})};n.findTag=function(n){return fabric[fabric.util.string.capitalize(n.tagName.replace("svg:",""))]};n.createObject=function(n,t){var i=this.findTag(n);if(i&&i.fromElement)try{i.fromElement(n,this.createCallback(t,n),this.options)}catch(r){fabric.log(r)}else this.checkIfDone()};n.createCallback=function(n,t){var i=this;return function(r){var u;i.resolveGradient(r,"fill");i.resolveGradient(r,"stroke");r instanceof fabric.Image&&r._originalElement&&(u=r.parsePreserveAspectRatioAttribute(t));r._removeTransformMatrix(u);i.resolveClipPath(r);i.reviver&&i.reviver(t,r);i.instances[n]=r;i.checkIfDone()}};n.extractPropertyDefinition=function(n,t,i){var r=n[t],u;if(/^url\(/.test(r))return u=this.regexUrl.exec(r)[1],this.regexUrl.lastIndex=0,fabric[i][this.svgUid][u]};n.resolveGradient=function(n,t){var i=this.extractPropertyDefinition(n,t,"gradientDefs");i&&n.set(t,fabric.Gradient.fromElement(i,n))};n.createClipPathCallback=function(n,t){return function(n){n._removeTransformMatrix();n.fillRule=n.clipRule;t.push(n)}};n.resolveClipPath=function(n){var f,e,o,r,s,t=this.extractPropertyDefinition(n,"clipPath","clipPaths"),u,i;if(t){for(r=[],o=fabric.util.invertTransform(n.calcTransformMatrix()),u=0;u<t.length;u++)f=t[u],e=this.findTag(f),e.fromElement(f,this.createClipPathCallback(n,r),this.options);t=1===r.length?r[0]:new fabric.Group(r);s=fabric.util.multiplyTransformMatrices(o,t.calcTransformMatrix());i=fabric.util.qrDecompose(s);t.flipX=!1;t.flipY=!1;t.set("scaleX",i.scaleX);t.set("scaleY",i.scaleY);t.angle=i.angle;t.skewX=i.skewX;t.skewY=0;t.setPositionByOrigin({x:i.translateX,y:i.translateY},"center","center");n.clipPath=t}};n.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(n){return null!=n}),this.callback(this.instances,this.elements))}}(fabric.ElementsParser.prototype);!function(n){"use strict";function t(n,t){this.x=n;this.y=t}var i=n.fabric||(n.fabric={});return i.Point?void i.warn("fabric.Point is already defined"):(i.Point=t,void(t.prototype={type:"point",constructor:t,add:function(n){return new t(this.x+n.x,this.y+n.y)},addEquals:function(n){return this.x+=n.x,this.y+=n.y,this},scalarAdd:function(n){return new t(this.x+n,this.y+n)},scalarAddEquals:function(n){return this.x+=n,this.y+=n,this},subtract:function(n){return new t(this.x-n.x,this.y-n.y)},subtractEquals:function(n){return this.x-=n.x,this.y-=n.y,this},scalarSubtract:function(n){return new t(this.x-n,this.y-n)},scalarSubtractEquals:function(n){return this.x-=n,this.y-=n,this},multiply:function(n){return new t(this.x*n,this.y*n)},multiplyEquals:function(n){return this.x*=n,this.y*=n,this},divide:function(n){return new t(this.x/n,this.y/n)},divideEquals:function(n){return this.x/=n,this.y/=n,this},eq:function(n){return this.x===n.x&&this.y===n.y},lt:function(n){return this.x<n.x&&this.y<n.y},lte:function(n){return this.x<=n.x&&this.y<=n.y},gt:function(n){return this.x>n.x&&this.y>n.y},gte:function(n){return this.x>=n.x&&this.y>=n.y},lerp:function(n,i){return"undefined"==typeof i&&(i=.5),i=Math.max(Math.min(1,i),0),new t(this.x+(n.x-this.x)*i,this.y+(n.y-this.y)*i)},distanceFrom:function(n){var t=this.x-n.x,i=this.y-n.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(n){return this.lerp(n)},min:function(n){return new t(Math.min(this.x,n.x),Math.min(this.y,n.y))},max:function(n){return new t(Math.max(this.x,n.x),Math.max(this.y,n.y))},toString:function(){return this.x+","+this.y},setXY:function(n,t){return this.x=n,this.y=t,this},setX:function(n){return this.x=n,this},setY:function(n){return this.y=n,this},setFromPoint:function(n){return this.x=n.x,this.y=n.y,this},swap:function(n){var t=this.x,i=this.y;this.x=n.x;this.y=n.y;n.x=t;n.y=i},clone:function(){return new t(this.x,this.y)}}))}("undefined"!=typeof exports?exports:this);!function(n){"use strict";function t(n){this.status=n;this.points=[]}var i=n.fabric||(n.fabric={});return i.Intersection?void i.warn("fabric.Intersection is already defined"):(i.Intersection=t,i.Intersection.prototype={constructor:t,appendPoint:function(n){return this.points.push(n),this},appendPoints:function(n){return this.points=this.points.concat(n),this}},i.Intersection.intersectLineLine=function(n,r,u,f){var e,c=(f.x-u.x)*(n.y-u.y)-(f.y-u.y)*(n.x-u.x),l=(r.x-n.x)*(n.y-u.y)-(r.y-n.y)*(n.x-u.x),s=(f.y-u.y)*(r.x-n.x)-(f.x-u.x)*(r.y-n.y),o,h;return 0!==s?(o=c/s,h=l/s,o>=0&&1>=o&&h>=0&&1>=h?(e=new t("Intersection"),e.appendPoint(new i.Point(n.x+o*(r.x-n.x),n.y+o*(r.y-n.y)))):e=new t):e=new t(0===c||0===l?"Coincident":"Parallel"),e},i.Intersection.intersectLinePolygon=function(n,i,r){for(var e,o,s,f=new t,h=r.length,u=0;h>u;u++)e=r[u],o=r[(u+1)%h],s=t.intersectLineLine(n,i,e,o),f.appendPoints(s.points);return f.points.length>0&&(f.status="Intersection"),f},i.Intersection.intersectPolygonPolygon=function(n,i){for(var u=new t,f=n.length,r=0;f>r;r++){var e=n[r],o=n[(r+1)%f],s=t.intersectLinePolygon(e,o,i);u.appendPoints(s.points)}return u.points.length>0&&(u.status="Intersection"),u},void(i.Intersection.intersectPolygonRectangle=function(n,r,u){var e=r.min(u),o=r.max(u),s=new i.Point(o.x,e.y),h=new i.Point(e.x,o.y),c=t.intersectLinePolygon(e,s,n),l=t.intersectLinePolygon(s,o,n),a=t.intersectLinePolygon(o,h,n),v=t.intersectLinePolygon(h,e,n),f=new t;return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(a.points),f.appendPoints(v.points),f.points.length>0&&(f.status="Intersection"),f}))}("undefined"!=typeof exports?exports:this);!function(n){"use strict";function t(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function r(n,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?n+6*(t-n)*i:.5>i?t:2/3>i?n+(t-n)*(2/3-i)*6:n}var i=n.fabric||(n.fabric={});return i.Color?void i.warn("fabric.Color is already defined."):(i.Color=t,i.Color.prototype={_tryParsingColor:function(n){var i;n in t.colorNameMap&&(n=t.colorNameMap[n]);"transparent"===n&&(i=[255,255,255,0]);i||(i=t.sourceFromHex(n));i||(i=t.sourceFromRgb(n));i||(i=t.sourceFromHsl(n));i||(i=[0,0,0,1]);i&&this.setSource(i)},_rgbToHsl:function(n,t,r){var f,s,h,u,e,o;if(n/=255,t/=255,r/=255,u=i.util.array.max([n,t,r]),e=i.util.array.min([n,t,r]),h=(u+e)/2,u===e)f=s=0;else{o=u-e;switch(s=h>.5?o/(2-u-e):o/(u+e),u){case n:f=(t-r)/o+(r>t?6:0);break;case t:f=(r-n)/o+2;break;case r:f=(n-t)/o+4}f/=6}return[Math.round(360*f),Math.round(100*s),Math.round(100*h)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+n[3]+")"},toHex:function(){var n,t,i,r=this.getSource();return n=r[0].toString(16),n=1===n.length?"0"+n:n,t=r[1].toString(16),t=1===t.length?"0"+t:t,i=r[2].toString(16),i=1===i.length?"0"+i:i,n.toUpperCase()+t.toUpperCase()+i.toUpperCase()},toHexa:function(){var n,t=this.getSource();return n=Math.round(255*t[3]),n=n.toString(16),n=1===n.length?"0"+n:n,this.toHex()+n.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var t=this.getSource();return t[3]=n,this.setSource(t),this},toGrayscale:function(){var n=this.getSource(),t=parseInt((.3*n[0]+.59*n[1]+.11*n[2]).toFixed(0),10),i=n[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(n){var i=this.getSource(),t=(.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),r=i[3];return n=n||127,t=Number(t)<Number(n)?0:255,this.setSource([t,t,t,r]),this},overlayWith:function(n){n instanceof t||(n=new t(n));for(var r=[],f=this.getAlpha(),u=.5,e=this.getSource(),o=n.getSource(),i=0;3>i;i++)r.push(Math.round(e[i]*(1-u)+o[i]*u));return r[3]=f,this.setSource(r),this}},i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,i.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,i.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},i.Color.fromRgb=function(n){return t.fromSource(t.sourceFromRgb(n))},i.Color.sourceFromRgb=function(n){var i=n.match(t.reRGBa);if(i){var r=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),u=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),f=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(r,10),parseInt(u,10),parseInt(f,10),i[4]?parseFloat(i[4]):1]}},i.Color.fromRgba=t.fromRgb,i.Color.fromHsl=function(n){return t.fromSource(t.sourceFromHsl(n))},i.Color.sourceFromHsl=function(n){var i=n.match(t.reHSLa),f,o;if(i){var s,h,c,l=(parseFloat(i[1])%360+360)%360/360,e=parseFloat(i[2])/(/%$/.test(i[2])?100:1),u=parseFloat(i[3])/(/%$/.test(i[3])?100:1);return 0===e?s=h=c=u:(f=.5>=u?u*(e+1):u+e-u*e,o=2*u-f,s=r(o,f,l+1/3),h=r(o,f,l),c=r(o,f,l-1/3)),[Math.round(255*s),Math.round(255*h),Math.round(255*c),i[4]?parseFloat(i[4]):1]}},i.Color.fromHsla=t.fromHsl,i.Color.fromHex=function(n){return t.fromSource(t.sourceFromHex(n))},i.Color.sourceFromHex=function(n){if(n.match(t.reHex)){var i=n.slice(n.indexOf("#")+1),r=3===i.length||4===i.length,u=8===i.length||4===i.length,f=r?i.charAt(0)+i.charAt(0):i.substring(0,2),e=r?i.charAt(1)+i.charAt(1):i.substring(2,4),o=r?i.charAt(2)+i.charAt(2):i.substring(4,6),s=u?r?i.charAt(3)+i.charAt(3):i.substring(6,8):"FF";return[parseInt(f,16),parseInt(e,16),parseInt(o,16),parseFloat((parseInt(s,16)/255).toFixed(2))]}},void(i.Color.fromSource=function(n){var i=new t;return i.setSource(n),i}))}("undefined"!=typeof exports?exports:this);!function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.toFixed;return t.Shadow?void t.warn("fabric.Shadow is already defined."):(t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(n){"string"==typeof n&&(n=this._parseShadow(n));for(var i in n)this[i]=n[i];this.id=t.Object.__uid++},_parseShadow:function(n){var r=n.trim(),i=t.Shadow.reOffsetsAndBlur.exec(r)||[],u=r.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:u.trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(n){var f=40,e=40,u=t.Object.NUM_FRACTION_DIGITS,r=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-n.angle)),o=20,s=new t.Color(this.color);return n.width&&n.height&&(f=100*i((Math.abs(r.x)+this.blur)/n.width,u)+o,e=100*i((Math.abs(r.y)+this.blur)/n.height,u)+o),n.flipX&&(r.x*=-1),n.flipY&&(r.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+e+'%" height="'+(100+2*e)+'%" x="-'+f+'%" width="'+(100+2*f)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,u)+'"><\/feGaussianBlur>\n\t<feOffset dx="'+i(r.x,u)+'" dy="'+i(r.y,u)+'" result="oBlur" ><\/feOffset>\n\t<feFlood flood-color="'+s.toRgb()+'" flood-opacity="'+s.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode><\/feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"><\/feMergeNode>\n\t<\/feMerge>\n<\/filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var n={},i=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(t){this[t]!==i[t]&&(n[t]=this[t])},this),n}}),void(t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this);!function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var t=fabric.util.object.extend,s=fabric.util.getElementOffset,n=fabric.util.removeFromArray,r=fabric.util.toFixed,i=fabric.util.transformPoint,u=fabric.util.invertTransform,f=fabric.util.getNodeCanvas,e=fabric.util.createCanvasElement,o=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(n,t){t||(t={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(n,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(n,t){var i=this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(n);this._initOptions(t);this._setImageSmoothing();this.interactive||this._initRetinaScaling();t.overlayImage&&this.setOverlayImage(t.overlayImage,i);t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,i);t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,i);t.overlayColor&&this.setOverlayColor(t.overlayColor,i);this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(n,t,i){return this.__setBgOverlayImage("overlayImage",n,t,i)},setBackgroundImage:function(n,t,i){return this.__setBgOverlayImage("backgroundImage",n,t,i)},setOverlayColor:function(n,t){return this.__setBgOverlayColor("overlayColor",n,t)},setBackgroundColor:function(n,t){return this.__setBgOverlayColor("backgroundColor",n,t)},_setImageSmoothing:function(){var n=this.getContext();n.imageSmoothingEnabled=n.imageSmoothingEnabled||n.webkitImageSmoothingEnabled||n.mozImageSmoothingEnabled||n.msImageSmoothingEnabled||n.oImageSmoothingEnabled;n.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(n,t,i,r){return"string"==typeof t?fabric.util.loadImage(t,function(t){if(t){var u=new fabric.Image(t,r);this[n]=u;u.canvas=this}i&&i(t)},this,r&&r.crossOrigin):(r&&t.setOptions(r),this[n]=t,t&&(t.canvas=this),i&&i(t)),this},__setBgOverlayColor:function(n,t,i){return this[n]=t,this._initGradient(t,n),this._initPattern(t,n,i),this},_createCanvasElement:function(){var n=e();if(!n)throw o;if(n.style||(n.style={}),"undefined"==typeof n.getContext)throw o;return n},_initOptions:function(n){var t=this.lowerCanvasEl;this._setOptions(n);this.width=this.width||parseInt(t.width,10)||0;this.height=this.height||parseInt(t.height,10)||0;this.lowerCanvasEl.style&&(t.width=this.width,t.height=this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(n){this.lowerCanvasEl=n&&n.getContext?n:fabric.util.getById(n)||this._createCanvasElement();fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n,t){return this.setDimensions({width:n},t)},setHeight:function(n,t){return this.setDimensions({height:n},t)},setDimensions:function(n,t){var r,i;t=t||{};for(i in n)r=n[i],t.cssOnly||(this._setBackstoreDimension(i,n[i]),r+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(i,r);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(n,t){return this.lowerCanvasEl[n]=t,this.upperCanvasEl&&(this.upperCanvasEl[n]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[n]=t),this[n]=t,this},_setCssDimension:function(n,t){return this.lowerCanvasEl.style[n]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[n]=t),this.wrapperEl&&(this.wrapperEl.style[n]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(n){var i,t,u,r=this._activeObject,f=!1,e=!0;for(this.viewportTransform=n,t=0,u=this._objects.length;u>t;t++)i=this._objects[t],i.group||i.setCoords(f,e);return r&&"activeSelection"===r.type&&r.setCoords(f,e),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(n,t){var e=n,r=this.viewportTransform.slice(0),f;return n=i(n,u(this.viewportTransform)),r[0]=t,r[3]=t,f=i(n,r),r[4]+=e.x-f.x,r[5]+=e.y-f.y,this.setViewportTransform(r)},setZoom:function(n){return this.zoomToPoint(new fabric.Point(0,0),n),this},absolutePan:function(n){var t=this.viewportTransform.slice(0);return t[4]=-n.x,t[5]=-n.y,this.setViewportTransform(t)},relativePan:function(n){return this.absolutePan(new fabric.Point(-n.x-this.viewportTransform[4],-n.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(n){this.stateful&&n.setupState();n._set("canvas",this);n.setCoords();this.fire("object:added",{target:n});n.fire("added")},_onObjectRemoved:function(n){this.fire("object:removed",{target:n});n.fire("removed");delete n.canvas},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var n=this.contextContainer;return this.renderCanvas(n,this._objects),this},renderAndReset:function(){this.isRendering=0;this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var n={},r=this.width,f=this.height,t=u(this.viewportTransform);return n.tl=i({x:0,y:0},t),n.br=i({x:r,y:f},t),n.tr=new fabric.Point(n.br.x,n.tl.y),n.bl=new fabric.Point(n.tl.x,n.br.y),this.vptCoords=n,n},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(n,t){var i=this.viewportTransform,r=this.clipPath;this.cancelRequestedRender();this.calcViewportBoundaries();this.clearContext(n);this.fire("before:render",{ctx:n});this.clipTo&&fabric.util.clipContext(this,n);this._renderBackground(n);n.save();n.transform(i[0],i[1],i[2],i[3],i[4],i[5]);this._renderObjects(n,t);n.restore();!this.controlsAboveOverlay&&this.interactive&&this.drawControls(n);this.clipTo&&n.restore();r&&(r.canvas=this,r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(n));this._renderOverlay(n);this.controlsAboveOverlay&&this.interactive&&this.drawControls(n);this.fire("after:render",{ctx:n})},drawClipPathOnCanvas:function(n){var t=this.viewportTransform,i=this.clipPath;n.save();n.transform(t[0],t[1],t[2],t[3],t[4],t[5]);n.globalCompositeOperation="destination-in";i.transform(n);n.scale(1/i.zoomX,1/i.zoomY);n.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY);n.restore()},_renderObjects:function(n,t){for(var i=0,r=t.length;r>i;++i)t[i]&&t[i].render(n)},_renderBackgroundOrOverlay:function(n,t){var r=this[t+"Color"],f=this[t+"Image"],i=this.viewportTransform,e=this[t+"Vpt"],u;(r||f)&&(r&&(n.save(),n.beginPath(),n.moveTo(0,0),n.lineTo(this.width,0),n.lineTo(this.width,this.height),n.lineTo(0,this.height),n.closePath(),n.fillStyle=r.toLive?r.toLive(n,this):r,e&&n.transform(i[0],i[1],i[2],i[3],i[4]+(r.offsetX||0),i[5]+(r.offsetY||0)),u=r.gradientTransform||r.patternTransform,u&&n.transform(u[0],u[1],u[2],u[3],u[4],u[5]),n.fill(),n.restore()),f&&(n.save(),e&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]),f.render(n),n.restore()))},_renderBackground:function(n){this._renderBackgroundOrOverlay(n,"background")},_renderOverlay:function(n){this._renderBackgroundOrOverlay(n,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(n){return this._centerObject(n,new fabric.Point(this.getCenter().left,n.getCenterPoint().y))},centerObjectV:function(n){return this._centerObject(n,new fabric.Point(n.getCenterPoint().x,this.getCenter().top))},centerObject:function(n){var t=this.getCenter();return this._centerObject(n,new fabric.Point(t.left,t.top))},viewportCenterObject:function(n){var t=this.getVpCenter();return this._centerObject(n,t)},viewportCenterObjectH:function(n){var t=this.getVpCenter();return this._centerObject(n,new fabric.Point(t.x,n.getCenterPoint().y)),this},viewportCenterObjectV:function(n){var t=this.getVpCenter();return this._centerObject(n,new fabric.Point(n.getCenterPoint().x,t.y))},getVpCenter:function(){var n=this.getCenter(),t=u(this.viewportTransform);return i({x:n.left,y:n.top},t)},_centerObject:function(n,t){return n.setPositionByOrigin(t,"center","center"),n.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(n){return this.toDatalessObject(n)},toObject:function(n){return this._toObjectMethod("toObject",n)},toDatalessObject:function(n){return this._toObjectMethod("toDatalessObject",n)},_toObjectMethod:function(n,i){var u=this.clipPath,r={version:fabric.version,objects:this._toObjects(n,i)};return u&&(r.clipPath=this._toObject(this.clipPath,n,i)),t(r,this.__serializeBgOverlay(n,i)),fabric.util.populateWithProperties(this,r,i),r},_toObjects:function(n,t){return this._objects.filter(function(n){return!n.excludeFromExport}).map(function(i){return this._toObject(i,n,t)},this)},_toObject:function(n,t,i){var r,u;return this.includeDefaultValues||(r=n.includeDefaultValues,n.includeDefaultValues=!1),u=n[t](i),this.includeDefaultValues||(n.includeDefaultValues=r),u},__serializeBgOverlay:function(n,t){var i={},r=this.backgroundImage,u=this.overlayImage;return this.backgroundColor&&(i.background=this.backgroundColor.toObject?this.backgroundColor.toObject(t):this.backgroundColor),this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(t):this.overlayColor),r&&!r.excludeFromExport&&(i.backgroundImage=this._toObject(r,n,t)),u&&!u.excludeFromExport&&(i.overlayImage=this._toObject(u,n,t)),i},svgViewportTransformation:!0,toSVG:function(n,t){n||(n={});n.reviver=t;var i=[];return this._setSVGPreamble(i,n),this._setSVGHeader(i,n),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",t),this._setSVGObjects(i,t),this.clipPath&&i.push("<\/g>\n"),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",t),i.push("<\/svg>"),i.join("")},_setSVGPreamble:function(n,t){t.suppressPreamble||n.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(n,t){var i,e=t.width||this.width,o=t.height||this.height,f='viewBox="0 0 '+this.width+" "+this.height+'" ',u=fabric.Object.NUM_FRACTION_DIGITS;t.viewBox?f='viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,f='viewBox="'+r(-i[4]/i[0],u)+" "+r(-i[5]/i[3],u)+" "+r(this.width/i[0],u)+" "+r(this.height/i[3],u)+'" ');n.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e,'" ','height="',o,'" ',f,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"<\/desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),"<\/defs>\n")},createSVGClipPathMarkup:function(n){var t=this.clipPath;return t?(t.clipPathId="CLIPPATH_"+fabric.Object.__uid++,'<clipPath id="'+t.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(n.reviver)+"<\/clipPath>\n"):""},createSVGRefElementsMarkup:function(){var n=this,t=["background","overlay"].map(function(t){var i=n[t+"Color"];if(i&&i.toLive){var r=n[t+"Vpt"],u=n.viewportTransform,f={width:n.width/(r?u[0]:1),height:n.height/(r?u[3]:1)};return i.toSVG(f,{additionalTransform:r?fabric.util.matrixToSVG(u):""})}});return t.join("")},createSVGFontFacesMarkup:function(){for(var t,n,f,e,h,c,l,i="",r={},o=fabric.fontPaths,v=this._objects,s,u=0,a=v.length;a>u;u++)if(t=v[u],n=t.fontFamily,-1!==t.type.indexOf("text")&&!r[n]&&o[n]&&(r[n]=!0,t.styles)){f=t.styles;for(h in f){e=f[h];for(l in e)c=e[l],n=c.fontFamily,!r[n]&&o[n]&&(r[n]=!0)}}for(s in r)i+=["\t\t@font-face {\n","\t\t\tfont-family: '",s,"';\n","\t\t\tsrc: url('",o[s],"');\n","\t\t}\n"].join("");return i&&(i=['\t<style type="text/css">',"<![CDATA[\n",i,"]\]>","<\/style>\n"].join("")),i},_setSVGObjects:function(n,t){for(var r,f=this._objects,i=0,u=f.length;u>i;i++)r=f[i],r.excludeFromExport||this._setSVGObject(n,r,t)},_setSVGObject:function(n,t,i){n.push(t.toSVG(i))},_setSVGBgOverlayImage:function(n,t,i){this[t]&&!this[t].excludeFromExport&&this[t].toSVG&&n.push(this[t].toSVG(i))},_setSVGBgOverlayColor:function(n,t){var i=this[t+"Color"],e=this.viewportTransform,u=this.width,f=this.height;if(i)if(i.toLive){var r=i.repeat,o=fabric.util.invertTransform(e),s=this[t+"Vpt"],h=s?fabric.util.matrixToSVG(o):"";n.push('<rect transform="'+h+" translate(",u/2,",",f/2,')"',' x="',i.offsetX-u/2,'" y="',i.offsetY-f/2,'" ','width="',"repeat-y"===r||"no-repeat"===r?i.source.width:u,'" height="',"repeat-x"===r||"no-repeat"===r?i.source.height:f,'" fill="url(#SVGID_'+i.id+')"',"><\/rect>\n")}else n.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',"><\/rect>\n")},sendToBack:function(t){if(!t)return this;var i,r,u,f=this._activeObject;if(t===f&&"activeSelection"===t.type)for(u=f._objects,i=u.length;i--;)r=u[i],n(this._objects,r),this._objects.unshift(r);else n(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(t){if(!t)return this;var i,r,u,f=this._activeObject;if(t===f&&"activeSelection"===t.type)for(u=f._objects,i=0;i<u.length;i++)r=u[i],n(this._objects,r),this._objects.push(r);else n(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(t,i){if(!t)return this;var u,f,r,e,o,s=this._activeObject,h=0;if(t===s&&"activeSelection"===t.type)for(o=s._objects,u=0;u<o.length;u++)f=o[u],r=this._objects.indexOf(f),r>0+h&&(e=r-1,n(this._objects,f),this._objects.splice(e,0,f)),h++;else r=this._objects.indexOf(t),0!==r&&(e=this._findNewLowerIndex(t,r,i),n(this._objects,t),this._objects.splice(e,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t-1;r>=0;--r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t-1;return u},bringForward:function(t,i){if(!t)return this;var e,u,r,f,o,s=this._activeObject,h=0;if(t===s&&"activeSelection"===t.type)for(o=s._objects,e=o.length;e--;)u=o[e],r=this._objects.indexOf(u),r<this._objects.length-1-h&&(f=r+1,n(this._objects,u),this._objects.splice(f,0,u)),h++;else r=this._objects.indexOf(t),r!==this._objects.length-1&&(f=this._findNewUpperIndex(t,r,i),n(this._objects,t),this._objects.splice(f,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(n,t,i){var u,r,f,e;if(i){for(u=t,r=t+1,f=this._objects.length;f>r;++r)if(e=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),e){u=r;break}}else u=t+1;return u},moveTo:function(t,i){return n(this._objects,t),this._objects.splice(i,0,t),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(n){n.dispose&&n.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,fabric.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}});t(fabric.StaticCanvas.prototype,fabric.Observable);t(fabric.StaticCanvas.prototype,fabric.Collection);t(fabric.StaticCanvas.prototype,fabric.DataURLExporter);t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(n){var t=e(),i;if(!t||!t.getContext||(i=t.getContext("2d"),!i))return null;switch(n){case"setLineDash":return"undefined"!=typeof i.setLineDash;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var n=f(this.lowerCanvasEl);return n&&n.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(n){var t=f(this.lowerCanvasEl);return t&&t.createJPEGStream(n)})}();!function(){var u=fabric.util.getPointer,f=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,r=Math.atan2,n=Math.abs,o=fabric.StaticCanvas.supports("setLineDash"),t=.5,i;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(n,t){t||(t={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(n,t);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_chooseObjectsToRender:function(){var t,n,i,u=this.getActiveObjects(),r,f;if(u.length>0&&!this.preserveObjectStacking){for(n=[],i=[],r=0,f=this._objects.length;f>r;r++)t=this._objects[r],-1===u.indexOf(t)?n.push(t):i.push(t);u.length>1&&(this._activeObject._objects=i);n.push.apply(n,i)}else n=this._objects;return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);this.hasLostContext&&this.renderTopLayer(this.contextTop);var n=this.contextContainer;return this.renderCanvas(n,this._chooseObjectsToRender()),this},renderTopLayer:function(n){n.save();this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0);this.selection&&this._groupSelector&&(this._drawSelection(n),this.contextTopDirty=!0);n.restore()},renderTop:function(){var n=this.contextTop;return this.clearContext(n),this.renderTopLayer(n),this.fire("after:render"),this},_resetCurrentTransform:function(){var n=this._currentTransform;n.target.set({scaleX:n.original.scaleX,scaleY:n.original.scaleY,skewX:n.original.skewX,skewY:n.original.skewY,left:n.original.left,top:n.original.top});this._shouldCenterTransform(n.target)?("center"!==n.originX&&(n.mouseXSign="right"===n.originX?-1:1),"center"!==n.originY&&(n.mouseYSign="bottom"===n.originY?-1:1),n.originX="center",n.originY="center"):(n.originX=n.original.originX,n.originY=n.original.originY)},containsPoint:function(n,t,i){var u,r=i||this.getPointer(n,!0);return u=t.group&&t.group===this._activeObject&&"activeSelection"===t.group.type?this._normalizePointer(t.group,r):{x:r.x,y:r.y},t.containsPoint(u)||t._findTargetCorner(r)},_normalizePointer:function(n,t){var i=n.calcTransformMatrix(),r=fabric.util.invertTransform(i),u=this.restorePointerVpt(t);return fabric.util.transformPoint(u,r)},isTargetTransparent:function(n,t,i){var s;if(n.shouldCache()&&n._cacheCanvas&&n!==this._activeObject){var f=this._normalizePointer(n,{x:t,y:i}),e=Math.max(n.cacheTranslationX+f.x*n.zoomX,0),o=Math.max(n.cacheTranslationY+f.y*n.zoomY,0),s=fabric.util.isTransparent(n._cacheContext,Math.round(e),Math.round(o),this.targetFindTolerance);return s}var r=this.contextCache,h=n.selectionBackgroundColor,u=this.viewportTransform;return n.selectionBackgroundColor="",this.clearContext(r),r.save(),r.transform(u[0],u[1],u[2],u[3],u[4],u[5]),n.render(r),r.restore(),n===this._activeObject&&n._renderControls(r,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),n.selectionBackgroundColor=h,fabric.util.isTransparent(r,t,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(n){return"[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(t){return n[t]===!0}):n[this.selectionKey]},_shouldClearSelection:function(n,t){var r=this.getActiveObjects(),i=this._activeObject;return!t||t&&i&&r.length>1&&-1===r.indexOf(t)&&i!==t&&!this._isSelectionKeyPressed(n)||t&&!t.evented||t&&!t.selectable&&i&&i!==t},_shouldCenterTransform:function(n){if(n){var i,t=this._currentTransform;return"scale"===t.action||"scaleX"===t.action||"scaleY"===t.action?i=this.centeredScaling||n.centeredScaling:"rotate"===t.action&&(i=this.centeredRotation||n.centeredRotation),i?!t.altKey:t.altKey}},_getOriginFromCorner:function(n,t){var i={x:n.originX,y:n.originY};return"ml"===t||"tl"===t||"bl"===t?i.x="right":("mr"===t||"tr"===t||"br"===t)&&(i.x="left"),"tl"===t||"mt"===t||"tr"===t?i.y="bottom":("bl"===t||"mb"===t||"br"===t)&&(i.y="top"),i},_getActionFromCorner:function(n,t,i){if(!t||!n)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(n,t,i){if(t){var r=this.getPointer(n),e=t._findTargetCorner(this.getPointer(n,!0)),o=this._getActionFromCorner(i,e,n,t),u=this._getOriginFromCorner(t,e);this._currentTransform={target:t,action:o,corner:e,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,offsetX:r.x-t.left,offsetY:r.y-t.top,originX:u.x,originY:u.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:f(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:n.shiftKey,altKey:n[this.centeredKey],original:fabric.util.saveObjectTransform(t)};this._currentTransform.original.originX=u.x;this._currentTransform.original.originY=u.y;this._resetCurrentTransform();this._beforeTransform(n)}},_translateObject:function(n,t){var r=this._currentTransform,i=r.target,u=n-r.offsetX,f=t-r.offsetY,e=!i.get("lockMovementX")&&i.left!==u,o=!i.get("lockMovementY")&&i.top!==f;return e&&i.set("left",u),o&&i.set("top",f),e||o},_changeSkewTransformOrigin:function(n,t,i){var e="originX",u={0:"center"},r=t.target.skewX,o="left",s="right",h="mt"===t.corner||"ml"===t.corner?1:-1,f=1;n=n>0?1:-1;"y"===i&&(r=t.target.skewY,o="top",s="bottom",e="originY");u[-1]=o;u[1]=s;t.target.flipX&&(f*=-1);t.target.flipY&&(f*=-1);0===r?(t.skewSign=-h*n*f,t[e]=u[-n]):(r=r>0?1:-1,t.skewSign=r,t[e]=u[r*h*f])},_skewObject:function(n,t,i){var r=this._currentTransform,u=r.target,f=!1,s=u.get("lockSkewingX"),h=u.get("lockSkewingY");if(s&&"x"===i||h&&"y"===i)return!1;var e,o,c=u.getCenterPoint(),l=u.toLocalPoint(new fabric.Point(n,t),"center","center")[i],a=u.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[i],v=u._getTransformedDimensions();return this._changeSkewTransformOrigin(l-a,r,i),e=u.toLocalPoint(new fabric.Point(n,t),r.originX,r.originY)[i],o=u.translateToOriginPoint(c,r.originX,r.originY),f=this._setObjectSkew(e,r,i,v),r.lastX=n,r.lastY=t,u.setPositionByOrigin(o,r.originX,r.originY),f},_setObjectSkew:function(n,t,i,r){var f,v,h,o,e,s,c,l,a,u=t.target,y=!1,p=t.skewSign;return"x"===i?(o="y",e="Y",s="X",l=0,a=u.skewY):(o="x",e="X",s="Y",l=u.skewX,a=0),h=u._getTransformedDimensions(l,a),c=2*Math.abs(n)-h[i],2>=c?f=0:(f=p*Math.atan(c/u["scale"+s]/(h[o]/u["scale"+e])),f=fabric.util.radiansToDegrees(f)),y=u["skew"+s]!==f,u.set("skew"+s,f),0!==u["skew"+e]&&(v=u._getTransformedDimensions(),f=r[o]/v[o]*u["scale"+e],u.set("scale"+e,f)),y},_scaleObject:function(n,t,i){var r=this._currentTransform,u=r.target,f=u.lockScalingX,e=u.lockScalingY,h=u.lockScalingFlip;if(f&&e)return!1;var c=u.translateToOriginPoint(u.getCenterPoint(),r.originX,r.originY),o=u.toLocalPoint(new fabric.Point(n,t),r.originX,r.originY),l=u._getTransformedDimensions(),s=!1;return this._setLocalMouse(o,r),s=this._setObjectScale(o,r,f,e,i,h,l),u.setPositionByOrigin(c,r.originX,r.originY),s},_setObjectScale:function(n,t,i,r,u,f,e){var o=t.target,l=!1,a=!1,s=!1,h=n.x*o.scaleX/e.x,c=n.y*o.scaleY/e.y,y=o.scaleX!==h,p=o.scaleY!==c,v;return(t.newScaleX=h,t.newScaleY=c,"x"===u&&o instanceof fabric.Textbox)?(v=o.width*(n.x/e.x),v>=o.getMinWidth()?(s=v!==o.width,o.set("width",v),s):!1):(f&&0>=h&&h<o.scaleX&&(l=!0,n.x=0),f&&0>=c&&c<o.scaleY&&(a=!0,n.y=0),"equally"!==u||i||r?u?"x"!==u||o.get("lockUniScaling")?"y"!==u||o.get("lockUniScaling")||a||r||o.set("scaleY",c)&&(s=p):l||i||o.set("scaleX",h)&&(s=y):(l||i||o.set("scaleX",h)&&(s=s||y),a||r||o.set("scaleY",c)&&(s=s||p)):s=this._scaleObjectEqually(n,o,t,e),l||a||this._flipObject(t,u),s)},_scaleObjectEqually:function(n,t,i,r){var e,u,f,o=n.y+n.x,s=r.y*i.original.scaleY/t.scaleY+r.x*i.original.scaleX/t.scaleX,h=n.x<0?-1:1,c=n.y<0?-1:1;return u=h*Math.abs(i.original.scaleX*o/s),f=c*Math.abs(i.original.scaleY*o/s),e=u!==t.scaleX||f!==t.scaleY,t.set("scaleX",u),t.set("scaleY",f),e},_flipObject:function(n,t){n.newScaleX<0&&"y"!==t&&("left"===n.originX?n.originX="right":"right"===n.originX&&(n.originX="left"));n.newScaleY<0&&"x"!==t&&("top"===n.originY?n.originY="bottom":"bottom"===n.originY&&(n.originY="top"))},_setLocalMouse:function(t,i){var u=i.target,f=this.getZoom(),r=u.padding/f;"right"===i.originX?t.x*=-1:"center"===i.originX&&(t.x*=2*i.mouseXSign,t.x<0&&(i.mouseXSign=-i.mouseXSign));"bottom"===i.originY?t.y*=-1:"center"===i.originY&&(t.y*=2*i.mouseYSign,t.y<0&&(i.mouseYSign=-i.mouseYSign));n(t.x)>r?t.x<0?t.x+=r:t.x-=r:t.x=0;n(t.y)>r?t.y<0?t.y+=r:t.y-=r:t.y=0},_rotateObject:function(n,t){var f=this._currentTransform,u=f.target,o=u.translateToOriginPoint(u.getCenterPoint(),f.originX,f.originY);if(u.lockRotation)return!1;var v=r(f.ey-o.y,f.ex-o.x),y=r(t-o.y,n-o.x),i=e(y-v+f.theta),h=!0;if(u.snapAngle>0){var s=u.snapAngle,c=u.snapThreshold||s,l=Math.ceil(i/s)*s,a=Math.floor(i/s)*s;Math.abs(i-a)<c?i=a:Math.abs(i-l)<c&&(i=l)}return 0>i&&(i=360+i),i%=360,u.angle===i?h=!1:(u.angle=i,u.setPositionByOrigin(o,f.originX,f.originY)),h},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_drawSelection:function(i){var f=this._groupSelector,h=f.left,c=f.top,e=n(h),s=n(c),r,u;(this.selectionColor&&(i.fillStyle=this.selectionColor,i.fillRect(f.ex-(h>0?0:-h),f.ey-(c>0?0:-c),e,s)),this.selectionLineWidth&&this.selectionBorderColor)&&((i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!o)?(r=f.ex+t-(h>0?0:e),u=f.ey+t-(c>0?0:s),i.beginPath(),fabric.util.drawDashedLine(i,r,u,r+e,u,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u+s-1,r+e,u+s-1,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u,r,u+s,this.selectionDashArray),fabric.util.drawDashedLine(i,r+e-1,u,r+e-1,u+s,this.selectionDashArray),i.closePath(),i.stroke()):(fabric.Object.prototype._setLineDash.call(this,i,this.selectionDashArray),i.strokeRect(f.ex+t-(h>0?0:e),f.ey+t-(c>0?0:s),e,s)))},findTarget:function(n,t){var r;if(!this.skipTargetFind){var u,o,f=this.getPointer(n,!0),i=this._activeObject,e=this.getActiveObjects();if((this.targets=[],e.length>1&&!t&&i===this._searchPossibleTargets([i],f))||1===e.length&&i._findTargetCorner(f))return i;if(1===e.length&&i===this._searchPossibleTargets([i],f)){if(!this.preserveObjectStacking)return i;u=i;o=this.targets;this.targets=[]}return r=this._searchPossibleTargets(this._objects,f),n[this.altSelectionKey]&&r&&u&&r!==u&&(r=u,this.targets=o),r}},_checkTarget:function(n,t,i){if(t&&t.visible&&t.evented&&this.containsPoint(null,t,n)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;var r=this.isTargetTransparent(t,i.x,i.y);if(!r)return!0}},_searchPossibleTargets:function(n,t){for(var i,f,r,e,u=n.length;u--;)if(r=n[u],e=r.group&&"activeSelection"!==r.group.type?this._normalizePointer(r.group,t):t,this._checkTarget(e,r,t)){i=n[u];i.subTargetCheck&&i instanceof fabric.Group&&(f=this._searchPossibleTargets(i._objects,t),f&&this.targets.push(f));break}return i},restorePointerVpt:function(n){return fabric.util.transformPoint(n,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(n,t){if(this._absolutePointer&&!t)return this._absolutePointer;if(this._pointer&&t)return this._pointer;var o,r=u(n),s=this.upperCanvasEl,i=s.getBoundingClientRect(),f=i.width||0,e=i.height||0;return f&&e||("top"in i&&"bottom"in i&&(e=Math.abs(i.top-i.bottom)),"right"in i&&"left"in i&&(f=Math.abs(i.right-i.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,t||(r=this.restorePointerVpt(r)),o=0===f||0===e?{width:1,height:1}:{width:s.width/f,height:s.height/e},{x:r.x*o.width,y:r.y*o.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+n);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var t=this.width||n.width,i=this.height||n.height;fabric.util.setStyle(n,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"});n.width=t;n.height=i;fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,t){t.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var n=this._activeObject;return n?"activeSelection"===n.type&&n._objects?n._objects.slice(0):[n]:[]},_onObjectRemoved:function(n){n===this._activeObject&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared",{target:n}),n.fire("deselected"));this._hoveredTarget===n&&(this._hoveredTarget=null);this.callSuper("_onObjectRemoved",n)},_fireSelectionEvents:function(n,t){var e=!1,r=this.getActiveObjects(),u=[],f=[],i={e:t};n.forEach(function(n){-1===r.indexOf(n)&&(e=!0,n.fire("deselected",i),f.push(n))});r.forEach(function(t){-1===n.indexOf(t)&&(e=!0,t.fire("selected",i),u.push(t))});n.length>0&&r.length>0?(i.selected=u,i.deselected=f,i.updated=u[0]||f[0],i.target=this._activeObject,e&&this.fire("selection:updated",i)):r.length>0?(1===r.length&&(i.target=u[0],this.fire("object:selected",i)),i.selected=u,i.target=this._activeObject,this.fire("selection:created",i)):n.length>0&&(i.deselected=f,this.fire("selection:cleared",i))},setActiveObject:function(n,t){var i=this.getActiveObjects();return this._setActiveObject(n,t),this._fireSelectionEvents(i,t),this},_setActiveObject:function(n,t){return this._activeObject===n?!1:this._discardActiveObject(t,n)?n.onSelect({e:t})?!1:(this._activeObject=n,!0):!1},_discardActiveObject:function(n,t){var i=this._activeObject;if(i){if(i.onDeselect({e:n,object:t}))return!1;this._activeObject=null}return!0},discardActiveObject:function(n){var t=this.getActiveObjects(),i=this.getActiveObject();return t.length&&this.fire("before:selection:cleared",{target:i,e:n}),this._discardActiveObject(n),this._fireSelectionEvents(t,n),this},dispose:function(){var n=this.wrapperEl;return this.removeListeners(),n.removeChild(this.upperCanvasEl),n.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(n){fabric.util.cleanUpJsdomNode(this[n]);this[n]=void 0}.bind(this)),n.parentNode&&n.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(n){var t=this._activeObject;t&&t._renderControls(n)},_toObject:function(n,t,i){var r=this._realizeGroupTransformOnObject(n),u=this.callSuper("_toObject",n,t,i);return this._unwindGroupTransformOnObject(n,r),u},_realizeGroupTransformOnObject:function(n){if(n.group&&"activeSelection"===n.group.type&&this._activeObject===n.group){var t={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(i){t[i]=n[i]}),this._activeObject.realizeTransform(n),t}return null},_unwindGroupTransformOnObject:function(n,t){t&&n.set(t)},_setSVGObject:function(n,t,i){var r=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",n,t,i);this._unwindGroupTransformOnObject(t,r)},setViewportTransform:function(n){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop();fabric.StaticCanvas.prototype.setViewportTransform.call(this,n)}});for(i in fabric.StaticCanvas)"prototype"!==i&&(fabric.Canvas[i]=fabric.StaticCanvas[i]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}();!function(){function r(n,t){return"which"in n?n.which===t:n.button===t-1}var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},i=fabric.util.addListener,t=fabric.util.removeListener,u=3,f=2,o=1,n={passive:!1};fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners();this._bindEvents();this.addOrRemove(i,"add")},addOrRemove:function(t,i){var r=this.upperCanvasEl,u=this.enablePointerEvents?"pointer":"mouse";t(fabric.window,"resize",this._onResize);t(r,u+"down",this._onMouseDown);t(r,u+"move",this._onMouseMove,n);t(r,u+"out",this._onMouseOut);t(r,u+"enter",this._onMouseEnter);t(r,"wheel",this._onMouseWheel);t(r,"contextmenu",this._onContextMenu);t(r,"dblclick",this._onDoubleClick);t(r,"touchstart",this._onMouseDown,n);t(r,"touchmove",this._onMouseMove,n);t(r,"dragover",this._onDragOver);t(r,"dragenter",this._onDragEnter);t(r,"dragleave",this._onDragLeave);t(r,"drop",this._onDrop);"undefined"!=typeof eventjs&&i in eventjs&&(eventjs[i](r,"gesture",this._onGesture),eventjs[i](r,"drag",this._onDrag),eventjs[i](r,"orientation",this._onOrientationChange),eventjs[i](r,"shake",this._onShake),eventjs[i](r,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var i=this.enablePointerEvents?"pointer":"mouse";t(fabric.document,i+"up",this._onMouseUp);t(fabric.document,"touchend",this._onMouseUp,n);t(fabric.document,i+"move",this._onMouseMove,n);t(fabric.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(n,t){this.__onTransformGesture&&this.__onTransformGesture(n,t)},_onDrag:function(n,t){this.__onDrag&&this.__onDrag(n,t)},_onMouseWheel:function(n){this.__onMouseWheel(n)},_onMouseOut:function(n){var t=this._hoveredTarget;this.fire("mouse:out",{target:t,e:n});this._hoveredTarget=null;t&&t.fire("mouseout",{e:n});this._iTextInstances&&this._iTextInstances.forEach(function(n){n.isEditing&&n.hiddenTextarea.focus()})},_onMouseEnter:function(n){this.currentTransform||this.findTarget(n)||(this.fire("mouse:over",{target:null,e:n}),this._hoveredTarget=null)},_onOrientationChange:function(n,t){this.__onOrientationChange&&this.__onOrientationChange(n,t)},_onShake:function(n,t){this.__onShake&&this.__onShake(n,t)},_onLongPress:function(n,t){this.__onLongPress&&this.__onLongPress(n,t)},_onDragOver:function(n){n.preventDefault();var t=this._simpleEventHandler("dragover",n);this._fireEnterLeaveEvents(t,n)},_onContextMenu:function(n){return this.stopContextMenu&&(n.stopPropagation(),n.preventDefault()),!1},_onDoubleClick:function(n){this._cacheTransformEventData(n);this._handleEvent(n,"dblclick");this._resetTransformEventData(n)},_onMouseDown:function(r){this.__onMouseDown(r);this._resetTransformEventData();i(fabric.document,"touchend",this._onMouseUp,n);i(fabric.document,"touchmove",this._onMouseMove,n);var f=this.upperCanvasEl,u=this.enablePointerEvents?"pointer":"mouse";t(f,u+"move",this._onMouseMove,n);t(f,"touchmove",this._onMouseMove,n);"touchstart"===r.type?t(f,u+"down",this._onMouseDown):(i(fabric.document,u+"up",this._onMouseUp),i(fabric.document,u+"move",this._onMouseMove,n))},_onMouseUp:function(r){var f,u,e;this.__onMouseUp(r);this._resetTransformEventData();f=this.upperCanvasEl;u=this.enablePointerEvents?"pointer":"mouse";(t(fabric.document,u+"up",this._onMouseUp),t(fabric.document,"touchend",this._onMouseUp,n),t(fabric.document,u+"move",this._onMouseMove,n),t(fabric.document,"touchmove",this._onMouseMove,n),i(f,u+"move",this._onMouseMove,n),i(f,"touchmove",this._onMouseMove,n),"touchend"===r.type)&&(e=this,setTimeout(function(){i(e.upperCanvasEl,u+"down",e._onMouseDown)},400))},_onMouseMove:function(n){!this.allowTouchScrolling&&n.preventDefault&&n.preventDefault();this.__onMouseMove(n)},_onResize:function(){this.calcOffset()},_shouldRender:function(n){var t=this._activeObject;return!!t!=!!n||t&&n&&t!==n?!0:t&&t.isEditing?!1:!1},__onMouseUp:function(n){var t,h=this._currentTransform,s=this._groupSelector,e=!1,i=!s||0===s.left&&0===s.top;return this._cacheTransformEventData(n),t=this._target,this._handleEvent(n,"up:before"),r(n,u)?void(this.fireRightClick&&this._handleEvent(n,"up",u,i)):r(n,f)?(this.fireMiddleClick&&this._handleEvent(n,"up",f,i),void this._resetTransformEventData()):this.isDrawingMode&&this._isCurrentlyDrawing?void this._onMouseUpInDrawingMode(n):(h&&(this._finalizeCurrentTransform(n),e=h.actionPerformed),i||(this._maybeGroupObjects(n),e||(e=this._shouldRender(t))),t&&(t.isMoving=!1),this._setCursorFromEvent(n,t),this._handleEvent(n,"up",o,i),this._groupSelector=null,this._currentTransform=null,t&&(t.__corner=0),void(e?this.requestRenderAll():i||this.renderTop()))},_simpleEventHandler:function(n,t){var i=this.findTarget(t),r=this.targets,f={e:t,target:i,subTargets:r},u;if(this.fire(n,f),i&&i.fire(n,f),!r)return i;for(u=0;u<r.length;u++)r[u].fire(n,f);return i},_handleEvent:function(n,t,i,r){var f=this._target,e=this.targets||[],s={e:n,target:f,subTargets:e,button:i||o,isClick:r||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform},u;for(this.fire("mouse:"+t,s),f&&f.fire("mouse"+t,s),u=0;u<e.length;u++)e[u].fire("mouse"+t,s)},_finalizeCurrentTransform:function(n){var u,t=this._currentTransform,i=t.target,r={e:n,target:i,transform:t};i._scaling&&(i._scaling=!1);i.setCoords();(t.actionPerformed||this.stateful&&i.hasStateChanged())&&(t.actionPerformed&&(u=this._addEventOptions(r,t),this._fire(u,r)),this._fire("modified",r))},_addEventOptions:function(n,t){var i,r;switch(t.action){case"scaleX":i="scaled";r="x";break;case"scaleY":i="scaled";r="y";break;case"skewX":i="skewed";r="x";break;case"skewY":i="skewed";r="y";break;case"scale":i="scaled";r="equally";break;case"rotate":i="rotated";break;case"drag":i="moved"}return n.by=r,i},_onMouseDownInDrawingMode:function(n){this._isCurrentlyDrawing=!0;this.getActiveObject()&&this.discardActiveObject(n).requestRenderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=this.getPointer(n);this.freeDrawingBrush.onMouseDown(t,{e:n,pointer:t});this._handleEvent(n,"down")},_onMouseMoveInDrawingMode:function(n){if(this._isCurrentlyDrawing){var t=this.getPointer(n);this.freeDrawingBrush.onMouseMove(t,{e:n,pointer:t})}this.setCursor(this.freeDrawingCursor);this._handleEvent(n,"move")},_onMouseUpInDrawingMode:function(n){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();var t=this.getPointer(n);this.freeDrawingBrush.onMouseUp({e:n,pointer:t});this._handleEvent(n,"up")},__onMouseDown:function(n){var t,i,o,e,s;if(this._cacheTransformEventData(n),this._handleEvent(n,"down:before"),t=this._target,r(n,u))return void(this.fireRightClick&&this._handleEvent(n,"down",u));if(r(n,f))return void(this.fireMiddleClick&&this._handleEvent(n,"down",f));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(n);this._currentTransform||(i=this._pointer,this._previousPointer=i,o=this._shouldRender(t),e=this._shouldGroup(n,t),(this._shouldClearSelection(n,t)?this.discardActiveObject(n):e&&(this._handleGrouping(n,t),t=this._activeObject),!this.selection||t&&(t.selectable||t.isEditing||t===this._activeObject)||(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0}),t)&&(s=t===this._activeObject,t.selectable&&this.setActiveObject(t,n),t!==this._activeObject||!t.__corner&&e||this._setupCurrentTransform(n,t,s)),this._handleEvent(n,"down"),(o||e)&&this.requestRenderAll())},_resetTransformEventData:function(){this._target=null;this._pointer=null;this._absolutePointer=null},_cacheTransformEventData:function(n){this._resetTransformEventData();this._pointer=this.getPointer(n,!0);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(n)||null},_beforeTransform:function(n){var t=this._currentTransform;this.stateful&&t.target.saveState();this.fire("before:transform",{e:n,transform:t});t.corner&&this.onBeforeScaleRotate(t.target)},__onMouseMove:function(n){var i,r,t;if(this._handleEvent(n,"move:before"),this._cacheTransformEventData(n),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(n);"undefined"!=typeof n.touches&&n.touches.length>1||(t=this._groupSelector,t?(r=this._pointer,t.left=r.x-t.ex,t.top=r.y-t.ey,this.renderTop()):this._currentTransform?this._transformObject(n):(i=this.findTarget(n)||null,this._setCursorFromEvent(n,i),this._fireOverOutEvents(i,n)),this._handleEvent(n,"move"),this._resetTransformEventData())},_fireOverOutEvents:function(n,t){this.fireSyntheticInOutEvents(n,t,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(n,t){this.fireSyntheticInOutEvents(n,t,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSyntheticInOutEvents:function(n,t,i){var u,f,o,s,r=this[i.targetName],e=r!==n,h=i.canvasEvtIn,c=i.canvasEvtOut;e&&(u={e:t,target:n,previousTarget:r},f={e:t,target:r,nextTarget:n},this[i.targetName]=n);s=n&&e;o=r&&e;o&&(c&&this.fire(c,f),r.fire(i.evtOut,f));s&&(h&&this.fire(h,u),n.fire(i.evtIn,u))},__onMouseWheel:function(n){this._cacheTransformEventData(n);this._handleEvent(n,"wheel");this._resetTransformEventData()},_transformObject:function(n){var i=this.getPointer(n),t=this._currentTransform;t.reset=!1;t.target.isMoving=!0;t.shiftKey=n.shiftKey;t.altKey=n[this.centeredKey];this._beforeScaleTransform(n,t);this._performTransformAction(n,t,i);t.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(n,t,i){var f=i.x,e=i.y,o=t.action,r=!1,u={target:t.target,e:n,transform:t,pointer:i};"rotate"===o?(r=this._rotateObject(f,e))&&this._fire("rotating",u):"scale"===o?(r=this._onScale(n,t,f,e))&&this._fire("scaling",u):"scaleX"===o?(r=this._scaleObject(f,e,"x"))&&this._fire("scaling",u):"scaleY"===o?(r=this._scaleObject(f,e,"y"))&&this._fire("scaling",u):"skewX"===o?(r=this._skewObject(f,e,"x"))&&this._fire("skewing",u):"skewY"===o?(r=this._skewObject(f,e,"y"))&&this._fire("skewing",u):(r=this._translateObject(f,e),r&&(this._fire("moving",u),this.setCursor(u.target.moveCursor||this.moveCursor)));t.actionPerformed=t.actionPerformed||r},_fire:function(n,t){this.fire("object:"+n,t);t.target.fire(n,t)},_beforeScaleTransform:function(n,t){if("scale"===t.action||"scaleX"===t.action||"scaleY"===t.action){var i=this._shouldCenterTransform(t.target);(i&&("center"!==t.originX||"center"!==t.originY)||!i&&"center"===t.originX&&"center"===t.originY)&&(this._resetCurrentTransform(),t.reset=!0)}},_onScale:function(n,t,i,r){return this._isUniscalePossible(n,t.target)?(t.currentAction="scale",this._scaleObject(i,r)):(t.reset||"scale"!==t.currentAction||this._resetCurrentTransform(),t.currentAction="scaleEqually",this._scaleObject(i,r,"equally"))},_isUniscalePossible:function(n,t){return(n[this.uniScaleKey]||this.uniScaleTransform)&&!t.get("lockUniScaling")},_setCursorFromEvent:function(n,t){if(!t)return this.setCursor(this.defaultCursor),!1;var u=t.hoverCursor||this.hoverCursor,i=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!i||!i.contains(t))&&t._findTargetCorner(this.getPointer(n,!0));this.setCursor(r?this.getCornerCursor(r,t,n):u)},getCornerCursor:function(n,t,i){return this.actionIsDisabled(n,t,i)?this.notAllowedCursor:n in e?this._getRotatedCornerCursor(n,t,i):"mtr"===n&&t.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(n,t,i){return"mt"===n||"mb"===n?i[this.altActionKey]?t.lockSkewingX:t.lockScalingY:"ml"===n||"mr"===n?i[this.altActionKey]?t.lockSkewingY:t.lockScalingX:"mtr"===n?t.lockRotation:this._isUniscalePossible(i,t)?t.lockScalingX&&t.lockScalingY:t.lockScalingX||t.lockScalingY},_getRotatedCornerCursor:function(n,t,i){var r=Math.round(t.angle%360/45);return 0>r&&(r+=8),r+=e[n],i[this.altActionKey]&&e[n]%2==0&&(r+=2),r%=8,this.cursorMap[r]}})}();!function(){var n=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(n,t){var i=this._activeObject;return i&&this._isSelectionKeyPressed(n)&&t&&t.selectable&&this.selection&&(i!==t||"activeSelection"===i.type)&&!t.onSelect({e:n})},_handleGrouping:function(n,t){var i=this._activeObject;i.__corner||(t!==i||(t=this.findTarget(n,!0),t&&t.selectable))&&(i&&"activeSelection"===i.type?this._updateActiveSelection(t,n):this._createActiveSelection(t,n))},_updateActiveSelection:function(n,t){var i=this._activeObject,r=i._objects.slice(0);i.contains(n)?(i.removeWithUpdate(n),this._hoveredTarget=n,1===i.size()&&this._setActiveObject(i.item(0),t)):(i.addWithUpdate(n),this._hoveredTarget=i);this._fireSelectionEvents(r,t)},_createActiveSelection:function(n,t){var r=this.getActiveObjects(),i=this._createGroup(n);this._hoveredTarget=i;this._setActiveObject(i,t);this._fireSelectionEvents(r,t)},_createGroup:function(n){var t=this._objects,i=t.indexOf(this._activeObject)<t.indexOf(n),r=i?[this._activeObject,n]:[n,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(r,{canvas:this})},_groupSelectedObjects:function(n){var i,t=this._collectObjects(n);1===t.length?this.setActiveObject(t[0],n):t.length>1&&(i=new fabric.ActiveSelection(t.reverse(),{canvas:this}),this.setActiveObject(i,n))},_collectObjects:function(i){for(var r,u=[],f=this._groupSelector.ex,e=this._groupSelector.ey,o=f+this._groupSelector.left,s=e+this._groupSelector.top,h=new fabric.Point(n(f,o),n(e,s)),c=new fabric.Point(t(f,o),t(e,s)),l=!this.selectionFullyContained,v=f===o&&e===s,a=this._objects.length;a--&&(r=this._objects[a],!(r&&r.selectable&&r.visible&&(l&&r.intersectsWithRect(h,c)||r.isContainedWithinRect(h,c)||l&&r.containsPoint(h)||l&&r.containsPoint(c))&&(u.push(r),v))););return u.length>1&&(u=u.filter(function(n){return!n.onSelect({e:i})})),u},_maybeGroupObjects:function(n){this.selection&&this._groupSelector&&this._groupSelectedObjects(n);this.setCursor(this.defaultCursor);this._groupSelector=null}})}();!function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(n){n||(n={});var t=n.format||"png",i=n.quality||1,r=(n.multiplier||1)*(n.enableRetinaScaling?this.getRetinaScaling():1),u=this.toCanvasElement(r,n);return fabric.util.toDataURL(u,t,i)},toCanvasElement:function(n,t){n=n||1;t=t||{};var u=(t.width||this.width)*n,f=(t.height||this.height)*n,o=this.getZoom(),s=this.width,h=this.height,e=o*n,r=this.viewportTransform,c=(r[4]-(t.left||0))*n,l=(r[5]-(t.top||0))*n,a=this.interactive,v=[e,0,0,e,c,l],y=this.enableRetinaScaling,i=fabric.util.createCanvasElement(),p=this.contextTop;return i.width=u,i.height=f,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=u,this.height=f,this.calcViewportBoundaries(),this.renderCanvas(i.getContext("2d"),this._objects),this.viewportTransform=r,this.width=s,this.height=h,this.calcViewportBoundaries(),this.interactive=a,this.enableRetinaScaling=y,this.contextTop=p,i}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(n,t,i){return this.loadFromJSON(n,t,i)},loadFromJSON:function(n,t,i){if(n){var u="string"==typeof n?JSON.parse(n):fabric.util.object.clone(n),r=this,f=u.clipPath,e=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(n){r.clear();r._setBgOverlay(u,function(){f?r._enlivenObjects([f],function(i){r.clipPath=i[0];r.__setupCanvas.call(r,u,n,e,t)}):r.__setupCanvas.call(r,u,n,e,t)})},i),this}},__setupCanvas:function(n,t,i,r){var u=this;t.forEach(function(n,t){u.insertAt(n,t)});this.renderOnAddRemove=i;delete n.objects;delete n.backgroundImage;delete n.overlayImage;delete n.background;delete n.overlay;this._setOptions(n);this.renderAll();r&&r()},_setBgOverlay:function(n,t){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1},r;if(!(n.backgroundImage||n.overlayImage||n.background||n.overlay))return void(t&&t());r=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",n.backgroundImage,i,r);this.__setBgOverlay("overlayImage",n.overlayImage,i,r);this.__setBgOverlay("backgroundColor",n.background,i,r);this.__setBgOverlay("overlayColor",n.overlay,i,r)},__setBgOverlay:function(n,t,i,r){var u=this;return t?void("backgroundImage"===n||"overlayImage"===n?fabric.util.enlivenObjects([t],function(t){u[n]=t[0];i[n]=!0;r&&r()}):this["set"+fabric.util.string.capitalize(n,!0)](t,function(){i[n]=!0;r&&r()})):(i[n]=!0,void(r&&r()))},_enlivenObjects:function(n,t,i){return n&&0!==n.length?void fabric.util.enlivenObjects(n,function(n){t&&t(n)},null,i):void(t&&t([]))},_toDataURL:function(n,t){this.clone(function(i){t(i.toDataURL(n))})},_toDataURLWithMultiplier:function(n,t,i){this.clone(function(r){i(r.toDataURLWithMultiplier(n,t))})},clone:function(n,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){n&&n(t)})})},cloneWithoutData:function(n){var i=fabric.util.createCanvasElement(),t;i.width=this.width;i.height=this.height;t=new fabric.Canvas(i);t.clipTo=this.clipTo;this.backgroundImage?(t.setBackgroundImage(this.backgroundImage.src,function(){t.renderAll();n&&n(t)}),t.backgroundImageOpacity=this.backgroundImageOpacity,t.backgroundImageStretch=this.backgroundImageStretch):n&&n(t)}});!function(){var n=fabric.util.degreesToRadians,t=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(n,t){if(!this.isDrawingMode&&n.touches&&2===n.touches.length&&"gesture"===t.gesture){var i=this.findTarget(n);"undefined"!=typeof i&&(this.__gesturesParams={e:n,self:t,target:i},this.__gesturesRenderer());this.fire("touch:gesture",{target:i,e:n,self:t})}},__gesturesParams:null,__gesturesRenderer:function(){if(null!==this.__gesturesParams&&null!==this._currentTransform){var t=this.__gesturesParams.self,n=this._currentTransform,i=this.__gesturesParams.e;n.action="scale";n.originX=n.originY="center";this._scaleObjectBy(t.scale,i);0!==t.rotation&&(n.action="rotate",this._rotateObjectByAngle(t.rotation,i));this.requestRenderAll();n.action="drag"}},__onDrag:function(n,t){this.fire("touch:drag",{e:n,self:t})},__onOrientationChange:function(n,t){this.fire("touch:orientation",{e:n,self:t})},__onShake:function(n,t){this.fire("touch:shake",{e:n,self:t})},__onLongPress:function(n,t){this.fire("touch:longpress",{e:n,self:t})},_scaleObjectBy:function(n,t){var r=this._currentTransform,i=r.target,f=i.get("lockScalingX"),e=i.get("lockScalingY"),o,u;f&&e||(i._scaling=!0,o=i.translateToOriginPoint(i.getCenterPoint(),r.originX,r.originY),u=i._getTransformedDimensions(),this._setObjectScale(new fabric.Point(r.scaleX*u.x*n/i.scaleX,r.scaleY*u.y*n/i.scaleY),r,f,e,null,i.get("lockScalingFlip"),u),i.setPositionByOrigin(o,r.originX,r.originY),this._fire("scaling",{target:i,e:t,transform:r}))},_rotateObjectByAngle:function(i,r){var u=this._currentTransform;u.target.get("lockRotation")||(u.target.rotate(t(n(i)+u.theta)),this._fire("rotating",{target:u.target,e:r,transform:u}))}})}();!function(n){"use strict";var t=n.fabric||(n.fabric={}),f=t.util.object.extend,e=t.util.object.clone,i=t.util.toFixed,o=t.util.string.capitalize,r=t.util.degreesToRadians,s=t.StaticCanvas.supports("setLineDash"),h=!t.isLikelyNode,u=2;t.Object||(t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:h,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(n){n&&this.setOptions(n)},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=t.util.createCanvasElement();this._cacheContext=this._cacheCanvas.getContext("2d");this._updateCacheCanvas();this.dirty=!0},_limitCacheSize:function(n){var s=t.perfLimitSizeTotal,i=n.width,r=n.height,f=t.maxCacheSideLimit,u=t.minCacheSideLimit;if(f>=i&&f>=r&&s>=i*r)return u>i&&(n.width=u),u>r&&(n.height=u),n;var l=i/r,h=t.util.limitDimsByArea(l,s),c=t.util.capValue,e=c(u,h.x,f),o=c(u,h.y,f);return i>e&&(n.zoomX/=i/e,n.width=e,n.capped=!0),r>o&&(n.zoomY/=r/o,n.height=o,n.capped=!0),n},_getCacheCanvasDimensions:function(){var n=this.getTotalObjectScaling(),t=this._getTransformedDimensions(0,0),i=t.x*n.scaleX/this.scaleX,r=t.y*n.scaleY/this.scaleY;return{width:i+u,height:r+u,zoomX:n.scaleX,zoomY:n.scaleY,x:i,y:r}},_updateCacheCanvas:function(){var f=this.canvas,y,o;if(this.noScaleCache&&f&&f._currentTransform&&(y=f._currentTransform.target,o=f._currentTransform.action,this===y&&o.slice&&"scale"===o.slice(0,5)))return!1;var s,h,u=this._cacheCanvas,n=this._limitCacheSize(this._getCacheCanvasDimensions()),e=t.minCacheSideLimit,i=n.width,r=n.height,c=n.zoomX,l=n.zoomY,p=i!==this.cacheWidth||r!==this.cacheHeight,g=this.zoomX!==c||this.zoomY!==l,nt=p||g,w=0,b=0,k=!1;if(p){var a=this._cacheCanvas.width,v=this._cacheCanvas.height,d=i>a||r>v,tt=(.9*a>i||.9*v>r)&&a>e&&v>e;k=d||tt;d&&!n.capped&&(i>e||r>e)&&(w=.1*i,b=.1*r)}return nt?(k?(u.width=Math.ceil(i+w),u.height=Math.ceil(r+b)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,u.width,u.height)),s=n.x/2,h=n.y/2,this.cacheTranslationX=Math.round(u.width/2-s)+s,this.cacheTranslationY=Math.round(u.height/2-h)+h,this.cacheWidth=i,this.cacheHeight=r,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(c,l),this.zoomX=c,this.zoomY=l,!0):!1},setOptions:function(n){this._setOptions(n);this._initGradient(n.fill,"fill");this._initGradient(n.stroke,"stroke");this._initClipping(n);this._initPattern(n.fill,"fill");this._initPattern(n.stroke,"stroke")},transform:function(n){var t;t=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix();n.transform(t[0],t[1],t[2],t[3],t[4],t[5])},toObject:function(n){var r=t.Object.NUM_FRACTION_DIGITS,u={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:i(this.left,r),top:i(this.top,r),width:i(this.width,r),height:i(this.height,r),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,r),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,r),scaleX:i(this.scaleX,r),scaleY:i(this.scaleY,r),angle:i(this.angle,r),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,r),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:i(this.skewX,r),skewY:i(this.skewY,r)};return this.clipPath&&(u.clipPath=this.clipPath.toObject(n),u.clipPath.inverted=this.clipPath.inverted,u.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,u,n),this.includeDefaultValues||(u=this._removeDefaultValues(u)),u},toDatalessObject:function(n){return this.toObject(n)},_removeDefaultValues:function(n){var i=t.util.getKlass(n.type).prototype,r=i.stateProperties;return r.forEach(function(t){if("left"!==t&&"top"!==t){n[t]===i[t]&&delete n[t];var r="[object Array]"===Object.prototype.toString.call(n[t])&&"[object Array]"===Object.prototype.toString.call(i[t]);r&&0===n[t].length&&0===i[t].length&&delete n[t]}}),n},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){var t=this.scaleX,i=this.scaleY,n;return this.group&&(n=this.group.getObjectScaling(),t*=n.scaleX,i*=n.scaleY),{scaleX:t,scaleY:i}},getTotalObjectScaling:function(){var i=this.getObjectScaling(),r=i.scaleX,u=i.scaleY,n,t;return this.canvas&&(n=this.canvas.getZoom(),t=this.canvas.getRetinaScaling(),r*=n*t,u*=n*t),{scaleX:r,scaleY:u}},getObjectOpacity:function(){var n=this.opacity;return this.group&&(n*=this.group.getObjectOpacity()),n},_set:function(n,i){var u="scaleX"===n||"scaleY"===n,f=this[n]!==i,r=!1;return u&&(i=this._constrainScale(i)),"scaleX"===n&&0>i?(this.flipX=!this.flipX,i*=-1):"scaleY"===n&&0>i?(this.flipY=!this.flipY,i*=-1):"shadow"!==n||!i||i instanceof t.Shadow?"dirty"===n&&this.group&&this.group.set("dirty",i):i=new t.Shadow(i),this[n]=i,f&&(r=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(n)>-1?(this.dirty=!0,r&&this.group.set("dirty",!0)):r&&this.stateProperties.indexOf(n)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height&&0===this.strokeWidth||!this.visible},render:function(n){this.isNotVisible()||(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(n.save(),this._setupCompositeOperation(n),this.drawSelectionBackground(n),this.transform(n),this._setOpacity(n),this._setShadow(n,this),this.transformMatrix&&n.transform.apply(n,this.transformMatrix),this.clipTo&&t.util.clipContext(this,n),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(n)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(n),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&n.restore(),n.restore())},renderCache:function(n){n=n||{};this._cacheCanvas||this._createCacheCanvas();this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,n.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheWidth=0;this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&this.hasFill()&&this.hasStroke()&&"object"==typeof this.shadow?!0:this.clipPath?!0:!1},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(n){var i=this.clipPath,r;(n.save(),n.globalCompositeOperation=i.inverted?"destination-out":"destination-in",i.absolutePositioned)&&(r=t.util.invertTransform(this.calcTransformMatrix()),n.transform(r[0],r[1],r[2],r[3],r[4],r[5]));i.transform(n);n.scale(1/i.zoomX,1/i.zoomY);n.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY);n.restore()},drawObject:function(n,t){var i=this.fill,r=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(n)):(this._renderBackground(n),this._setStrokeStyles(n,this),this._setFillStyles(n,this));this._render(n);this._drawClipPath(n);this.fill=i;this.stroke=r},_drawClipPath:function(n){var t=this.clipPath;t&&(t.canvas=this.canvas,t.shouldCache(),t._transformDone=!0,t.renderCache({forClipping:!0}),this.drawClipPathOnCache(n))},drawCacheOnCanvas:function(n){n.scale(1/this.zoomX,1/this.zoomY);n.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(n){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!n&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!n){var t=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-i/2,t,i)}return!0}return!1},_renderBackground:function(n){if(this.backgroundColor){var t=this._getNonTransformedDimensions();n.fillStyle=this.backgroundColor;n.fillRect(-t.x/2,-t.y/2,t.x,t.y);this._removeShadow(n)}},_setOpacity:function(n){this.group&&!this.group._transformDone?n.globalAlpha=this.getObjectOpacity():n.globalAlpha*=this.opacity},_setStrokeStyles:function(n,t){t.stroke&&(n.lineWidth=t.strokeWidth,n.lineCap=t.strokeLineCap,n.lineDashOffset=t.strokeDashOffset,n.lineJoin=t.strokeLineJoin,n.miterLimit=t.strokeMiterLimit,n.strokeStyle=t.stroke.toLive?t.stroke.toLive(n,this):t.stroke)},_setFillStyles:function(n,t){t.fill&&(n.fillStyle=t.fill.toLive?t.fill.toLive(n,this):t.fill)},_setClippingProperties:function(n){n.globalAlpha=1;n.strokeStyle="transparent";n.fillStyle="#000000"},_setLineDash:function(n,t,i){t&&(1&t.length&&t.push.apply(t,t),s?n.setLineDash(t):i&&i(n),this.strokeUniform&&n.setLineDash(n.getLineDash().map(function(t){return t*n.lineWidth})))},_renderControls:function(n,i){var u,f,o,s=this.getViewportTransform(),e=this.calcTransformMatrix();i=i||{};f="undefined"!=typeof i.hasBorders?i.hasBorders:this.hasBorders;o="undefined"!=typeof i.hasControls?i.hasControls:this.hasControls;e=t.util.multiplyTransformMatrices(s,e);u=t.util.qrDecompose(e);n.save();n.translate(u.translateX,u.translateY);n.lineWidth=1*this.borderScaleFactor;this.group||(n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1);i.forActiveSelection?(n.rotate(r(u.angle)),f&&this.drawBordersInGroup(n,u,i)):(n.rotate(r(this.angle)),f&&this.drawBorders(n,i));o&&this.drawControls(n,i);n.restore()},_setShadow:function(n){if(this.shadow){var r,u=this.shadow,i=this.canvas,f=i&&i.viewportTransform[0]||1,e=i&&i.viewportTransform[3]||1;r=u.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling();i&&i._isRetinaScaling()&&(f*=t.devicePixelRatio,e*=t.devicePixelRatio);n.shadowColor=u.color;n.shadowBlur=u.blur*t.browserShadowBlurConstant*(f+e)*(r.scaleX+r.scaleY)/4;n.shadowOffsetX=u.offsetX*f*r.scaleX;n.shadowOffsetY=u.offsetY*e*r.scaleY}},_removeShadow:function(n){this.shadow&&(n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0)},_applyPatternGradientTransform:function(n,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var i=t.gradientTransform||t.patternTransform,r=-this.width/2+t.offsetX||0,u=-this.height/2+t.offsetY||0;return n.translate(r,u),i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:r,offsetY:u}},_renderPaintInOrder:function(n){"stroke"===this.paintFirst?(this._renderStroke(n),this._renderFill(n)):(this._renderFill(n),this._renderStroke(n))},_render:function(){},_renderFill:function(n){this.fill&&(n.save(),this._applyPatternGradientTransform(n,this.fill),"evenodd"===this.fillRule?n.fill("evenodd"):n.fill(),n.restore())},_renderStroke:function(n){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this.strokeUniform&&n.scale(1/this.scaleX,1/this.scaleY),this._setLineDash(n,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(n,this.stroke),n.stroke(),n.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var n=t.util.qrDecompose(this.transformMatrix);this.flipX=!1;this.flipY=!1;this.set("scaleX",n.scaleX);this.set("scaleY",n.scaleY);this.angle=n.angle;this.skewX=n.skewX;this.skewY=0}},_removeTransformMatrix:function(n){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=t.util.transformPoint(i,this.transformMatrix));this.transformMatrix=null;n&&(this.scaleX*=n.scaleX,this.scaleY*=n.scaleY,this.cropX=n.cropX,this.cropY=n.cropY,i.x+=n.offsetLeft,i.y+=n.offsetTop,this.width=n.width,this.height=n.height);this.setPositionByOrigin(i,"center","center")},clone:function(n,i){var r=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(r,n):t.Object._fromObject("Object",r,n)},cloneAsImage:function(n,i){var r=this.toCanvasElement(i);return n&&n(new t.Image(r)),this},toCanvasElement:function(n){var r,l,a;n||(n={});var h=t.util,v=h.saveObjectTransform(this),y=this.shadow,f=Math.abs,p=(n.multiplier||1)*(n.enableRetinaScaling?t.devicePixelRatio:1);n.withoutTransform&&h.resetObjectTransform(this);n.withoutShadow&&(this.shadow=null);var o,s,i=t.util.createCanvasElement(),c=this.getBoundingRect(!0,!0),u=this.shadow,e={x:0,y:0};return u&&(s=u.blur,o=u.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),e.x=2*Math.round(f(u.offsetX)+s)*f(o.scaleX),e.y=2*Math.round(f(u.offsetY)+s)*f(o.scaleY)),i.width=c.width+e.x,i.height=c.height+e.y,i.width+=i.width%2?2-i.width%2:0,i.height+=i.height%2?2-i.height%2:0,r=new t.StaticCanvas(i,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}),"jpeg"===n.format&&(r.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(r.width/2,r.height/2),"center","center"),l=this.canvas,r.add(this),a=r.toCanvasElement(p||1,n),this.shadow=y,this.canvas=l,this.set(v).setCoords(),r._objects=[],r.dispose(),r=null,a},toDataURL:function(n){return n||(n={}),t.util.toDataURL(this.toCanvasElement(n),n.format||"png",n.quality||1)},isType:function(n){return this.type===n},complexity:function(){return 1},toJSON:function(n){return this.toObject(n)},setGradient:function(n,i){i||(i={});var r={colorStops:[]};return r.type=i.type||(i.r1||i.r2?"radial":"linear"),r.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(r.coords.r1=i.r1,r.coords.r2=i.r2),r.gradientTransform=i.gradientTransform,t.Gradient.prototype.addColorStop.call(r,i.colorStops),this.set(n,t.Gradient.forObject(this,r))},setPatternFill:function(n,i){return this.set("fill",new t.Pattern(n,i))},setShadow:function(n){return this.set("shadow",n?new t.Shadow(n):null)},setColor:function(n){return this.set("fill",n),this},rotate:function(n){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",n),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(n,i){i=i||this.canvas.getPointer(n);var u=new t.Point(i.x,i.y),f=this._getLeftTopCoords();return this.angle&&(u=t.util.rotatePoint(u,f,r(-this.angle))),{x:u.x-f.x,y:u.y-f.y}},_setupCompositeOperation:function(n){this.globalCompositeOperation&&(n.globalCompositeOperation=this.globalCompositeOperation)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),f(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object._fromObject=function(n,i,r,u){var f=t[n];i=e(i,!0);t.util.enlivenPatterns([i.fill,i.stroke],function(n){"undefined"!=typeof n[0]&&(i.fill=n[0]);"undefined"!=typeof n[1]&&(i.stroke=n[1]);t.util.enlivenObjects([i.clipPath],function(n){i.clipPath=n[0];var t=u?new f(i[u],i):new f(i);r&&r(t)})})},t.Object.__uid=0)}("undefined"!=typeof exports?exports:this);!function(){var n=fabric.util.degreesToRadians,t={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(n,r,u,f,e){var o,s,h,c=n.x,l=n.y;return"string"==typeof r?r=t[r]:r-=.5,"string"==typeof f?f=t[f]:f-=.5,o=f-r,"string"==typeof u?u=i[u]:u-=.5,"string"==typeof e?e=i[e]:e-=.5,s=e-u,(o||s)&&(h=this._getTransformedDimensions(),c=n.x+o*h.x,l=n.y+s*h.y),new fabric.Point(c,l)},translateToCenterPoint:function(t,i,r){var u=this.translateToGivenOrigin(t,i,r,"center","center");return this.angle?fabric.util.rotatePoint(u,t,n(this.angle)):u},translateToOriginPoint:function(t,i,r){var u=this.translateToGivenOrigin(t,"center","center",i,r);return this.angle?fabric.util.rotatePoint(u,t,n(this.angle)):u},getCenterPoint:function(){var n=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(n,this.originX,this.originY)},getPointByOrigin:function(n,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,n,t)},toLocalPoint:function(t,i,r){var f,u,e=this.getCenterPoint();return f="undefined"!=typeof i&&"undefined"!=typeof r?this.translateToGivenOrigin(e,"center","center",i,r):new fabric.Point(this.left,this.top),u=new fabric.Point(t.x,t.y),this.angle&&(u=fabric.util.rotatePoint(u,e,-n(this.angle))),u.subtractEquals(f)},setPositionByOrigin:function(n,t,i){var u=this.translateToCenterPoint(n,t,i),r=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",r.x);this.set("top",r.y)},adjustPosition:function(i){var r,u,f=n(this.angle),e=this.getScaledWidth(),o=fabric.util.cos(f)*e,s=fabric.util.sin(f)*e;r="string"==typeof this.originX?t[this.originX]:this.originX-.5;u="string"==typeof i?t[i]:i-.5;this.left+=o*(u-r);this.top+=s*(u-r);this.setCoords();this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var n=this.getCenterPoint();this.originX="center";this.originY="center";this.left=n.x;this.top=n.y},_resetOrigin:function(){var n=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=n.x;this.top=n.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}();!function(){function r(n){return[new fabric.Point(n.tl.x,n.tl.y),new fabric.Point(n.tr.x,n.tr.y),new fabric.Point(n.br.x,n.br.y),new fabric.Point(n.bl.x,n.bl.y)]}var t=fabric.util.degreesToRadians,n=fabric.util.multiplyTransformMatrices,i=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(n,t){this.oCoords||this.setCoords();var i=n?this.aCoords:this.oCoords;return r(t?this.calcCoords(n):i)},intersectsWithRect:function(n,t,i,r){var u=this.getCoords(i,r),f=fabric.Intersection.intersectPolygonRectangle(u,n,t);return"Intersection"===f.status},intersectsWithObject:function(n,t,i){var r=fabric.Intersection.intersectPolygonPolygon(this.getCoords(t,i),n.getCoords(t,i));return"Intersection"===r.status||n.isContainedWithinObject(this,t,i)||this.isContainedWithinObject(n,t,i)},isContainedWithinObject:function(n,t,i){for(var u=this.getCoords(t,i),r=0,f=n._getImageLines(i?n.calcCoords(t):t?n.aCoords:n.oCoords);4>r;r++)if(!n.containsPoint(u[r],f))return!1;return!0},isContainedWithinRect:function(n,t,i,r){var u=this.getBoundingRect(i,r);return u.left>=n.x&&u.left+u.width<=t.x&&u.top>=n.y&&u.top+u.height<=t.y},containsPoint:function(n,t,i,r){var t=t||this._getImageLines(r?this.calcCoords(i):i?this.aCoords:this.oCoords),u=this._findCrossPoints(n,t);return 0!==u&&u%2==1},isOnScreen:function(n){if(!this.canvas)return!1;for(var t,i=this.canvas.vptCoords.tl,r=this.canvas.vptCoords.br,f=this.getCoords(!0,n),u=0;4>u;u++)if(t=f[u],t.x<=r.x&&t.x>=i.x&&t.y<=r.y&&t.y>=i.y)return!0;return this.intersectsWithRect(i,r,!0,n)?!0:this._containsCenterOfCanvas(i,r,n)},_containsCenterOfCanvas:function(n,t,i){var r={x:(n.x+t.x)/2,y:(n.y+t.y)/2};return this.containsPoint(r,null,!0,i)?!0:!1},isPartiallyOnScreen:function(n){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return this.intersectsWithRect(t,i,!0,n)?!0:this._containsCenterOfCanvas(t,i,n)},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_findCrossPoints:function(n,t){var r,u,o,s,f,i,e=0;for(var h in t)if(i=t[h],!(i.o.y<n.y&&i.d.y<n.y||i.o.y>=n.y&&i.d.y>=n.y||(i.o.x===i.d.x&&i.o.x>=n.x?f=i.o.x:(r=0,u=(i.d.y-i.o.y)/(i.d.x-i.o.x),o=n.y-r*n.x,s=i.o.y-u*i.o.x,f=-(o-s)/(r-u)),f>=n.x&&(e+=1),2!==e)))break;return e},getBoundingRect:function(n,t){var i=this.getCoords(n,t);return fabric.util.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?0>n?-this.minScaleLimit:this.minScaleLimit:0===n?.0001:n},scale:function(n){return this._set("scaleX",n),this._set("scaleY",n),this.setCoords()},scaleToWidth:function(n,t){var i=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(n/this.width/i)},scaleToHeight:function(n,t){var i=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(n/this.height/i)},calcCoords:function(r){var it=this._calcRotateMatrix(),rt=this._calcTranslateMatrix(),w=n(rt,it),ut=this.getViewportTransform(),h=r?w:n(ut,w),b=this._getTransformedDimensions(),c=b.x/2,l=b.y/2,u=i({x:-c,y:-l},h),f=i({x:c,y:-l},h),e=i({x:-c,y:l},h),o=i({x:c,y:l},h),s;if(!r){var y=this.padding,k=t(this.angle),d=fabric.util.cos(k),g=fabric.util.sin(k),nt=d*y,tt=g*y,a=nt+tt,v=nt-tt;y&&(u.x-=v,u.y-=a,f.x+=a,f.y-=v,e.x-=a,e.y+=v,o.x+=v,o.y+=a);var ft=new fabric.Point((u.x+e.x)/2,(u.y+e.y)/2),p=new fabric.Point((f.x+u.x)/2,(f.y+u.y)/2),et=new fabric.Point((o.x+f.x)/2,(o.y+f.y)/2),ot=new fabric.Point((o.x+e.x)/2,(o.y+e.y)/2),st=new fabric.Point(p.x+g*this.rotatingPointOffset,p.y-d*this.rotatingPointOffset)}return s={tl:u,tr:f,br:o,bl:e},r||(s.ml=ft,s.mt=p,s.mr=et,s.mb=ot,s.mtr=st),s},setCoords:function(n,t){return this.oCoords=this.calcCoords(n),t||(this.aCoords=this.calcCoords(!0)),n||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var n=t(this.angle),i=fabric.util.cos(n),r=fabric.util.sin(n);return[i,r,-r,i,0,0]}return fabric.iMatrix.concat()},_calcTranslateMatrix:function(){var n=this.getCenterPoint();return[1,0,0,1,n.x,n.y]},transformMatrixKey:function(n){var t="_",i="";return!n&&this.group&&(i=this.group.transformMatrixKey(n)+t),i+this.top+t+this.left+t+this.scaleX+t+this.scaleY+t+this.skewX+t+this.skewY+t+this.angle+t+this.originX+t+this.originY+t+this.width+t+this.height+t+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){var u,i,r;return t?this.calcOwnMatrix():(u=this.transformMatrixKey(),i=this.matrixCache||(this.matrixCache={}),i.key===u)?i.value:(r=this.calcOwnMatrix(),this.group&&(r=n(this.group.calcTransformMatrix(),r)),i.key=u,i.value=r,r)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={}),u,t,f;return i.key===r?i.value:(t=this._calcTranslateMatrix(),f=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),this.angle&&(u=this._calcRotateMatrix(),t=n(t,u)),t=n(t,f),i.key=r,i.value=t,t)},_calcDimensionsTransformMatrix:function(i,r,u){var e,o=this.scaleX*(u&&this.flipX?-1:1),s=this.scaleY*(u&&this.flipY?-1:1),f=[o,0,0,s,0,0];return i&&(e=[1,0,Math.tan(t(i)),1],f=n(f,e,!0)),r&&(e=[1,Math.tan(t(r)),0,1],f=n(f,e,!0)),f},_getNonTransformedDimensions:function(){var n=this.strokeWidth,t=this.width+n,i=this.height+n;return{x:t,y:i}},_getTransformedDimensions:function(n,t){var i,r,e,s,u,o,f,h;if("undefined"==typeof n&&(n=this.skewX),"undefined"==typeof t&&(t=this.skewY),e=this._getNonTransformedDimensions(),s=0===n&&0===t,this.strokeUniform?(i=this.width,r=this.height):(i=e.x,r=e.y),s)return this._finalizeDimensions(i*this.scaleX,r*this.scaleY);for(i/=2,r/=2,f=[{x:-i,y:-r},{x:i,y:-r},{x:-i,y:r},{x:i,y:r}],h=this._calcDimensionsTransformMatrix(n,t,!1),u=0;u<f.length;u++)f[u]=fabric.util.transformPoint(f[u],h);return o=fabric.util.makeBoundingBoxFromPoints(f),this._finalizeDimensions(o.width,o.height)},_finalizeDimensions:function(n,t){return this.strokeUniform?{x:n+this.strokeWidth,y:t+this.strokeWidth}:{x:n,y:t}},_calculateCurrentDimensions:function(){var n=this.getViewportTransform(),t=this._getTransformedDimensions(),i=fabric.util.transformPoint(t,n,!0);return i.scalarAdd(2*this.padding)}})}();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(n){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,n):this.canvas.sendBackwards(this,n),this},bringForward:function(n){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,n):this.canvas.bringForward(this,n),this},moveTo:function(n){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,n):this.canvas.moveTo(this,n),this}});!function(){function n(n,t){if(t){if(t.toLive)return n+": url(#SVGID_"+t.id+"); ";var i=new fabric.Color(t),r=n+": "+i.toRgb()+"; ",u=i.getAlpha();return 1!==u&&(r+=n+"-opacity: "+u.toString()+"; "),r}return n+": none; "}var t=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(t){var i=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",u=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeDashOffset?this.strokeDashOffset:"0",e=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",s=this.strokeMiterLimit?this.strokeMiterLimit:"4",h="undefined"!=typeof this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=t?"":this.getSvgFilter(),a=n("fill",this.fill),v=n("stroke",this.stroke);return[v,"stroke-width: ",r,"; ","stroke-dasharray: ",u,"; ","stroke-linecap: ",e,"; ","stroke-dashoffset: ",f,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",s,"; ",a,"fill-rule: ",i,"; ","opacity: ",h,";",l,c].join("")},getSvgSpanStyles:function(t,i){var r="; ",f=t.fontFamily?"font-family: "+(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?"'"+t.fontFamily+"'":t.fontFamily)+r:"",e=t.strokeWidth?"stroke-width: "+t.strokeWidth+r:"",f=f,o=t.fontSize?"font-size: "+t.fontSize+"px"+r:"",s=t.fontStyle?"font-style: "+t.fontStyle+r:"",h=t.fontWeight?"font-weight: "+t.fontWeight+r:"",c=t.fill?n("fill",t.fill):"",l=t.stroke?n("stroke",t.stroke):"",u=this.getSvgTextDecoration(t),a=t.deltaY?"baseline-shift: "+-t.deltaY+"; ":"";return u&&(u="text-decoration: "+u+r),[l,e,f,o,s,h,u,c,a,i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(n){return"overline"in n||"underline"in n||"linethrough"in n?(n.overline?"overline ":"")+(n.underline?"underline ":"")+(n.linethrough?"line-through ":""):""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(n,t){var i=n?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'+fabric.util.matrixToSVG(i);return r+(t||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" "+fabric.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(n){if(this.backgroundColor){var i=fabric.Object.NUM_FRACTION_DIGITS;n.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),'"><\/rect>\n')}},toSVG:function(n){return this._createBaseSVGMarkup(this._toSVG(n),{reviver:n})},toClipPathSVG:function(n){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(n),{reviver:n})},_createBaseClipPathSVGMarkup:function(n,t){t=t||{};var i=t.reviver,r=t.additionalTransform||"",u=[this.getSvgTransform(!0,r),this.getSvgCommons()].join(""),f=n.indexOf("COMMON_PARTS");return n[f]=u,i?i(n.join("")):n.join("")},_createBaseSVGMarkup:function(n,t){t=t||{};var s,h,c=t.noStyle,u=t.reviver,y=c?"":'style="'+this.getSvgStyles()+'" ',l=t.withShadow?'style="'+this.getSvgFilter()+'" ':"",r=this.clipPath,p=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",f=r&&r.absolutePositioned,e=this.stroke,o=this.fill,a=this.shadow,i=[],w=n.indexOf("COMMON_PARTS"),v=t.additionalTransform;return r&&(r.clipPathId="CLIPPATH_"+fabric.Object.__uid++,h='<clipPath id="'+r.clipPathId+'" >\n'+r.toClipPathSVG(u)+"<\/clipPath>\n"),f&&i.push("<g ",l,this.getSvgCommons()," >\n"),i.push("<g ",this.getSvgTransform(!1),f?"":l+this.getSvgCommons()," >\n"),s=[y,p,c?"":this.addPaintOrder()," ",v?'transform="'+v+'" ':""].join(""),n[w]=s,o&&o.toLive&&i.push(o.toSVG(this)),e&&e.toLive&&i.push(e.toSVG(this)),a&&i.push(a.toSVG(this)),r&&i.push(h),i.push(n.join("")),i.push("<\/g>\n"),f&&i.push("<\/g>\n"),u?u(i.join("")):i.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}();!function(){function i(n,t,i){var u={};i.forEach(function(t){u[t]=n[t]});r(n[t],u,!0)}function n(t,i,r){var e,o,u,f;if(t===i)return!0;if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(u=0,f=t.length;f>u;u++)if(!n(t[u],i[u]))return!1;return!0}if(t&&"object"==typeof t){if(o=Object.keys(t),!i||"object"!=typeof i||!r&&o.length!==Object.keys(i).length)return!1;for(u=0,f=o.length;f>u;u++)if(e=o[u],"canvas"!==e&&!n(t[e],i[e]))return!1;return!0}}var r=fabric.util.object.extend,t="stateProperties";fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(i){i=i||t;var r="_"+i;return Object.keys(this[r]).length<this[i].length?!0:!n(this[r],this,!0)},saveState:function(n){var u=n&&n.propertySet||t,r="_"+u;return this[r]?(i(this,r,this[u]),n&&n.stateProperties&&i(this,r,n.stateProperties),this):this.setupState(n)},setupState:function(n){n=n||{};var i=n.propertySet||t;return n.propertySet=i,this["_"+i]={},this.saveState(n),this}})}();!function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(n){var i,r,u,f,t;if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;u=n.x;f=n.y;this.__corner=0;for(t in this.oCoords)if(this.isControlVisible(t)&&("mtr"!==t||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==t&&"mr"!==t&&"mb"!==t&&"ml"!==t)&&(r=this._getImageLines(this.oCoords[t].corner),i=this._findCrossPoints({x:u,y:f},r),0!==i&&i%2==1))return this.__corner=t,t;return!1},_setCornerCoords:function(){var t,i,r=this.oCoords,o=n(45-this.angle),s=.707106*this.cornerSize,u=s*fabric.util.cos(o),f=s*fabric.util.sin(o);for(var e in r)t=r[e].x,i=r[e].y,r[e].corner={tl:{x:t-f,y:i-u},tr:{x:t+u,y:i-f},bl:{x:t-u,y:i+f},br:{x:t+f,y:i+u}}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var r=this.getCenterPoint(),i=this._calculateCurrentDimensions(),u=this.canvas.viewportTransform;return t.translate(r.x,r.y),t.scale(1/u[0],1/u[3]),t.rotate(n(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore(),this},drawBorders:function(n,t){var r;t=t||{};var u=this._calculateCurrentDimensions(),f=1/this.borderScaleFactor,e=u.x+f,i=u.y+f,o="undefined"!=typeof t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,s="undefined"!=typeof t.hasControls?t.hasControls:this.hasControls,h="undefined"!=typeof t.rotatingPointOffset?t.rotatingPointOffset:this.rotatingPointOffset;return(n.save(),n.strokeStyle=t.borderColor||this.borderColor,this._setLineDash(n,t.borderDashArray||this.borderDashArray,null),n.strokeRect(-e/2,-i/2,e,i),o&&this.isControlVisible("mtr")&&s)&&(r=-i/2,n.beginPath(),n.moveTo(0,r),n.lineTo(0,r-h),n.stroke()),n.restore(),this},drawBordersInGroup:function(n,t,i){i=i||{};var o=this._getNonTransformedDimensions(),s=fabric.util.customTransformMatrix(t.scaleX,t.scaleY,t.skewX),r=fabric.util.transformPoint(o,s),u=1/this.borderScaleFactor,f=r.x+u,e=r.y+u;return n.save(),this._setLineDash(n,i.borderDashArray||this.borderDashArray,null),n.strokeStyle=i.borderColor||this.borderColor,n.strokeRect(-f/2,-e/2,f,e),n.restore(),this},drawControls:function(n,t){t=t||{};var o=this._calculateCurrentDimensions(),f=o.x,e=o.y,s=t.cornerSize||this.cornerSize,i=-(f+s)/2,r=-(e+s)/2,h="undefined"!=typeof t.transparentCorners?t.transparentCorners:this.transparentCorners,c="undefined"!=typeof t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,u=h?"stroke":"fill";return n.save(),n.strokeStyle=n.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(n.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(n,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",n,u,i,r,t),this._drawControl("tr",n,u,i+f,r,t),this._drawControl("bl",n,u,i,r+e,t),this._drawControl("br",n,u,i+f,r+e,t),this.get("lockUniScaling")||(this._drawControl("mt",n,u,i+f/2,r,t),this._drawControl("mb",n,u,i+f/2,r+e,t),this._drawControl("mr",n,u,i+f,r+e/2,t),this._drawControl("ml",n,u,i,r+e/2,t)),c&&this._drawControl("mtr",n,u,i+f/2,r-this.rotatingPointOffset,t),n.restore(),this},_drawControl:function(n,t,i,r,u,f){if(f=f||{},this.isControlVisible(n)){var e=this.cornerSize,o=!this.transparentCorners&&this.cornerStrokeColor;switch(f.cornerStyle||this.cornerStyle){case"circle":t.beginPath();t.arc(r+e/2,u+e/2,e/2,0,2*Math.PI,!1);t[i]();o&&t.stroke();break;default:this.transparentCorners||t.clearRect(r,u,e,e);t[i+"Rect"](r,u,e,e);o&&t.strokeRect(r,u,e,e)}}},isControlVisible:function(n){return this._getControlsVisibility()[n]},setControlVisible:function(n,t){return this._getControlsVisibility()[n]=t,this},setControlsVisibility:function(n){n||(n={});for(var t in n)this.setControlVisible(t,n[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){n.set("left",t);f.requestRenderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxCenterObjectV:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){n.set("top",t);f.requestRenderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxRemove:function(n,t){t=t||{};var i=function(){},u=t.onComplete||i,f=t.onChange||i,r=this;return fabric.util.animate({startValue:n.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){n.set("opacity",t);r.requestRenderAll();f()},onComplete:function(){r.remove(n);u()}}),this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){var n,u,i,t,r;if(arguments[0]&&"object"==typeof arguments[0]){i=[];for(n in arguments[0])i.push(n);for(t=0,r=i.length;r>t;t++)n=i[t],u=t!==r-1,this._animate(n,arguments[0][n],arguments[1],u)}else this._animate.apply(this,arguments);return this},_animate:function(n,t,i,r){var u,f=this,e;t=t.toString();i=i?fabric.util.object.clone(i):{};~n.indexOf(".")&&(u=n.split("."));e=u?this.get(u[0])[u[1]]:this.get(n);"from"in i||(i.from=e);t=~t.indexOf("=")?e+parseFloat(t.replace("=","")):parseFloat(t);fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(f)},onChange:function(t,e,o){u?f[u[0]][u[1]]=t:f.set(n,t);r||i.onChange&&i.onChange(t,e,o)},onComplete:function(n,t,u){r||(f.setCoords(),i.onComplete&&i.onComplete(n,t,u))}})}});!function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.array.min,r=t.util.array.max;t.Group||(t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,t,i){var r,u;for(t=t||{},this._objects=[],i&&this.callSuper("initialize",t),this._objects=n||[],r=this._objects.length;r--;)this._objects[r].group=this;i?this._updateObjectsACoords():(u=t&&t.centerPoint,void 0!==t.originX&&(this.originX=t.originX),void 0!==t.originY&&(this.originY=t.originY),u||this._calcBounds(),this._updateObjectsCoords(u),delete t.centerPoint,this.callSuper("initialize",t));this.setCoords()},_updateObjectsACoords:function(){for(var n=this._objects.length;n--;)this._objects[n].setCoords(!0,!0)},_updateObjectsCoords:function(n){for(var n=n||this.getCenterPoint(),t=this._objects.length;t--;)this._updateObjectCoords(this._objects[t],n)},_updateObjectCoords:function(n,t){var i=n.left,r=n.top;n.set({left:i-t.x,top:r-t.y});n.group=this;n.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){return this._restoreObjectsState(),t.util.resetObjectTransform(this),n&&(this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(n){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0;n.group=this;n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0;delete n.group},_set:function(n,i){var r=this._objects.length;if(this.useSetOnGroup)for(;r--;)this._objects[r].setOnGroup(n,i);if("canvas"===n)for(;r--;)this._objects[r]._set(n,i);t.Object.prototype._set.call(this,n,i)},toObject:function(n){var r=this.includeDefaultValues,u=this._objects.map(function(t){var u=t.includeDefaultValues,i;return t.includeDefaultValues=r,i=t.toObject(n),t.includeDefaultValues=u,i}),i=t.Object.prototype.toObject.call(this,n);return i.objects=u,i},toDatalessObject:function(n){var i,u=this.sourcePath,f,r;return u?i=u:(f=this.includeDefaultValues,i=this._objects.map(function(t){var r=t.includeDefaultValues,i;return t.includeDefaultValues=f,i=t.toDatalessObject(n),t.includeDefaultValues=r,i})),r=t.Object.prototype.toDatalessObject.call(this,n),r.objects=i,r},render:function(n){this._transformDone=!0;this.callSuper("render",n);this._transformDone=!1},shouldCache:function(){var i=t.Object.prototype.shouldCache.call(this),n,r;if(i)for(n=0,r=this._objects.length;r>n;n++)if(this._objects[n].willDrawShadow())return this.ownCaching=!1,!1;return i},willDrawShadow:function(){if(this.shadow)return t.Object.prototype.willDrawShadow.call(this);for(var n=0,i=this._objects.length;i>n;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var t=0,i=this._objects.length;i>t;t++)this._objects[t].render(n);this._drawClipPath(n)},isCacheDirty:function(n){var t,u,i,r;if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(t=0,u=this._objects.length;u>t;t++)if(this._objects[t].isCacheDirty(!0))return this._cacheCanvas&&(i=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY,this._cacheContext.clearRect(-i/2,-r/2,i,r)),!0;return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(n){var r=n.calcTransformMatrix(),i=t.util.qrDecompose(r),u=new t.Point(i.translateX,i.translateY);return n.flipX=!1,n.flipY=!1,n.set("scaleX",i.scaleX),n.set("scaleY",i.scaleY),n.skewX=i.skewX,n.skewY=i.skewY,n.angle=i.angle,n.setPositionByOrigin(u,"center","center"),n},_restoreObjectState:function(n){return this.realizeTransform(n),n.setCoords(),delete n.group,this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){var r,i,u,n;if(this.canvas)return r=this._objects,i=this.canvas,this._objects=[],u=this.toObject(),delete u.objects,n=new t.ActiveSelection([]),n.set(u),n.type="activeSelection",i.remove(this),r.forEach(function(t){t.group=n;t.dirty=!0;i.add(t)}),n.canvas=i,n._objects=r,i._activeObject=n,n.setCoords(),n},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var n=!0,t=!0;return this.forEachObject(function(i){i.setCoords(n,t)}),this},_calcBounds:function(n){for(var t,r,i,f=[],e=[],o=["tr","br","bl","tl"],u=0,s=this._objects.length,h=o.length;s>u;++u)for(t=this._objects[u],t.setCoords(!0),i=0;h>i;i++)r=o[i],f.push(t.oCoords[r].x),e.push(t.oCoords[r].y);this._getBounds(f,e,n)},_getBounds:function(n,u,f){var e=new t.Point(i(n),i(u)),o=new t.Point(r(n),r(u)),s=e.y||0,h=e.x||0,c=o.x-e.x||0,l=o.y-e.y||0;this.width=c;this.height=l;f||this.setPositionByOrigin({x:h,y:s},"left","top")},_toSVG:function(n){for(var t=["<g ","COMMON_PARTS"," >\n"],i=0,r=this._objects.length;r>i;i++)t.push("\t\t",this._objects[i].toSVG(n));return t.push("<\/g>\n"),t},getSvgStyles:function(){var n="undefined"!=typeof this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",t=this.visible?"":" visibility: hidden;";return[n,this.getSvgFilter(),t].join("")},toClipPathSVG:function(n){for(var i=[],t=0,r=this._objects.length;r>t;t++)i.push("\t",this._objects[t].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(i,{reviver:n})}}),t.Group.fromObject=function(n,i){t.util.enlivenObjects(n.objects,function(r){t.util.enlivenObjects([n.clipPath],function(u){var f=t.util.object.clone(n,!0);f.clipPath=u[0];delete f.objects;i&&i(new t.Group(r,f,!0))})})})}("undefined"!=typeof exports?exports:this);!function(n){"use strict";var t=n.fabric||(n.fabric={});t.ActiveSelection||(t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(n,i){i=i||{};this._objects=n||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;i.originX&&(this.originX=i.originX);i.originY&&(this.originY=i.originY);this._calcBounds();this._updateObjectsCoords();t.Object.prototype.initialize.call(this,i);this.setCoords()},toGroup:function(){var u=this._objects.concat(),i,n,r;return(this._objects=[],i=t.Object.prototype.toObject.call(this),n=new t.Group([]),delete i.type,n.set(i),u.forEach(function(t){t.canvas.remove(t);t.group=n}),n._objects=u,!this.canvas)?n:(r=this.canvas,r.add(n),r._activeObject=n,n.setCoords(),n)},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(n,t,i){n.save();n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper("_renderControls",n,t);i=i||{};"undefined"==typeof i.hasControls&&(i.hasControls=!1);"undefined"==typeof i.hasRotatingPoint&&(i.hasRotatingPoint=!1);i.forActiveSelection=!0;for(var r=0,u=this._objects.length;u>r;r++)this._objects[r]._renderControls(n,i);n.restore()}}),t.ActiveSelection.fromObject=function(n,i){t.util.enlivenObjects(n.objects,function(r){delete n.objects;i&&i(new t.ActiveSelection(r,n,!0))})})}("undefined"!=typeof exports?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.angle%360;return n>0?90*Math.round((n-1)/90):90*Math.round(n/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(n){n=n||{};var t=function(){},r=n.onComplete||t,u=n.onChange||t,i=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){i.rotate(n);u()},onComplete:function(){i.setCoords();r()}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.requestRenderAllBound}),this}});!function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.clone;return t.Text?void t.warn("fabric.Text is already defined"):(t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:t.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(n,t){this.styles=t?t.styles||{}:{};this.text=n;this.__skipDimension=!0;this.callSuper("initialize",t);this.__skipDimension=!1;this.initDimensions();this.setCoords();this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var n=this._splitTextIntoLines(this.text);return this.textLines=n.lines,this._textLines=n.graphemeLines,this._unwrappedTextLines=n._unwrappedLines,this._text=n.graphemeText,n},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,f,s,u,e,t,h,i,c,n=0,o=this._textLines.length;o>n;n++)if(("justify"===this.textAlign||n!==o-1&&!this.isEndOfWrapping(n))&&(u=0,e=this._textLines[n],f=this.getLineWidth(n),f<this.width&&(h=this.textLines[n].match(this._reSpacesAndTabs))))for(s=h.length,r=(this.width-f)/s,i=0,c=e.length;c>=i;i++)t=this.__charBounds[n][i],this._reSpaceAndTab.test(e[i])?(t.width+=r,t.kernedWidth+=r,t.left+=u,u+=r):t.left+=u},isEndOfWrapping:function(n){return n===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var n=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return n.width+=t*n.zoomX,n.height+=t*n.zoomY,n},_render:function(n){this._setTextStyles(n);this._renderTextLinesBackground(n);this._renderTextDecoration(n,"underline");this._renderText(n);this._renderTextDecoration(n,"overline");this._renderTextDecoration(n,"linethrough")},_renderText:function(n){"stroke"===this.paintFirst?(this._renderTextStroke(n),this._renderTextFill(n)):(this._renderTextFill(n),this._renderTextStroke(n))},_setTextStyles:function(n,t,i){n.textBaseline="alphabetic";n.font=this._getFontDeclaration(t,i)},calcTextWidth:function(){for(var i,n=this.getLineWidth(0),t=1,r=this._textLines.length;r>t;t++)i=this.getLineWidth(t),i>n&&(n=i);return n},_renderTextLine:function(n,t,i,r,u,f){this._renderChars(n,t,i,r,u,f)},_renderTextLinesBackground:function(n){var e,y;if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var i,c,l,r,o,u,s=0,p=n.fillStyle,a=this._getLeftOffset(),v=this._getTopOffset(),h=0,f=0,t=0,w=this._textLines.length;w>t;t++)if(i=this.getHeightOfLine(t),this.textBackgroundColor||this.styleHas("textBackgroundColor",t)){for(l=this._textLines[t],c=this._getLineLeftOffset(t),f=0,h=0,r=this.getValueOfPropertyAt(t,0,"textBackgroundColor"),e=0,y=l.length;y>e;e++)o=this.__charBounds[t][e],u=this.getValueOfPropertyAt(t,e,"textBackgroundColor"),u!==r?(n.fillStyle=r,r&&n.fillRect(a+c+h,v+s,f,i/this.lineHeight),h=o.left,f=o.width,r=u):f+=o.kernedWidth;u&&(n.fillStyle=u,n.fillRect(a+c+h,v+s,f,i/this.lineHeight));s+=i}else s+=i;n.fillStyle=p;this._removeShadow(n)}},getFontCache:function(n){var u=n.fontFamily.toLowerCase(),i,r;return t.charWidthsCache[u]||(t.charWidthsCache[u]={}),i=t.charWidthsCache[u],r=n.fontStyle.toLowerCase()+"_"+(n.fontWeight+"").toLowerCase(),i[r]||(i[r]={}),i[r]},_applyCharStyles:function(n,t,i,r,u){this._setFillStyles(t,u);this._setStrokeStyles(t,u);t.font=this._getFontDeclaration(u)},_measureChar:function(n,t,i,r){var o,f,e,s,u=this.getFontCache(t),v=this._getFontDeclaration(t),y=this._getFontDeclaration(r),c=i+n,l=v===y,a=t.fontSize/this.CACHE_FONT_SIZE,h;return(i&&void 0!==u[i]&&(e=u[i]),void 0!==u[n]&&(s=o=u[n]),l&&void 0!==u[c]&&(f=u[c],s=f-e),void 0===o||void 0===e||void 0===f)&&(h=this.getMeasuringContext(),this._setTextStyles(h,t,!0)),void 0===o&&(s=o=h.measureText(n).width,u[n]=o),void 0===e&&l&&i&&(e=h.measureText(i).width,u[i]=e),l&&void 0===f&&(f=h.measureText(c).width,u[c]=f,s=f-e),{width:o*a,kernedWidth:s*a}},getHeightOfChar:function(n,t){return this.getValueOfPropertyAt(n,t,"fontSize")},measureLine:function(n){var t=this._measureLine(n);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(n){var t,r,e,i,o=0,u=this._textLines[n],f=new Array(u.length);for(this.__charBounds[n]=f,t=0;t<u.length;t++)r=u[t],i=this._getGraphemeBox(r,n,t,e),f[t]=i,o+=i.kernedWidth,e=r;return f[t]={left:i?i.left+i.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:o,numOfSpaces:0}},_getGraphemeBox:function(n,t,i,r,u){var e,o=this.getCompleteStyleDeclaration(t,i),a=r?this.getCompleteStyleDeclaration(t,i-1):{},f=this._measureChar(n,o,r,a),c=f.kernedWidth,l=f.width,s,h;return 0!==this.charSpacing&&(e=this._getWidthOfCharSpacing(),l+=e,c+=e),s={width:l,left:0,height:o.fontSize,kernedWidth:c,deltaY:o.deltaY},i>0&&!u&&(h=this.__charBounds[t][i-1],s.left=h.left+h.width+f.kernedWidth-f.width),s},getHeightOfLine:function(n){if(this.__lineHeights[n])return this.__lineHeights[n];for(var r=this._textLines[n],t=this.getHeightOfChar(n,0),i=1,u=r.length;u>i;i++)t=Math.max(this.getHeightOfChar(n,i),t);return this.__lineHeights[n]=t*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var t,i=0,n=0,r=this._textLines.length;r>n;n++)t=this.getHeightOfLine(n),i+=n===r-1?t/this.lineHeight:t;return i},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(n,t){n.save();for(var r=0,e=this._getLeftOffset(),o=this._getTopOffset(),u=this._applyPatternGradientTransform(n,"fillText"===t?this.fill:this.stroke),i=0,s=this._textLines.length;s>i;i++){var f=this.getHeightOfLine(i),h=f/this.lineHeight,c=this._getLineLeftOffset(i);this._renderTextLine(t,n,this._textLines[i],e+c-u.offsetX,o+r+h-u.offsetY,i);r+=f}n.restore()},_renderTextFill:function(n){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(n,"fillText")},_renderTextStroke:function(n){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this._setLineDash(n,this.strokeDashArray),n.beginPath(),this._renderTextCommon(n,"strokeText"),n.closePath(),n.restore())},_renderChars:function(n,t,i,r,u,f){var c,l,s,o,a=this.getHeightOfLine(f),p=-1!==this.textAlign.indexOf("justify"),v="",h=0,w=!p&&0===this.charSpacing&&this.isEmptyStyles(f),e,y;if(t.save(),u-=a*this._fontSizeFraction/this.lineHeight,w)return this._renderChar(n,t,f,0,this.textLines[f],r,u,a),void t.restore();for(e=0,y=i.length-1;y>=e;e++)o=e===y||this.charSpacing,v+=i[e],s=this.__charBounds[f][e],0===h?(r+=s.kernedWidth-s.width,h+=s.width):h+=s.kernedWidth,p&&!o&&this._reSpaceAndTab.test(i[e])&&(o=!0),o||(c=c||this.getCompleteStyleDeclaration(f,e),l=this.getCompleteStyleDeclaration(f,e+1),o=this._hasStyleChanged(c,l)),o&&(this._renderChar(n,t,f,e,v,r,u,a),v="",c=l,r+=h,h=0);t.restore()},_renderChar:function(n,t,i,r,u,f,e){var o=this._getStyleDeclaration(i,r),s=this.getCompleteStyleDeclaration(i,r),h="fillText"===n&&s.fill,c="strokeText"===n&&s.stroke&&s.strokeWidth;(c||h)&&(o&&t.save(),this._applyCharStyles(n,t,i,r,s),o&&o.textBackgroundColor&&this._removeShadow(t),o&&o.deltaY&&(e+=o.deltaY),h&&t.fillText(u,f,e),c&&t.strokeText(u,f,e),o&&t.restore())},setSuperscript:function(n,t){return this._setScript(n,t,this.superscript)},setSubscript:function(n,t){return this._setScript(n,t,this.subscript)},_setScript:function(n,t,i){var r=this.get2DCursorLocation(n,!0),u=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),f=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),e={fontSize:u*i.size,deltaY:f+u*i.baseline};return this.setSelectionStyles(e,n,t),this},_hasStyleChanged:function(n,t){return n.fill!==t.fill||n.stroke!==t.stroke||n.strokeWidth!==t.strokeWidth||n.fontSize!==t.fontSize||n.fontFamily!==t.fontFamily||n.fontWeight!==t.fontWeight||n.fontStyle!==t.fontStyle||n.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(n,t){return this._hasStyleChanged(n,t)||n.overline!==t.overline||n.underline!==t.underline||n.linethrough!==t.linethrough},_getLineLeftOffset:function(n){var t=this.getLineWidth(n);return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:"justify-center"===this.textAlign&&this.isEndOfWrapping(n)?(this.width-t)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(n)?this.width-t:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__charBounds=[]},_shouldClearDimensionCache:function(){var n=this._forceClearCache;return n||(n=this.hasStateChanged("_dimensionAffectingProps")),n&&(this.dirty=!0,this._forceClearCache=!1),n},getLineWidth:function(n){if(this.__lineWidths[n])return this.__lineWidths[n];var t,i,r=this._textLines[n];return""===r?t=0:(i=this.measureLine(n),t=i.width),this.__lineWidths[n]=t,t},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(n,t,i){var r=this._getStyleDeclaration(n,t);return r&&"undefined"!=typeof r[i]?r[i]:this[i]},_renderTextDecoration:function(n,t){var r,tt;if(this[t]||this.styleHas(t)){for(var h,f,y,p,e,w,d,c,b,l,u,a,v,g,o,s,nt=this._getLeftOffset(),k=this._getTopOffset(),it=this._getWidthOfCharSpacing(),i=0,rt=this._textLines.length;rt>i;i++)if(h=this.getHeightOfLine(i),this[t]||this.styleHas(t,i)){for(d=this._textLines[i],g=h/this.lineHeight,p=this._getLineLeftOffset(i),l=0,u=0,c=this.getValueOfPropertyAt(i,0,t),s=this.getValueOfPropertyAt(i,0,"fill"),b=k+g*(1-this._fontSizeFraction),f=this.getHeightOfChar(i,0),e=this.getValueOfPropertyAt(i,0,"deltaY"),r=0,tt=d.length;tt>r;r++)a=this.__charBounds[i][r],v=this.getValueOfPropertyAt(i,r,t),o=this.getValueOfPropertyAt(i,r,"fill"),y=this.getHeightOfChar(i,r),w=this.getValueOfPropertyAt(i,r,"deltaY"),(v!==c||o!==s||y!==f||w!==e)&&u>0?(n.fillStyle=s,c&&s&&n.fillRect(nt+p+l,b+this.offsets[t]*f+e,u,this.fontSize/15),l=a.left,u=a.width,c=v,s=o,f=y,e=w):u+=a.kernedWidth;n.fillStyle=o;v&&o&&n.fillRect(nt+p+l,b+this.offsets[t]*f+e,u-it,this.fontSize/15);k+=h}else k+=h;this._removeShadow(n)}},_getFontDeclaration:function(n,i){var r=n||this,u=this.fontFamily,f=t.Text.genericFonts.indexOf(u.toLowerCase())>-1,e=void 0===u||u.indexOf("'")>-1||u.indexOf(",")>-1||u.indexOf('"')>-1||f?r.fontFamily:'"'+r.fontFamily+'"';return[t.isLikelyNode?r.fontWeight:r.fontStyle,t.isLikelyNode?r.fontStyle:r.fontWeight,i?this.CACHE_FONT_SIZE+"px":r.fontSize+"px",e].join(" ")},render:function(n){this.visible&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",n))},_splitTextIntoLines:function(n){for(var r=n.split(this._reNewline),u=new Array(r.length),e=["\n"],f=[],i=0;i<r.length;i++)u[i]=t.util.string.graphemeSplit(r[i]),f=f.concat(u[i],e);return f.pop(),{_unwrappedLines:u,lines:r,graphemeText:f,graphemeLines:u}},toObject:function(n){var r=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(n),t=this.callSuper("toObject",r);return t.styles=i(this.styles,!0),t},set:function(n,t){var i,r;if(this.callSuper("set",n,t),i=!1,"object"==typeof n)for(r in n)i=i||-1!==this._dimensionAffectingProps.indexOf(r);else i=-1!==this._dimensionAffectingProps.indexOf(n);return i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(n,r,u){var e,h,s,o,c;if(!n)return r(null);e=t.parseAttributes(n,t.Text.ATTRIBUTE_NAMES);h=e.textAnchor||"left";(u=t.util.object.extend(u?i(u):{},e),u.top=u.top||0,u.left=u.left||0,e.textDecoration)&&(s=e.textDecoration,-1!==s.indexOf("underline")&&(u.underline=!0),-1!==s.indexOf("overline")&&(u.overline=!0),-1!==s.indexOf("line-through")&&(u.linethrough=!0),delete u.textDecoration);"dx"in e&&(u.left+=e.dx);"dy"in e&&(u.top+=e.dy);"fontSize"in u||(u.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);o="";"textContent"in n?o=n.textContent:"firstChild"in n&&null!==n.firstChild&&"data"in n.firstChild&&null!==n.firstChild.data&&(o=n.firstChild.data);o=o.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");c=u.strokeWidth;u.strokeWidth=0;var f=new t.Text(o,u),a=f.getScaledHeight()/f.height,v=(f.height+f.strokeWidth)*f.lineHeight-f.height,y=v*a,p=f.getScaledHeight()+y,l=0;"center"===h&&(l=f.getScaledWidth()/2);"right"===h&&(l=f.getScaledWidth());f.set({left:f.left-l,top:f.top-(p-f.fontSize*(.07+f._fontSizeFraction))/f.lineHeight,strokeWidth:"undefined"!=typeof c?c:1});r(f)},t.Text.fromObject=function(n,i){return t.Object._fromObject("Text",n,i,"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],void(t.util.createAccessors&&t.util.createAccessors(t.Text)))}("undefined"!=typeof exports?exports:this);!function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(n){var t,i,r,u;if(!this.styles||"undefined"!=typeof n&&!this.styles[n])return!0;t="undefined"==typeof n?this.styles:{line:this.styles[n]};for(i in t)for(r in t[i])for(u in t[i][r])return!1;return!0},styleHas:function(n,t){var i,r,u;if(!this.styles||!n||""===n||"undefined"!=typeof t&&!this.styles[t])return!1;i="undefined"==typeof t?this.styles:{0:this.styles[t]};for(r in i)for(u in i[r])if("undefined"!=typeof i[r][u][n])return!0;return!1},cleanStyle:function(n){var r,s,t,l,f;if(!this.styles||!n||""===n)return!1;var e,u,t,i=this.styles,h=0,o=!0,c=0;for(r in i){e=0;for(s in i[r])t=i[r][s],l=t.hasOwnProperty(n),h++,l?(u?t[n]!==u&&(o=!1):u=t[n],t[n]===this[n]&&delete t[n]):o=!1,0!==Object.keys(t).length?e++:delete i[r][s];0===e&&delete i[r]}for(f=0;f<this._textLines.length;f++)c+=this._textLines[f].length;o&&h===c&&(this[n]=u,this.removeStyle(n))},removeStyle:function(n){if(this.styles&&n&&""!==n){var t,r,i,u=this.styles;for(r in u){t=u[r];for(i in t)delete t[i][n],0===Object.keys(t[i]).length&&delete t[i];0===Object.keys(t).length&&delete u[r]}}},_extendStyles:function(n,t){var i=this.get2DCursorLocation(n);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex);this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{});fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),t)},get2DCursorLocation:function(n,t){"undefined"==typeof n&&(n=this.selectionStart);for(var r=t?this._unwrappedTextLines:this._textLines,u=r.length,i=0;u>i;i++){if(n<=r[i].length)return{lineIndex:i,charIndex:n};n-=r[i].length+this.missingNewlineOffset(i)}return{lineIndex:i-1,charIndex:r[i-1].length<n?r[i-1].length:n}},getSelectionStyles:function(n,t,i){"undefined"==typeof n&&(n=this.selectionStart||0);"undefined"==typeof t&&(t=this.selectionEnd||n);for(var u=[],r=n;t>r;r++)u.push(this.getStyleAtPosition(r,i));return u},getStyleAtPosition:function(n,t){var i=this.get2DCursorLocation(n),r=t?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex);return r||{}},setSelectionStyles:function(n,t,i){"undefined"==typeof t&&(t=this.selectionStart||0);"undefined"==typeof i&&(i=this.selectionEnd||t);for(var r=t;i>r;r++)this._extendStyles(r,n);return this._forceClearCache=!0,this},_getStyleDeclaration:function(n,t){var i=this.styles&&this.styles[n];return i?i[t]:null},getCompleteStyleDeclaration:function(n,t){for(var i,u=this._getStyleDeclaration(n,t)||{},f={},r=0;r<this._styleProperties.length;r++)i=this._styleProperties[r],f[i]="undefined"==typeof u[i]?this[i]:u[i];return f},_setStyleDeclaration:function(n,t,i){this.styles[n][t]=i},_deleteStyleDeclaration:function(n,t){delete this.styles[n][t]},_getLineStyle:function(n){return!!this.styles[n]},_setLineStyle:function(n){this.styles[n]={}},_deleteLineStyle:function(n){delete this.styles[n]}})}();!function(){function n(n){n.textDecoration&&(n.textDecoration.indexOf("underline")>-1&&(n.underline=!0),n.textDecoration.indexOf("line-through")>-1&&(n.linethrough=!0),n.textDecoration.indexOf("overline")>-1&&(n.overline=!0),delete n.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(n,t){this.callSuper("initialize",n,t);this.initBehavior()},setSelectionStart:function(n){n=Math.max(n,0);this._updateAndFire("selectionStart",n)},setSelectionEnd:function(n){n=Math.min(n,this.text.length);this._updateAndFire("selectionEnd",n)},_updateAndFire:function(n,t){this[n]!==t&&(this._fireSelectionChanged(),this[n]=t);this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor();this.clearContextTop();this.callSuper("initDimensions")},render:function(n){this.clearContextTop();this.callSuper("render",n);this.cursorOffsetCache={};this.renderCursorOrSelection()},_render:function(n){this.callSuper("_render",n)},clearContextTop:function(n){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save();t.transform(i[0],i[1],i[2],i[3],i[4],i[5]);this.transform(t);this.transformMatrix&&t.transform.apply(t,this.transformMatrix);this._clearTextArea(t);n||t.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this._getCursorBoundaries(),n=this.canvas.contextTop;this.clearContextTop(!0);this.selectionStart===this.selectionEnd?this.renderCursor(t,n):this.renderSelection(t,n);n.restore()}},_clearTextArea:function(n){var t=this.width+4,i=this.height+4;n.clearRect(-t/2,-i/2,t,i)},_getCursorBoundaries:function(n){"undefined"==typeof n&&(n=this.selectionStart);var i=this._getLeftOffset(),r=this._getTopOffset(),t=this._getCursorBoundariesOffsets(n);return{left:i,top:r,leftOffset:t.left,topOffset:t.top}},_getCursorBoundariesOffsets:function(n){var r,f;if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var e,t,u,o,s=0,i=0,h=this.get2DCursorLocation(n);for(u=h.charIndex,t=h.lineIndex,r=0;t>r;r++)s+=this.getHeightOfLine(r);return e=this._getLineLeftOffset(t),f=this.__charBounds[t][u],f&&(i=f.left),0!==this.charSpacing&&u===this._textLines[t].length&&(i-=this._getWidthOfCharSpacing()),o={top:s,left:e+(i>0?i:0)},this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(n,t){var r=this.get2DCursorLocation(),i=r.lineIndex,u=r.charIndex>0?r.charIndex-1:0,f=this.getValueOfPropertyAt(i,u,"fontSize"),s=this.scaleX*this.canvas.getZoom(),e=this.cursorWidth/s,o=n.topOffset,h=this.getValueOfPropertyAt(i,u,"deltaY");o+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-f*(1-this._fontSizeFraction);this.inCompositionMode&&this.renderSelection(n,t);t.fillStyle=this.getValueOfPropertyAt(i,u,"fill");t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;t.fillRect(n.left+n.leftOffset-e/2,o+n.top+h,e,f)},renderSelection:function(n,t){for(var v,y=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,p=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,w=-1!==this.textAlign.indexOf("justify"),h=this.get2DCursorLocation(y),c=this.get2DCursorLocation(p),e=h.lineIndex,r=c.lineIndex,b=h.charIndex<0?0:h.charIndex,o=c.charIndex<0?0:c.charIndex,i=e;r>=i;i++){var l=this._getLineLeftOffset(i)||0,s=this.getHeightOfLine(i),a=0,u=0,f=0;(i===e&&(u=this.__charBounds[e][b].left),i>=e&&r>i)?f=w&&!this.isEndOfWrapping(i)?this.width:this.getLineWidth(i)||5:i===r&&(0===o?f=this.__charBounds[r][o].left:(v=this._getWidthOfCharSpacing(),f=this.__charBounds[r][o-1].left+this.__charBounds[r][o-1].width-v));a=s;(this.lineHeight<1||i===r&&this.lineHeight>1)&&(s/=this.lineHeight);this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",t.fillRect(n.left+l+u,n.top+n.topOffset+s,f-u,1)):(t.fillStyle=this.selectionColor,t.fillRect(n.left+l+u,n.top+n.topOffset,f-u,s));n.topOffset+=a}},getCurrentCharFontSize:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fontSize")},getCurrentCharColor:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fill")},_getCurrentCharIndex:function(){var n=this.get2DCursorLocation(this.selectionStart,!0),t=n.charIndex>0?n.charIndex-1:0;return{l:n.lineIndex,c:t}}});fabric.IText.fromObject=function(t,i){var r,u;if(n(t),t.styles)for(r in t.styles)for(u in t.styles[r])n(t.styles[r][u]);fabric.Object._fromObject("IText",t,i,"text")}}();!function(){var n=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing();this.selected=!1},initAddedHandler:function(){var n=this;this.on("added",function(){var t=n.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,n._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(n))})},initRemovedHandler:function(){var n=this;this.on("removed",function(){var t=n.canvas;t&&(t._iTextInstances=t._iTextInstances||[],fabric.util.removeFromArray(t._iTextInstances,n),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,n._removeCanvasHandlers(t)))})},_initCanvasHandlers:function(n){n._mouseUpITextHandler=function(){n._iTextInstances&&n._iTextInstances.forEach(function(n){n.__isMousedown=!1})};n.on("mouse:up",n._mouseUpITextHandler)},_removeCanvasHandlers:function(n){n.off("mouse:up",n._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(n,t,i,r){var u;return u={isAborted:!1,abort:function(){this.isAborted=!0}},n.animate("_currentCursorOpacity",t,{duration:i,onComplete:function(){u.isAborted||n[r]()},onChange:function(){n.canvas&&n.selectionStart===n.selectionEnd&&n.renderCursorOrSelection()},abort:function(){return u.isAborted}}),u},_onTickComplete:function(){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){n._currentTickCompleteState=n._animateCursor(n,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(n){var t=this,i=n?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){t._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,n=this.canvas;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;t&&n&&n.clearContext(n.contextTop||n.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(n){var i=0,t=n-1;if(this._reSpace.test(this._text[t]))for(;this._reSpace.test(this._text[t]);)i++,t--;for(;/\S/.test(this._text[t])&&t>-1;)i++,t--;return n-i},findWordBoundaryRight:function(n){var i=0,t=n;if(this._reSpace.test(this._text[t]))for(;this._reSpace.test(this._text[t]);)i++,t++;for(;/\S/.test(this._text[t])&&t<this.text.length;)i++,t++;return n+i},findLineBoundaryLeft:function(n){for(var i=0,t=n-1;!/\n/.test(this._text[t])&&t>-1;)i++,t--;return n-i},findLineBoundaryRight:function(n){for(var i=0,t=n;!/\n/.test(this._text[t])&&t<this.text.length;)i++,t++;return n+i},searchWordBoundary:function(n,t){for(var i=this._reSpace.test(this.text.charAt(n))?n-1:n,r=this.text.charAt(i),u=/[ \n\.,;!\?\-]/;!u.test(r)&&i>0&&i<this.text.length;)i+=t,r=this.text.charAt(i);return u.test(r)&&"\n"!==r&&(i+=1===t?0:1),i},selectWord:function(n){n=n||this.selectionStart;var t=this.searchWordBoundary(n,-1),i=this.searchWordBoundary(n,1);this.selectionStart=t;this.selectionEnd=i;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection()},selectLine:function(n){n=n||this.selectionStart;var t=this.findLineBoundaryLeft(n),i=this.findLineBoundaryRight(n);return this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(n){if(!this.isEditing&&this.editable)return(this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(n),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this)},exitEditingOnOthers:function(n){n._iTextInstances&&n._iTextInstances.forEach(function(n){n.selected=!1;n.isEditing&&n.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(n){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(n.e),i=this.selectionStart,r=this.selectionEnd;(t===this.__selectionStartOnMouseDown&&i!==r||i!==t&&r!==t)&&(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==i||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(n,t,i){var e=i.slice(0,n),r=fabric.util.string.graphemeSplit(e).length,u,f;return n===t?{selectionStart:r,selectionEnd:r}:(u=i.slice(n,t),f=fabric.util.string.graphemeSplit(u).length,{selectionStart:r,selectionEnd:r+f})},fromGraphemeToStringSelection:function(n,t,i){var e=i.slice(0,n),r=e.join("").length,u,f;return n===t?{selectionStart:r,selectionEnd:r}:(u=i.slice(n,t),f=u.join("").length,{selectionStart:r,selectionEnd:r+f})},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var n=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=n.selectionStart;this.hiddenTextarea.selectionEnd=n.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={};this.text=this.hiddenTextarea.value;this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var n=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=n.selectionEnd;this.inCompositionMode||(this.selectionStart=n.selectionStart);this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var n=this._calcTextareaPosition();this.hiddenTextarea.style.left=n.left;this.hiddenTextarea.style.top=n.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var u=this.inCompositionMode?this.compositionStart:this.selectionStart,i=this._getCursorBoundaries(u),f=this.get2DCursorLocation(u),c=f.lineIndex,l=f.charIndex,t=this.getValueOfPropertyAt(c,l,"fontSize")*this.lineHeight,a=i.leftOffset,v=this.calcTransformMatrix(),n={x:i.left+a,y:i.top+i.topOffset+t},r=this.canvas.upperCanvasEl,e=r.width,o=r.height,s=e-t,h=o-t,y=r.clientWidth/e,p=r.clientHeight/o;return n=fabric.util.transformPoint(n,v),n=fabric.util.transformPoint(n,this.canvas.viewportTransform),n.x*=y,n.y*=p,n.x<0&&(n.x=0),n.x>s&&(n.x=s),n.y<0&&(n.y=0),n.y>h&&(n.y=h),n.x+=this.canvas._offset.left,n.y+=this.canvas._offset.top,{left:n.x+"px",top:n.y+"px",fontSize:t+"px",charHeight:t}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var n=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),n&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),n&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var n in this.styles)this._textLines[n]||delete this.styles[n]},removeStyleFromTo:function(n,t){var i,u,c=this.get2DCursorLocation(n,!0),l=this.get2DCursorLocation(t,!0),r=c.lineIndex,o=c.charIndex,f=l.lineIndex,e=l.charIndex,h,s,a;if(r!==f){if(this.styles[r])for(i=o;i<this._unwrappedTextLines[r].length;i++)delete this.styles[r][i];if(this.styles[f])for(i=e;i<this._unwrappedTextLines[f].length;i++)u=this.styles[f][i],u&&(this.styles[r]||(this.styles[r]={}),this.styles[r][o+i-e]=u);for(i=r+1;f>=i;i++)delete this.styles[i];this.shiftLineStyles(f,r-f)}else if(this.styles[r]){for(u=this.styles[r],a=e-o,i=o;e>i;i++)delete u[i];for(s in this.styles[r])h=parseInt(s,10),h>=e&&(u[h-a]=u[s],delete u[s])}},shiftLineStyles:function(t,i){var u=n(this.styles),f,r;for(f in this.styles)r=parseInt(f,10),r>t&&(this.styles[r+i]=u[r],u[r-i]||delete this.styles[r])},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(t,i,r,u){var e,s={},h=!1,f,o;r||(r=1);this.shiftLineStyles(t,r);this.styles[t]&&(e=this.styles[t][0===i?i:i-1]);for(f in this.styles[t])o=parseInt(f,10),o>=i&&(h=!0,s[o-i]=this.styles[t][f],delete this.styles[t][f]);for(h?this.styles[t+r]=s:delete this.styles[t+r];r>1;)r--,u&&u[r]?this.styles[t+r]={0:n(u[r])}:e?this.styles[t+r]={0:n(e)}:delete this.styles[t+r];this._forceClearCache=!0},insertCharStyleObject:function(t,i,r,u){var f,o,h,e,s;this.styles||(this.styles={});f=this.styles[t];o=f?n(f):{};r||(r=1);for(h in o)e=parseInt(h,10),e>=i&&(f[e+r]=o[e],o[e-r]||delete f[e]);if(this._forceClearCache=!0,u)for(;r--;)Object.keys(u[r]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][i+r]=n(u[r]));else if(f)for(s=f[i?i-1:1];s&&r--;)this.styles[t][i+r]=n(s)},insertNewStyleBlock:function(n,t,i){for(var f=this.get2DCursorLocation(t,!0),u=[0],e=0,r=0;r<n.length;r++)"\n"===n[r]?(e++,u[e]=0):u[e]++;for(u[0]>0&&(this.insertCharStyleObject(f.lineIndex,f.charIndex,u[0],i),i=i&&i.slice(u[0]+1)),e&&this.insertNewlineStyleObject(f.lineIndex,f.charIndex+u[0],e),r=1;e>r;r++)u[r]>0?this.insertCharStyleObject(f.lineIndex+r,0,u[r],i):i&&(this.styles[f.lineIndex+r][0]=i[0]),i=i&&i.slice(u[r]+1);u[r]>0&&this.insertCharStyleObject(f.lineIndex+r,0,u[r],i)},setSelectionStartEndWithShift:function(n,t,i){n>=i?(t===n?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=n),this.selectionStart=i):i>n&&t>i?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(t===n?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=t),this.selectionEnd=i)},setSelectionInBoundaries:function(){var n=this.text.length;this.selectionStart>n?this.selectionStart=n:this.selectionStart<0&&(this.selectionStart=0);this.selectionEnd>n?this.selectionEnd=n:this.selectionEnd<0&&(this.selectionEnd=0)}})}();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown)},onMouseDown:function(n){if(this.canvas){this.__newClickTime=+new Date;var t=n.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",n),this._stopEvent(n.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=t;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected}},isTripleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y},_stopEvent:function(n){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("mousedblclick",function(n){this.selectWord(this.getSelectionStartFromPointer(n.e))});this.on("tripleclick",function(n){this.selectLine(this.getSelectionStartFromPointer(n.e))})},_mouseDownHandler:function(n){this.canvas&&this.editable&&(!n.e.button||1===n.e.button)&&(this.__isMousedown=!0,this.selected&&this.setCursorByClick(n.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(n){this.canvas&&this.editable&&(!n.e.button||1===n.e.button)&&this===this.canvas._activeObject&&(this.selected=!0)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler);this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(n){if(this.__isMousedown=!1,!(!this.editable||this.group||n.transform&&n.transform.actionPerformed||n.e.button&&1!==n.e.button)){if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(n.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(n){var t=this.getSelectionStartFromPointer(n),i=this.selectionStart,r=this.selectionEnd;n.shiftKey?this.setSelectionStartEndWithShift(i,r,t):(this.selectionStart=t,this.selectionEnd=t);this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(n){for(var u,o,s,h,f=this.getLocalPointer(n),c=0,i=0,l=0,e=0,r=0,t=0,a=this._textLines.length;a>t&&l<=f.y;t++)l+=this.getHeightOfLine(t)*this.scaleY,r=t,t>0&&(e+=this._textLines[t-1].length+this.missingNewlineOffset(t-1));for(s=this._getLineLeftOffset(r),i=s*this.scaleX,h=this._textLines[r],u=0,o=h.length;o>u&&(c=i,i+=this.__charBounds[r][u].kernedWidth*this.scaleX,i<=f.x);u++)e++;return this._getNewSelectionStartFromOffset(f,c,i,e,o)},_getNewSelectionStartFromOffset:function(n,t,i,r,u){var o=n.x-t,e=i-n.x,s=e>o||0>e?0:1,f=r+s;return this.flipX&&(f=u-f),f>this._text.length&&(f=this._text.length),f}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.setAttribute("autocorrect","off");this.hiddenTextarea.setAttribute("autocomplete","off");this.hiddenTextarea.setAttribute("spellcheck","false");this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea","");this.hiddenTextarea.setAttribute("wrap","off");var n=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+n.top+"; left: "+n.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+n.fontSize+";";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(n){if(this.isEditing&&!this.inCompositionMode){if(n.keyCode in this.keysMap)this[this.keysMap[n.keyCode]](n);else{if(!(n.keyCode in this.ctrlKeysMapDown&&(n.ctrlKey||n.metaKey)))return;this[this.ctrlKeysMapDown[n.keyCode]](n)}n.stopImmediatePropagation();n.preventDefault();n.keyCode>=33&&n.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(n){return!this.isEditing||this._copyDone||this.inCompositionMode?void(this._copyDone=!1):void(n.keyCode in this.ctrlKeysMapUp&&(n.ctrlKey||n.metaKey)&&(this[this.ctrlKeysMapUp[n.keyCode]](n),n.stopImmediatePropagation(),n.preventDefault(),this.canvas&&this.canvas.requestRenderAll()))},onInput:function(n){var h=this.fromPaste,u,f;if(this.fromPaste=!1,n&&n.stopPropagation(),this.isEditing){var t,i,e=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,o=this._text.length,s=e.length,r=s-o;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));u=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);f=this.selectionStart>u.selectionStart;this.selectionStart!==this.selectionEnd?(t=this._text.slice(this.selectionStart,this.selectionEnd),r+=this.selectionEnd-this.selectionStart):o>s&&(t=f?this._text.slice(this.selectionEnd+r,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-r));i=e.slice(u.selectionEnd-r,u.selectionEnd);t&&t.length&&(this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):f?this.removeStyleFromTo(this.selectionEnd-t.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+t.length));i.length&&(h&&i.join("")===fabric.copiedText&&!fabric.disableStyleCopyPaste?this.insertNewStyleBlock(i,this.selectionStart,fabric.copiedTextStyle):this.insertNewStyleBlock(i,this.selectionStart));this.updateFromTextArea();this.fire("changed");this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(n){this.compositionStart=n.target.selectionStart;this.compositionEnd=n.target.selectionEnd;this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=fabric.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(n){return n&&n.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(n,t){var i,r=this._getLineLeftOffset(n);return t>0&&(i=this.__charBounds[n][t-1],r+=i.left+i.width),r},getDownCursorOffset:function(n,t){var r=this._getSelectionForOffset(n,t),u=this.get2DCursorLocation(r),i=u.lineIndex;if(i===this._textLines.length-1||n.metaKey||34===n.keyCode)return this._text.length-r;var f=u.charIndex,e=this._getWidthBeforeCursor(i,f),o=this._getIndexOnLine(i+1,e),s=this._textLines[i].slice(f);return s.length+o+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(n,t){return n.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(n,t){var r=this._getSelectionForOffset(n,t),u=this.get2DCursorLocation(r),i=u.lineIndex;if(0===i||n.metaKey||33===n.keyCode)return-r;var f=u.charIndex,e=this._getWidthBeforeCursor(i,f),o=this._getIndexOnLine(i-1,e),s=this._textLines[i].slice(0,f),h=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+o-s.length+(1-h)},_getIndexOnLine:function(n,t){for(var u,e,o=this._textLines[n],s=this._getLineLeftOffset(n),r=s,f=0,i=0,h=o.length;h>i;i++)if(u=this.__charBounds[n][i].width,r+=u,r>t){e=!0;var c=r-u,l=r,a=Math.abs(c-t),v=Math.abs(l-t);f=a>v?i:i-1;break}return e||(f=o.length-1),f},moveCursorDown:function(n){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",n)},moveCursorUp:function(n){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorUpOrDown("Up",n)},_moveCursorUpOrDown:function(n,t){var r="get"+n+"CursorOffset",i=this[r](t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i);0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(n){var t="left"===this._selectionDirection?this.selectionStart+n:this.selectionEnd+n;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),0!==n},moveCursorWithoutShift:function(n){return 0>n?(this.selectionStart+=n,this.selectionEnd=this.selectionStart):(this.selectionEnd+=n,this.selectionStart=this.selectionEnd),0!==n},moveCursorLeft:function(n){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorLeftOrRight("Left",n)},_move:function(n,t,i){var r;if(n.altKey)r=this["findWordBoundary"+i](this[t]);else{if(!n.metaKey&&35!==n.keyCode&&36!==n.keyCode)return this[t]+="Left"===i?-1:1,!0;r=this["findLineBoundary"+i](this[t])}if(void 0!==typeof r&&this[t]!==r)return(this[t]=r,!0)},_moveLeft:function(n,t){return this._move(n,t,"Left")},_moveRight:function(n,t){return this._move(n,t,"Right")},moveCursorLeftWithoutShift:function(n){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(n,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(n){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(n,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(n,"selectionStart")):void 0},moveCursorRight:function(n){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",n)},_moveCursorLeftOrRight:function(n,t){var i="moveCursor"+n+"With";this._currentCursorOpacity=1;i+=t.shiftKey?"Shift":"outShift";this[i](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(n){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(n,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(n,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(n){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(n,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(n,t){"undefined"==typeof t&&(t=n+1);this.removeStyleFromTo(n,t);this._text.splice(n,t-n);this.text=this._text.join("");this.set("dirty",!0);this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());this._removeExtraneousStyles()},insertChars:function(n,t,i,r){"undefined"==typeof r&&(r=i);r>i&&this.removeStyleFromTo(i,r);var u=fabric.util.string.graphemeSplit(n);this.insertNewStyleBlock(u,i,t);this._text=[].concat(this._text.slice(0,i),u,this._text.slice(r));this.text=this._text.join("");this.set("dirty",!0);this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());this._removeExtraneousStyles()}});!function(){var n=fabric.util.toFixed,t=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var n=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(t)},toSVG:function(n){return this._createBaseSVGMarkup(this._toSVG(),{reviver:n,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(n){var t=this.getSvgTextDecoration(this);return[n.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",n.textSpans.join(""),"<\/text>\n"]},_getSVGTextAndBg:function(n,t){var r,e=[],u=[],f=n,i,o;for(this._setSVGBg(u),i=0,o=this._textLines.length;o>i;i++)r=this._getLineLeftOffset(i),(this.textBackgroundColor||this.styleHas("textBackgroundColor",i))&&this._setSVGTextLineBg(u,i,t+r,f),this._setSVGTextLineText(e,i,t+r,f),f+=this.getHeightOfLine(i);return{textSpans:e,textBgRects:u}},_createTextCharSpan:function(i,r,u,f){var c=i!==i.trim()||i.match(t),o=this.getSvgSpanStyles(r,c),l=o?'style="'+o+'"':"",s=r.deltaY,h="",e=fabric.Object.NUM_FRACTION_DIGITS;return s&&(h=' dy="'+n(s,e)+'" '),['<tspan x="',n(u,e),'" y="',n(f,e),'" ',h,l,">",fabric.util.string.escapeXml(i),"<\/tspan>"].join("")},_setSVGTextLineText:function(n,t,i,r){var s,h,e,v,f,y=this.getHeightOfLine(t),p=-1!==this.textAlign.indexOf("justify"),c="",o=0,l=this._textLines[t],u,a;for(r+=y*(1-this._fontSizeFraction)/this.lineHeight,u=0,a=l.length-1;a>=u;u++)f=u===a||this.charSpacing,c+=l[u],e=this.__charBounds[t][u],0===o?(i+=e.kernedWidth-e.width,o+=e.width):o+=e.kernedWidth,p&&!f&&this._reSpaceAndTab.test(l[u])&&(f=!0),f||(s=s||this.getCompleteStyleDeclaration(t,u),h=this.getCompleteStyleDeclaration(t,u+1),f=this._hasStyleChangedForSvg(s,h)),f&&(v=this._getStyleDeclaration(t,u)||{},n.push(this._createTextCharSpan(c,v,i,r)),c="",s=h,i+=o,o=0)},_pushTextBgRect:function(t,i,r,u,f,e){var o=fabric.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(i),' x="',n(r,o),'" y="',n(u,o),'" width="',n(f,o),'" height="',n(e,o),'"><\/rect>\n')},_setSVGTextLineBg:function(n,t,i,r){for(var f,u,l=this._textLines[t],c=this.getHeightOfLine(t)/this.lineHeight,e=0,h=0,o=this.getValueOfPropertyAt(t,0,"textBackgroundColor"),s=0,a=l.length;a>s;s++)f=this.__charBounds[t][s],u=this.getValueOfPropertyAt(t,s,"textBackgroundColor"),u!==o?(o&&this._pushTextBgRect(n,o,i+h,r,e,c),h=f.left,e=f.width,o=u):e+=f.kernedWidth;u&&this._pushTextBgRect(n,u,i+h,r,e,c)},_getFillAttributes:function(n){var t=n&&"string"==typeof n?new fabric.Color(n):"";return t&&t.getSource()&&1!==t.getAlpha()?'opacity="'+t.getAlpha()+'" fill="'+t.setAlpha(1).toRgb()+'"':'fill="'+n+'"'},_getSVGLineTopOffset:function(n){for(var i=0,r=0,t=0;n>t;t++)i+=this.getHeightOfLine(t);return r=this.getHeightOfLine(t),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(n){var t=fabric.Object.prototype.getSvgStyles.call(this,n);return t+" white-space: pre;"}})}();!function(n){"use strict";var t=n.fabric||(n.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(n){for(var u=0,r=0,i=0,f={},t=0;t<n.graphemeLines.length;t++)"\n"===n.graphemeText[i]&&t>0?(r=0,i++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(n.graphemeText[i])&&t>0&&(r++,i++),f[t]={line:u,offset:r},i+=n.graphemeLines[t].length,r+=n.graphemeLines[t].length;return f},styleHas:function(n,i){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[i];r&&(i=r.line)}return t.Text.prototype.styleHas.call(this,n,i)},isEmptyStyles:function(n){var e,t,o=0,s=n+1,h=!1,r=this._styleMap[n],u=this._styleMap[n+1],f,i,c;r&&(n=r.line,o=r.offset);u&&(s=u.line,h=s===n,e=u.offset);t="undefined"==typeof n?this.styles:{line:this.styles[n]};for(f in t)for(i in t[f])if(i>=o&&(!h||e>i))for(c in t[f][i])return!1;return!0},_getStyleDeclaration:function(n,t){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[n];if(!i)return null;n=i.line;t=i.offset+t}return this.callSuper("_getStyleDeclaration",n,t)},_setStyleDeclaration:function(n,t,i){var r=this._styleMap[n];n=r.line;t=r.offset+t;this.styles[n][t]=i},_deleteStyleDeclaration:function(n,t){var i=this._styleMap[n];n=i.line;t=i.offset+t;delete this.styles[n][t]},_getLineStyle:function(n){var t=this._styleMap[n];return!!this.styles[t.line]},_setLineStyle:function(n){var t=this._styleMap[n];this.styles[t.line]={}},_wrapText:function(n,t){var i,r=[];for(this.isWrapping=!0,i=0;i<n.length;i++)r=r.concat(this._wrapLine(n[i],i,t));return this.isWrapping=!1,r},_measureWord:function(n,t,i){var u,f=0,r,e,o;for(i=i||0,r=0,e=n.length;e>r;r++)o=this._getGraphemeBox(n[r],t,r+i,u,!0),f+=o.kernedWidth,u=n[r];return f},_wrapLine:function(n,i,r,u){var c=0,o=this.splitByGrapheme,p=[],f=[],s=o?t.util.string.graphemeSplit(n):n.split(this._wordJoiners),l="",a=0,b=o?"":" ",h=0,k=0,v=0,y=!0,w=o?0:this._getWidthOfCharSpacing(),u=u||0,e;for(0===s.length&&s.push([]),r-=u,e=0;e<s.length;e++)l=o?s[e]:t.util.string.graphemeSplit(s[e]),h=this._measureWord(l,i,a),a+=l.length,c+=k+h-w,c>=r&&!y?(p.push(f),f=[],c=h,y=!0):c+=w,y||o||f.push(b),f=f.concat(l),k=this._measureWord([b],i,a),a++,y=!1,h>v&&(v=h);return e&&p.push(f),v+u>this.dynamicMinWidth&&(this.dynamicMinWidth=v-w+u),p},isEndOfWrapping:function(n){return this._styleMap[n+1]?this._styleMap[n+1].line!==this._styleMap[n].line?!0:!1:!0},missingNewlineOffset:function(n){return this.splitByGrapheme?this.isEndOfWrapping(n)?1:0:1},_splitTextIntoLines:function(n){for(var i=t.Text.prototype._splitTextIntoLines.call(this,n),r=this._wrapText(i.lines,this.width),f=new Array(r.length),u=0;u<r.length;u++)f[u]=r[u].join("");return i.lines=f,i.graphemeLines=r,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var t={};for(var n in this._styleMap)this._textLines[n]&&(t[this._styleMap[n].line]=1);for(n in this.styles)t[n]||delete this.styles[n]},toObject:function(n){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(n))}});t.Textbox.fromObject=function(n,i){return t.Object._fromObject("Textbox",n,i,"text")}}("undefined"!=typeof exports?exports:this);!function(){var n=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(t,i,r,u,f,e,o){var c,s=i.target,a=t.x*s.scaleX/o.x,v=t.y*s.scaleY/o.y,l,h;return("x"===f&&s instanceof fabric.Textbox)?(l=s._getTransformedDimensions().x,h=s.width*(t.x/l),i.newScaleX=a,i.newScaleY=v,h>=s.getMinWidth()?(c=h!==s.width,s.set("width",h),c):void 0):n.call(fabric.Canvas.prototype,t,i,r,u,f,e,o)};fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var n in this._styleMap)this._textLines[n]||delete this.styles[this._styleMap[n].line]}})}();
/*! Select2 4.0.8 | https://github.com/select2/select2/blob/master/LICENSE.md */
!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(t,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(t)),n(i),i}:n(jQuery)}(function(n){var t=function(){function u(n,t){return d.call(n,t)}function l(n,t){var e,o,s,f,h,y,c,p,i,l,b,u=t&&t.split("/"),a=r.map,v=a&&a["*"]||{};if(n){for(h=(n=n.split("/")).length-1,r.nodeIdCompat&&w.test(n[h])&&(n[h]=n[h].replace(w,"")),"."===n[0].charAt(0)&&u&&(n=u.slice(0,u.length-1).concat(n)),i=0;i<n.length;i++)if("."===(b=n[i]))n.splice(i,1),i-=1;else if(".."===b){if(0===i||1===i&&".."===n[2]||".."===n[i-1])continue;0<i&&(n.splice(i-1,2),i-=2)}n=n.join("/")}if((u||v)&&a){for(i=(e=n.split("/")).length;0<i;i-=1){if(o=e.slice(0,i).join("/"),u)for(l=u.length;0<l;l-=1)if(s=(s=a[u.slice(0,l).join("/")])&&s[o]){f=s;y=i;break}if(f)break;!c&&v&&v[o]&&(c=v[o],p=i)}!f&&c&&(f=c,y=p);f&&(e.splice(0,y,f),n=e.join("/"))}return n}function nt(n,t){return function(){var i=g.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),o.apply(f,i.concat([n,t]))}}function it(n){return function(t){i[n]=t}}function a(n){if(u(e,n)){var t=e[n];delete e[n];c[n]=!0;h.apply(f,t)}if(!u(i,n)&&!u(c,n))throw new Error("No "+n);return i[n]}function b(n){var i,t=n?n.indexOf("!"):-1;return-1<t&&(i=n.substring(0,t),n=n.substring(t+1,n.length)),[i,n]}function tt(n){return n?b(n):[]}var t,v,y,k,f,h,o,p,s,i,e,r,c,d,g,w;return n&&n.fn&&n.fn.select2&&n.fn.select2.amd&&(t=n.fn.select2.amd),t&&t.requirejs||(t?y=t:t={},i={},e={},r={},c={},d=Object.prototype.hasOwnProperty,g=[].slice,w=/\.js$/,p=function(n,t){var r,u=b(n),i=u[0],f=t[1];return n=u[1],i&&(r=a(i=l(i,f))),i?n=r&&r.normalize?r.normalize(n,function(n){return function(t){return l(t,n)}}(f)):l(n,f):(i=(u=b(n=l(n,f)))[0],n=u[1],i&&(r=a(i))),{f:i?i+"!"+n:n,n:n,pr:i,p:r}},s={require:function(n){return nt(n)},exports:function(n){var t=i[n];return void 0!==t?t:i[n]={}},module:function(n){return{id:n,uri:"",exports:i[n],config:function(n){return function(){return r&&r.config&&r.config[n]||{}}}(n)}}},h=function(n,t,r,o){var y,h,b,w,l,k,d,v=[],g=typeof r;if(k=tt(o=o||n),"undefined"==g||"function"==g){for(t=!t.length&&r.length?["require","exports","module"]:t,l=0;l<t.length;l+=1)if("require"===(h=(w=p(t[l],k)).f))v[l]=s.require(n);else if("exports"===h)v[l]=s.exports(n),d=!0;else if("module"===h)y=v[l]=s.module(n);else if(u(i,h)||u(e,h)||u(c,h))v[l]=a(h);else{if(!w.p)throw new Error(n+" missing "+h);w.p.load(w.n,nt(o,!0),it(h),{});v[l]=i[h]}b=r?r.apply(i[n],v):void 0;n&&(y&&y.exports!==f&&y.exports!==i[n]?i[n]=y.exports:b===f&&d||(i[n]=b))}else n&&(i[n]=r)},v=y=o=function(n,t,i,u,e){if("string"==typeof n)return s[n]?s[n](t):a(p(n,tt(t)).f);if(!n.splice){if((r=n).deps&&o(r.deps,r.callback),!t)return;t.splice?(n=t,t=i,i=null):n=f}return t=t||function(){},"function"==typeof i&&(i=u,u=e),u?h(f,n,t,i):setTimeout(function(){h(f,n,t,i)},4),o},o.config=function(n){return o(n)},v._defined=i,(k=function(n,t,r){if("string"!=typeof n)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]);u(i,n)||u(e,n)||(e[n]=[n,t,r])}).amd={jQuery:!0},t.requirejs=v,t.require=y,t.define=k),t.define("almond",function(){}),t.define("jquery",[],function(){var t=n||$;return null==t&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),t}),t.define("select2/utils",["jquery"],function(n){function u(n){var i=n.prototype,r=[];for(var t in i)"function"==typeof i[t]&&"constructor"!==t&&r.push(t);return r}function i(){this.listeners={}}var t={},r;return t.Extend=function(n,t){function r(){this.constructor=n}var u={}.hasOwnProperty;for(var i in t)u.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},t.Decorate=function(n,t){function i(){var r=Array.prototype.unshift,u=t.prototype.constructor.length,i=n.prototype.constructor;0<u&&(r.call(arguments,n.prototype.constructor),i=t.prototype.constructor);i.apply(this,arguments)}function c(n){var r=function(){},u;return n in i.prototype&&(r=i.prototype[n]),u=t.prototype[n],function(){return Array.prototype.unshift.call(arguments,r),u.apply(this,arguments)}}var s=u(t),h=u(n),r,e,f,o;for(t.displayName=n.displayName,i.prototype=new function(){this.constructor=i},r=0;r<h.length;r++)e=h[r],i.prototype[e]=n.prototype[e];for(f=0;f<s.length;f++)o=s[f],i.prototype[o]=c(o);return i},i.prototype.on=function(n,t){this.listeners=this.listeners||{};n in this.listeners?this.listeners[n].push(t):this.listeners[n]=[t]},i.prototype.trigger=function(n){var i=Array.prototype.slice,t=i.call(arguments,1);this.listeners=this.listeners||{};null==t&&(t=[]);0===t.length&&t.push({});(t[0]._type=n)in this.listeners&&this.invoke(this.listeners[n],i.call(arguments,1));"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},i.prototype.invoke=function(n,t){for(var i=0,r=n.length;i<r;i++)n[i].apply(this,t)},t.Observable=i,t.generateChars=function(n){for(var t="",i=0;i<n;i++)t+=Math.floor(36*Math.random()).toString(36);return t},t.bind=function(n,t){return function(){n.apply(t,arguments)}},t._convertData=function(n){var f,r,i,u,t;for(f in n)if(r=f.split("-"),i=n,1!==r.length){for(u=0;u<r.length;u++)t=r[u],(t=t.substring(0,1).toLowerCase()+t.substring(1))in i||(i[t]={}),u==r.length-1&&(i[t]=n[f]),i=i[t];delete n[f]}return n},t.hasScroll=function(t,i){var u=n(i),f=i.style.overflowX,r=i.style.overflowY;return(f!==r||"hidden"!==r&&"visible"!==r)&&("scroll"===f||"scroll"===r||u.innerHeight()<i.scrollHeight||u.innerWidth()<i.scrollWidth)},t.escapeMarkup=function(n){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof n?n:String(n).replace(/[&<>"'\/\\]/g,function(n){return t[n]})},t.appendMany=function(t,i){if("1.7"===n.fn.jquery.substr(0,3)){var r=n();n.map(i,function(n){r=r.add(n)});i=r}t.append(i)},t.__cache={},r=0,t.GetUniqueElementId=function(n){var t=n.getAttribute("data-select2-id");return null==t&&(n.id?(t=n.id,n.setAttribute("data-select2-id",t)):(n.setAttribute("data-select2-id",++r),t=r.toString())),t},t.StoreData=function(n,i,r){var u=t.GetUniqueElementId(n);t.__cache[u]||(t.__cache[u]={});t.__cache[u][i]=r},t.GetData=function(i,r){var u=t.GetUniqueElementId(i);return r?t.__cache[u]&&null!=t.__cache[u][r]?t.__cache[u][r]:n(i).data(r):t.__cache[u]},t.RemoveData=function(n){var i=t.GetUniqueElementId(n);null!=t.__cache[i]&&delete t.__cache[i]},t}),t.define("select2/results",["jquery","./utils"],function(n,t){function i(n,t,r){this.$element=n;this.data=r;this.options=t;i.__super__.constructor.call(this)}return t.Extend(i,t.Observable),i.prototype.render=function(){var t=n('<ul class="select2-results__options" role="tree"><\/ul>');return this.options.get("multiple")&&t.attr("aria-multiselectable","true"),this.$results=t},i.prototype.clear=function(){this.$results.empty()},i.prototype.displayMessage=function(t){var u=this.options.get("escapeMarkup"),i,r;this.clear();this.hideLoading();i=n('<li role="treeitem" aria-live="assertive" class="select2-results__option"><\/li>');r=this.options.get("translations").get(t.message);i.append(u(r(t.args)));i[0].className+=" select2-results__message";this.$results.append(i)},i.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},i.prototype.append=function(n){var i,t,r,u;if(this.hideLoading(),i=[],null!=n.results&&0!==n.results.length){for(n.results=this.sort(n.results),t=0;t<n.results.length;t++)r=n.results[t],u=this.option(r),i.push(u);this.$results.append(i)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},i.prototype.position=function(n,t){t.find(".select2-results").append(n)},i.prototype.sort=function(n){return this.options.get("sorter")(n)},i.prototype.highlightFirstItem=function(){var n=this.$results.find(".select2-results__option[aria-selected]"),t=n.filter("[aria-selected=true]");0<t.length?t.first().trigger("mouseenter"):n.first().trigger("mouseenter");this.ensureHighlightVisible()},i.prototype.setClasses=function(){var i=this;this.data.current(function(r){var u=n.map(r,function(n){return n.id.toString()});i.$results.find(".select2-results__option[aria-selected]").each(function(){var r=n(this),i=t.GetData(this,"data"),f=""+i.id;null!=i.element&&i.element.selected||null==i.element&&-1<n.inArray(f,u)?r.attr("aria-selected","true"):r.attr("aria-selected","false")})})},i.prototype.showLoading=function(n){this.hideLoading();var i={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(n)},t=this.option(i);t.className+=" loading-results";this.$results.prepend(t)},i.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},i.prototype.option=function(i){var u=document.createElement("li"),r,l,o,a,s,f,h,e,v,y,c;u.className="select2-results__option";r={role:"treeitem","aria-selected":"false"};l=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(o in(null!=i.element&&l.call(i.element,":disabled")||null==i.element&&i.disabled)&&(delete r["aria-selected"],r["aria-disabled"]="true"),null==i.id&&delete r["aria-selected"],null!=i._resultId&&(u.id=i._resultId),i.title&&(u.title=i.title),i.children&&(r.role="group",r["aria-label"]=i.text,delete r["aria-selected"]),r)a=r[o],u.setAttribute(o,a);if(i.children){for(s=n(u),f=document.createElement("strong"),f.className="select2-results__group",n(f),this.template(i,f),h=[],e=0;e<i.children.length;e++)v=i.children[e],y=this.option(v),h.push(y);c=n("<ul><\/ul>",{"class":"select2-results__options select2-results__options--nested"});c.append(h);s.append(f);s.append(c)}else this.template(i,u);return t.StoreData(u,"data",i),u},i.prototype.bind=function(i){var r=this,u=i.id+"-results";this.$results.attr("id",u);i.on("results:all",function(n){r.clear();r.append(n.data);i.isOpen()&&(r.setClasses(),r.highlightFirstItem())});i.on("results:append",function(n){r.append(n.data);i.isOpen()&&r.setClasses()});i.on("query",function(n){r.hideMessages();r.showLoading(n)});i.on("select",function(){i.isOpen()&&(r.setClasses(),r.options.get("scrollAfterSelect")&&r.highlightFirstItem())});i.on("unselect",function(){i.isOpen()&&(r.setClasses(),r.options.get("scrollAfterSelect")&&r.highlightFirstItem())});i.on("open",function(){r.$results.attr("aria-expanded","true");r.$results.attr("aria-hidden","false");r.setClasses();r.ensureHighlightVisible()});i.on("close",function(){r.$results.attr("aria-expanded","false");r.$results.attr("aria-hidden","true");r.$results.removeAttr("aria-activedescendant")});i.on("results:toggle",function(){var n=r.getHighlightedResults();0!==n.length&&n.trigger("mouseup")});i.on("results:select",function(){var n=r.getHighlightedResults(),i;0!==n.length&&(i=t.GetData(n[0],"data"),"true"==n.attr("aria-selected")?r.trigger("close",{}):r.trigger("select",{data:i}))});i.on("results:previous",function(){var i=r.getHighlightedResults(),u=r.$results.find("[aria-selected]"),f=u.index(i),n,t;if(!(f<=0)){n=f-1;0===i.length&&(n=0);t=u.eq(n);t.trigger("mouseenter");var e=r.$results.offset().top,o=t.offset().top,s=r.$results.scrollTop()+(o-e);0===n?r.$results.scrollTop(0):o-e<0&&r.$results.scrollTop(s)}});i.on("results:next",function(){var e=r.getHighlightedResults(),t=r.$results.find("[aria-selected]"),i=t.index(e)+1,n;if(!(i>=t.length)){n=t.eq(i);n.trigger("mouseenter");var u=r.$results.offset().top+r.$results.outerHeight(!1),f=n.offset().top+n.outerHeight(!1),o=r.$results.scrollTop()+f-u;0===i?r.$results.scrollTop(0):u<f&&r.$results.scrollTop(o)}});i.on("results:focus",function(n){n.element.addClass("select2-results__option--highlighted")});i.on("results:message",function(n){r.displayMessage(n)});n.fn.mousewheel&&this.$results.on("mousewheel",function(n){var t=r.$results.scrollTop(),i=r.$results.get(0).scrollHeight-t+n.deltaY,u=0<n.deltaY&&t-n.deltaY<=0,f=n.deltaY<0&&i<=r.$results.height();u?(r.$results.scrollTop(0),n.preventDefault(),n.stopPropagation()):f&&(r.$results.scrollTop(r.$results.get(0).scrollHeight-r.$results.height()),n.preventDefault(),n.stopPropagation())});this.$results.on("mouseup",".select2-results__option[aria-selected]",function(i){var f=n(this),u=t.GetData(this,"data");"true"!==f.attr("aria-selected")?r.trigger("select",{originalEvent:i,data:u}):r.options.get("multiple")?r.trigger("unselect",{originalEvent:i,data:u}):r.trigger("close",{})});this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(){var i=t.GetData(this,"data");r.getHighlightedResults().removeClass("select2-results__option--highlighted");r.trigger("results:focus",{data:i,element:n(this)})})},i.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},i.prototype.destroy=function(){this.$results.remove()},i.prototype.ensureHighlightVisible=function(){var n=this.getHighlightedResults();if(0!==n.length){var f=this.$results.find("[aria-selected]").index(n),t=this.$results.offset().top,i=n.offset().top,r=this.$results.scrollTop()+(i-t),u=i-t;r-=2*n.outerHeight(!1);f<=2?this.$results.scrollTop(0):(u>this.$results.outerHeight()||u<0)&&this.$results.scrollTop(r)}},i.prototype.template=function(t,i){var u=this.options.get("templateResult"),f=this.options.get("escapeMarkup"),r=u(t,i);null==r?i.style.display="none":"string"==typeof r?i.innerHTML=f(r):n(i).append(r)},i}),t.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),t.define("select2/selection/base",["jquery","../utils","../keys"],function(n,t,i){function r(n,t){this.$element=n;this.options=t;r.__super__.constructor.call(this)}return t.Extend(r,t.Observable),r.prototype.render=function(){var i=n('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"><\/span>');return this._tabindex=0,null!=t.GetData(this.$element[0],"old-tabindex")?this._tabindex=t.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),i.attr("title",this.$element.attr("title")),i.attr("tabindex",this._tabindex),this.$selection=i},r.prototype.bind=function(n){var t=this,r=(n.id,n.id+"-results");this.container=n;this.$selection.on("focus",function(n){t.trigger("focus",n)});this.$selection.on("blur",function(n){t._handleBlur(n)});this.$selection.on("keydown",function(n){t.trigger("keypress",n);n.which===i.SPACE&&n.preventDefault()});n.on("results:focus",function(n){t.$selection.attr("aria-activedescendant",n.data._resultId)});n.on("selection:update",function(n){t.update(n.data)});n.on("open",function(){t.$selection.attr("aria-expanded","true");t.$selection.attr("aria-owns",r);t._attachCloseHandler(n)});n.on("close",function(){t.$selection.attr("aria-expanded","false");t.$selection.removeAttr("aria-activedescendant");t.$selection.removeAttr("aria-owns");t.$selection.trigger("focus");t._detachCloseHandler(n)});n.on("enable",function(){t.$selection.attr("tabindex",t._tabindex)});n.on("disable",function(){t.$selection.attr("tabindex","-1")})},r.prototype._handleBlur=function(t){var i=this;window.setTimeout(function(){document.activeElement==i.$selection[0]||n.contains(i.$selection[0],document.activeElement)||i.trigger("blur",t)},1)},r.prototype._attachCloseHandler=function(i){n(document.body).on("mousedown.select2."+i.id,function(i){var r=n(i.target).closest(".select2");n(".select2.select2-container--open").each(function(){n(this);this!=r[0]&&t.GetData(this,"element").select2("close")})})},r.prototype._detachCloseHandler=function(t){n(document.body).off("mousedown.select2."+t.id)},r.prototype.position=function(n,t){t.find(".selection").append(n)},r.prototype.destroy=function(){this._detachCloseHandler(this.container)},r.prototype.update=function(){throw new Error("The `update` method must be defined in child classes.");},r}),t.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(n,t,i){function r(){r.__super__.constructor.apply(this,arguments)}return i.Extend(r,t),r.prototype.render=function(){var n=r.__super__.render.call(this);return n.addClass("select2-selection--single"),n.html('<span class="select2-selection__rendered"><\/span><span class="select2-selection__arrow" role="presentation"><b role="presentation"><\/b><\/span>'),n},r.prototype.bind=function(n){var i=this,t;r.__super__.bind.apply(this,arguments);t=n.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",t).attr("role","textbox").attr("aria-readonly","true");this.$selection.attr("aria-labelledby",t);this.$selection.on("mousedown",function(n){1===n.which&&i.trigger("toggle",{originalEvent:n})});this.$selection.on("focus",function(){});this.$selection.on("blur",function(){});n.on("focus",function(){n.isOpen()||i.$selection.trigger("focus")})},r.prototype.clear=function(){var n=this.$selection.find(".select2-selection__rendered");n.empty();n.removeAttr("title")},r.prototype.display=function(n,t){var i=this.options.get("templateSelection");return this.options.get("escapeMarkup")(i(n,t))},r.prototype.selectionContainer=function(){return n("<span><\/span>")},r.prototype.update=function(n){if(0!==n.length){var t=n[0],i=this.$selection.find(".select2-selection__rendered"),r=this.display(t,i);i.empty().append(r);i.attr("title",t.title||t.text)}else this.clear()},r}),t.define("select2/selection/multiple",["jquery","./base","../utils"],function(n,t,i){function r(){r.__super__.constructor.apply(this,arguments)}return i.Extend(r,t),r.prototype.render=function(){var n=r.__super__.render.call(this);return n.addClass("select2-selection--multiple"),n.html('<ul class="select2-selection__rendered"><\/ul>'),n},r.prototype.bind=function(){var t=this;r.__super__.bind.apply(this,arguments);this.$selection.on("click",function(n){t.trigger("toggle",{originalEvent:n})});this.$selection.on("click",".select2-selection__choice__remove",function(r){if(!t.options.get("disabled")){var u=n(this).parent(),f=i.GetData(u[0],"data");t.trigger("unselect",{originalEvent:r,data:f})}})},r.prototype.clear=function(){var n=this.$selection.find(".select2-selection__rendered");n.empty();n.removeAttr("title")},r.prototype.display=function(n,t){var i=this.options.get("templateSelection");return this.options.get("escapeMarkup")(i(n,t))},r.prototype.selectionContainer=function(){return n('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;<\/span><\/li>')},r.prototype.update=function(n){var f,r,e;if(this.clear(),0!==n.length){for(f=[],r=0;r<n.length;r++){var u=n[r],t=this.selectionContainer(),o=this.display(u,t);t.append(o);t.attr("title",u.title||u.text);i.StoreData(t[0],"data",u);f.push(t)}e=this.$selection.find(".select2-selection__rendered");i.appendMany(e,f)}},r}),t.define("select2/selection/placeholder",["../utils"],function(){function n(n,t,i){this.placeholder=this.normalizePlaceholder(i.get("placeholder"));n.call(this,t,i)}return n.prototype.normalizePlaceholder=function(n,t){return"string"==typeof t&&(t={id:"",text:t}),t},n.prototype.createPlaceholder=function(n,t){var i=this.selectionContainer();return i.html(this.display(t)),i.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),i},n.prototype.update=function(n,t){var r=1==t.length&&t[0].id!=this.placeholder.id,i;if(1<t.length||r)return n.call(this,t);this.clear();i=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(i)},n}),t.define("select2/selection/allowClear",["jquery","../keys","../utils"],function(n,t,i){function r(){}return r.prototype.bind=function(n,t,i){var r=this;n.call(this,t,i);null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option.");this.$selection.on("mousedown",".select2-selection__clear",function(n){r._handleClear(n)});t.on("keypress",function(n){r._handleKeyboardClear(n,t)})},r.prototype._handleClear=function(n,t){var e,u,o,r,f;if(!this.options.get("disabled")&&(e=this.$selection.find(".select2-selection__clear"),0!==e.length))if(t.stopPropagation(),u=i.GetData(e[0],"data"),o=this.$element.val(),this.$element.val(this.placeholder.id),r={data:u},this.trigger("clear",r),r.prevented)this.$element.val(o);else{for(f=0;f<u.length;f++)if(r={data:u[f]},this.trigger("unselect",r),r.prevented)return void this.$element.val(o);this.$element.trigger("change");this.trigger("toggle",{})}},r.prototype._handleKeyboardClear=function(n,i,r){r.isOpen()||i.which!=t.DELETE&&i.which!=t.BACKSPACE||this._handleClear(i)},r.prototype.update=function(t,r){if(t.call(this,r),!(0<this.$selection.find(".select2-selection__placeholder").length||0===r.length)){var f=this.options.get("translations").get("removeAllItems"),u=n('<span class="select2-selection__clear" title="'+f()+'">&times;<\/span>');i.StoreData(u[0],"data",r);this.$selection.find(".select2-selection__rendered").prepend(u)}},r}),t.define("select2/selection/search",["jquery","../utils","../keys"],function(n,t,i){function r(n,t,i){n.call(this,t,i)}return r.prototype.render=function(t){var i=n('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" aria-autocomplete="list" /><\/li>'),r;return this.$searchContainer=i,this.$search=i.find("input"),r=t.call(this),this._transferTabIndex(),r},r.prototype.bind=function(n,r,u){var f=this,e,o;n.call(this,r,u);r.on("open",function(){f.$search.trigger("focus")});r.on("close",function(){f.$search.val("");f.$search.removeAttr("aria-activedescendant");f.$search.trigger("focus")});r.on("enable",function(){f.$search.prop("disabled",!1);f._transferTabIndex()});r.on("disable",function(){f.$search.prop("disabled",!0)});r.on("focus",function(){f.$search.trigger("focus")});r.on("results:focus",function(n){f.$search.attr("aria-activedescendant",n.id)});this.$selection.on("focusin",".select2-search--inline",function(n){f.trigger("focus",n)});this.$selection.on("focusout",".select2-search--inline",function(n){f._handleBlur(n)});this.$selection.on("keydown",".select2-search--inline",function(n){var r,u;(n.stopPropagation(),f.trigger("keypress",n),f._keyUpPrevented=n.isDefaultPrevented(),n.which===i.BACKSPACE&&""===f.$search.val())&&(r=f.$searchContainer.prev(".select2-selection__choice"),0<r.length&&(u=t.GetData(r[0],"data"),f.searchRemoveChoice(u),n.preventDefault()))});e=document.documentMode;o=e&&e<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(){o?f.$selection.off("input.search input.searchcheck"):f.$selection.off("keyup.search")});this.$selection.on("keyup.search input.search",".select2-search--inline",function(n){if(o&&"input"===n.type)f.$selection.off("input.search input.searchcheck");else{var t=n.which;t!=i.SHIFT&&t!=i.CTRL&&t!=i.ALT&&t!=i.TAB&&f.handleSearch(n)}})},r.prototype._transferTabIndex=function(){this.$search.attr("tabindex",this.$selection.attr("tabindex"));this.$selection.attr("tabindex","-1")},r.prototype.createPlaceholder=function(n,t){this.$search.attr("placeholder",t.text)},r.prototype.update=function(n,t){var i=this.$search[0]==document.activeElement;this.$search.attr("placeholder","");n.call(this,t);this.$selection.find(".select2-selection__rendered").append(this.$searchContainer);this.resizeSearch();i&&this.$search.trigger("focus")},r.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var n=this.$search.val();this.trigger("query",{term:n})}this._keyUpPrevented=!1},r.prototype.searchRemoveChoice=function(n,t){this.trigger("unselect",{data:t});this.$search.val(t.text);this.handleSearch()},r.prototype.resizeSearch=function(){this.$search.css("width","25px");var n="";n=""!==this.$search.attr("placeholder")?this.$selection.find(".select2-selection__rendered").innerWidth():.75*(this.$search.val().length+1)+"em";this.$search.css("width",n)},r}),t.define("select2/selection/eventRelay",["jquery"],function(n){function t(){}return t.prototype.bind=function(t,i,r){var u=this,f=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],e=["opening","closing","selecting","unselecting","clearing"];t.call(this,i,r);i.on("*",function(t,i){if(-1!==n.inArray(t,f)){i=i||{};var r=n.Event("select2:"+t,{params:i});u.$element.trigger(r);-1!==n.inArray(t,e)&&(i.prevented=r.isDefaultPrevented())}})},t}),t.define("select2/translation",["jquery","require"],function(n,t){function i(n){this.dict=n||{}}return i.prototype.all=function(){return this.dict},i.prototype.get=function(n){return this.dict[n]},i.prototype.extend=function(t){this.dict=n.extend({},t.all(),this.dict)},i._cache={},i.loadPath=function(n){if(!(n in i._cache)){var r=t(n);i._cache[n]=r}return new i(i._cache[n])},i}),t.define("select2/diacritics",[],function(){return{"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OE","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oe","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"'"}}),t.define("select2/data/base",["../utils"],function(n){function t(){t.__super__.constructor.call(this)}return n.Extend(t,n.Observable),t.prototype.current=function(){throw new Error("The `current` method must be defined in child classes.");},t.prototype.query=function(){throw new Error("The `query` method must be defined in child classes.");},t.prototype.bind=function(){},t.prototype.destroy=function(){},t.prototype.generateResultId=function(t,i){var r=t.id+"-result-";return r+=n.generateChars(4),r+=null!=i.id?"-"+i.id.toString():"-"+n.generateChars(4),r},t}),t.define("select2/data/select",["./base","../utils","jquery"],function(n,t,i){function r(n,t){this.$element=n;this.options=t;r.__super__.constructor.call(this)}return t.Extend(r,n),r.prototype.current=function(n){var t=[],r=this;this.$element.find(":selected").each(function(){var n=i(this),u=r.item(n);t.push(u)});n(t)},r.prototype.select=function(n){var t=this,r;if(n.selected=!0,i(n.element).is("option"))return n.element.selected=!0,void this.$element.trigger("change");this.$element.prop("multiple")?this.current(function(r){var f=[],u,e;for((n=[n]).push.apply(n,r),u=0;u<n.length;u++)e=n[u].id,-1===i.inArray(e,f)&&f.push(e);t.$element.val(f);t.$element.trigger("change")}):(r=n.id,this.$element.val(r),this.$element.trigger("change"))},r.prototype.unselect=function(n){var t=this;if(this.$element.prop("multiple")){if(n.selected=!1,i(n.element).is("option"))return n.element.selected=!1,void this.$element.trigger("change");this.current(function(r){for(var e,u=[],f=0;f<r.length;f++)e=r[f].id,e!==n.id&&-1===i.inArray(e,u)&&u.push(e);t.$element.val(u);t.$element.trigger("change")})}},r.prototype.bind=function(n){var t=this;(this.container=n).on("select",function(n){t.select(n.data)});n.on("unselect",function(n){t.unselect(n.data)})},r.prototype.destroy=function(){this.$element.find("*").each(function(){t.RemoveData(this)})},r.prototype.query=function(n,t){var r=[],u=this;this.$element.children().each(function(){var t=i(this),e,f;(t.is("option")||t.is("optgroup"))&&(e=u.item(t),f=u.matches(n,e),null!==f&&r.push(f))});t({results:r})},r.prototype.addOptions=function(n){t.appendMany(this.$element,n)},r.prototype.option=function(n){var r,f,u;return n.children?(r=document.createElement("optgroup")).label=n.text:void 0!==(r=document.createElement("option")).textContent?r.textContent=n.text:r.innerText=n.text,void 0!==n.id&&(r.value=n.id),n.disabled&&(r.disabled=!0),n.selected&&(r.selected=!0),n.title&&(r.title=n.title),f=i(r),u=this._normalizeItem(n),u.element=r,t.StoreData(r,"data",u),f},r.prototype.item=function(n){var r={},o,s;if(null!=(r=t.GetData(n[0],"data")))return r;if(n.is("option"))r={id:n.val(),text:n.text(),disabled:n.prop("disabled"),selected:n.prop("selected"),title:n.prop("title")};else if(n.is("optgroup")){r={text:n.prop("label"),children:[],title:n.prop("title")};for(var f=n.children("option"),e=[],u=0;u<f.length;u++)o=i(f[u]),s=this.item(o),e.push(s);r.children=e}return(r=this._normalizeItem(r)).element=n[0],t.StoreData(n[0],"data",r),r},r.prototype._normalizeItem=function(n){return n!==Object(n)&&(n={id:n,text:n}),null!=(n=i.extend({},{text:""},n)).id&&(n.id=n.id.toString()),null!=n.text&&(n.text=n.text.toString()),null==n._resultId&&n.id&&null!=this.container&&(n._resultId=this.generateResultId(this.container,n)),i.extend({},{selected:!1,disabled:!1},n)},r.prototype.matches=function(n,t){return this.options.get("matcher")(n,t)},r}),t.define("select2/data/array",["./select","../utils","jquery"],function(n,t,i){function r(n,t){var i=t.get("data")||[];r.__super__.constructor.call(this,n,t);this.addOptions(this.convertToOptions(i))}return t.Extend(r,n),r.prototype.select=function(n){var t=this.$element.find("option").filter(function(t,i){return i.value==n.id.toString()});0===t.length&&(t=this.option(n),this.addOptions(t));r.__super__.select.call(this,n)},r.prototype.convertToOptions=function(n){function a(n){return function(){return i(this).val()==n.id}}for(var r,f,h,c=this,e=this.$element.find("option"),l=e.map(function(){return c.item(i(this)).id}).get(),o=[],u=0;u<n.length;u++)if(r=this._normalizeItem(n[u]),0<=i.inArray(r.id,l)){var s=e.filter(a(r)),v=this.item(s),y=i.extend(!0,{},r,v),p=this.option(y);s.replaceWith(p)}else f=this.option(r),r.children&&(h=this.convertToOptions(r.children),t.appendMany(f,h)),o.push(f);return o},r}),t.define("select2/data/ajax",["./array","../utils","jquery"],function(n,t,i){function r(n,t){this.ajaxOptions=this._applyDefaults(t.get("ajax"));null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults);r.__super__.constructor.call(this,n,t)}return t.Extend(r,n),r.prototype._applyDefaults=function(n){var t={data:function(n){return i.extend({},n,{q:n.term})},transport:function(n,t,r){var u=i.ajax(n);return u.then(t),u.fail(r),u}};return i.extend({},t,n,!0)},r.prototype.processResults=function(n){return n},r.prototype.query=function(n,t){function f(){var f=r.transport(r,function(r){var f=u.processResults(r,n);u.options.get("debug")&&window.console&&console.error&&(f&&f.results&&i.isArray(f.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response."));t(f)},function(){"status"in f&&(0===f.status||"0"===f.status)||u.trigger("results:message",{message:"errorLoading"})});u._request=f}var u=this,r;null!=this._request&&(i.isFunction(this._request.abort)&&this._request.abort(),this._request=null);r=i.extend({type:"GET"},this.ajaxOptions);"function"==typeof r.url&&(r.url=r.url.call(this.$element,n));"function"==typeof r.data&&(r.data=r.data.call(this.$element,n));this.ajaxOptions.delay&&null!=n.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(f,this.ajaxOptions.delay)):f()},r}),t.define("select2/data/tags",["jquery"],function(n){function t(t,i,r){var f=r.get("tags"),o=r.get("createTag"),e,u;if(void 0!==o&&(this.createTag=o),e=r.get("insertTag"),void 0!==e&&(this.insertTag=e),t.call(this,i,r),n.isArray(f))for(u=0;u<f.length;u++){var s=f[u],h=this._normalizeItem(s),c=this.option(h);this.$element.append(c)}}return t.prototype.query=function(n,t,i){var r=this;this._removeOldTags();null!=t.term&&null==t.page?n.call(this,t,function n(u,f){for(var s,l,h,c,e=u.results,o=0;o<e.length;o++)if(s=e[o],l=null!=s.children&&!n({results:s.children},!0),(s.text||"").toUpperCase()===(t.term||"").toUpperCase()||l)return!f&&(u.data=e,void i(u));if(f)return!0;h=r.createTag(t);null!=h&&(c=r.option(h),c.attr("data-select2-tag",!0),r.addOptions([c]),r.insertTag(e,h));u.results=e;i(u)}):n.call(this,t,i)},t.prototype.createTag=function(t,i){var r=n.trim(i.term);return""===r?null:{id:r,text:r}},t.prototype.insertTag=function(n,t,i){t.unshift(i)},t.prototype._removeOldTags=function(){this._lastTag;this.$element.find("option[data-select2-tag]").each(function(){this.selected||n(this).remove()})},t}),t.define("select2/data/tokenizer",["jquery"],function(n){function t(n,t,i){var r=i.get("tokenizer");void 0!==r&&(this.tokenizer=r);n.call(this,t,i)}return t.prototype.bind=function(n,t,i){n.call(this,t,i);this.$search=t.dropdown.$search||t.selection.$search||i.find(".select2-search__field")},t.prototype.query=function(t,i,r){var u=this,f;i.term=i.term||"";f=this.tokenizer(i,this.options,function(t){var i=u._normalizeItem(t),r;u.$element.find("option").filter(function(){return n(this).val()===i.id}).length||(r=u.option(i),r.attr("data-select2-tag",!0),u._removeOldTags(),u.addOptions([r]));!function(n){u.trigger("select",{data:n})}(i)});f.term!==i.term&&(this.$search.length&&(this.$search.val(f.term),this.$search.trigger("focus")),i.term=f.term);t.call(this,i,r)},t.prototype.tokenizer=function(t,i,r,u){for(var s,h,o,c=r.get("tokenSeparators")||[],e=i.term,f=0,l=this.createTag||function(n){return{id:n.term,text:n.term}};f<e.length;)s=e[f],-1!==n.inArray(s,c)?(h=e.substr(0,f),o=l(n.extend({},i,{term:h})),null!=o?(u(o),e=e.substr(f+1)||"",f=0):f++):f++;return{term:e}},t}),t.define("select2/data/minimumInputLength",[],function(){function n(n,t,i){this.minimumInputLength=i.get("minimumInputLength");n.call(this,t,i)}return n.prototype.query=function(n,t,i){t.term=t.term||"";t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):n.call(this,t,i)},n}),t.define("select2/data/maximumInputLength",[],function(){function n(n,t,i){this.maximumInputLength=i.get("maximumInputLength");n.call(this,t,i)}return n.prototype.query=function(n,t,i){t.term=t.term||"";0<this.maximumInputLength&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):n.call(this,t,i)},n}),t.define("select2/data/maximumSelectionLength",[],function(){function n(n,t,i){this.maximumSelectionLength=i.get("maximumSelectionLength");n.call(this,t,i)}return n.prototype.query=function(n,t,i){var r=this;this.current(function(u){var f=null!=u?u.length:0;0<r.maximumSelectionLength&&f>=r.maximumSelectionLength?r.trigger("results:message",{message:"maximumSelected",args:{maximum:r.maximumSelectionLength}}):n.call(r,t,i)})},n}),t.define("select2/dropdown",["jquery","./utils"],function(n,t){function i(n,t){this.$element=n;this.options=t;i.__super__.constructor.call(this)}return t.Extend(i,t.Observable),i.prototype.render=function(){var t=n('<span class="select2-dropdown"><span class="select2-results"><\/span><\/span>');return t.attr("dir",this.options.get("dir")),this.$dropdown=t},i.prototype.bind=function(){},i.prototype.position=function(){},i.prototype.destroy=function(){this.$dropdown.remove()},i}),t.define("select2/dropdown/search",["jquery","../utils"],function(n){function t(){}return t.prototype.render=function(t){var r=t.call(this),i=n('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" /><\/span>');return this.$searchContainer=i,this.$search=i.find("input"),r.prepend(i),r},t.prototype.bind=function(t,i,r){var u=this;t.call(this,i,r);this.$search.on("keydown",function(n){u.trigger("keypress",n);u._keyUpPrevented=n.isDefaultPrevented()});this.$search.on("input",function(){n(this).off("keyup")});this.$search.on("keyup input",function(n){u.handleSearch(n)});i.on("open",function(){u.$search.attr("tabindex",0);u.$search.trigger("focus");window.setTimeout(function(){u.$search.trigger("focus")},0)});i.on("close",function(){u.$search.attr("tabindex",-1);u.$search.val("");u.$search.trigger("blur")});i.on("focus",function(){i.isOpen()||u.$search.trigger("focus")});i.on("results:all",function(n){null!=n.query.term&&""!==n.query.term||(u.showSearch(n)?u.$searchContainer.removeClass("select2-search--hide"):u.$searchContainer.addClass("select2-search--hide"))})},t.prototype.handleSearch=function(){if(!this._keyUpPrevented){var n=this.$search.val();this.trigger("query",{term:n})}this._keyUpPrevented=!1},t.prototype.showSearch=function(){return!0},t}),t.define("select2/dropdown/hidePlaceholder",[],function(){function n(n,t,i,r){this.placeholder=this.normalizePlaceholder(i.get("placeholder"));n.call(this,t,i,r)}return n.prototype.append=function(n,t){t.results=this.removePlaceholder(t.results);n.call(this,t)},n.prototype.normalizePlaceholder=function(n,t){return"string"==typeof t&&(t={id:"",text:t}),t},n.prototype.removePlaceholder=function(n,t){for(var u,r=t.slice(0),i=t.length-1;0<=i;i--)u=t[i],this.placeholder.id===u.id&&r.splice(i,1);return r},n}),t.define("select2/dropdown/infiniteScroll",["jquery"],function(n){function t(n,t,i,r){this.lastParams={};n.call(this,t,i,r);this.$loadingMore=this.createLoadingMore();this.loading=!1}return t.prototype.append=function(n,t){this.$loadingMore.remove();this.loading=!1;n.call(this,t);this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},t.prototype.bind=function(n,t,i){var r=this;n.call(this,t,i);t.on("query",function(n){r.lastParams=n;r.loading=!0});t.on("query:append",function(n){r.lastParams=n;r.loading=!0});this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},t.prototype.loadMoreIfNeeded=function(){var i=n.contains(document.documentElement,this.$loadingMore[0]),t;!this.loading&&i&&(t=this.$results.offset().top+this.$results.outerHeight(!1),this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1)<=t+50&&this.loadMore())},t.prototype.loadMore=function(){this.loading=!0;var t=n.extend({},{page:1},this.lastParams);t.page++;this.trigger("query:append",t)},t.prototype.showLoadingMore=function(n,t){return t.pagination&&t.pagination.more},t.prototype.createLoadingMore=function(){var t=n('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"><\/li>'),i=this.options.get("translations").get("loadingMore");return t.html(i(this.lastParams)),t},t}),t.define("select2/dropdown/attachBody",["jquery","../utils"],function(n,t){function i(t,i,r){this.$dropdownParent=r.get("dropdownParent")||n(document.body);t.call(this,i,r)}return i.prototype.bind=function(n,t,i){var r=this,u=!1;n.call(this,t,i);t.on("open",function(){r._showDropdown();r._attachPositioningHandler(t);u||(u=!0,t.on("results:all",function(){r._positionDropdown();r._resizeDropdown()}),t.on("results:append",function(){r._positionDropdown();r._resizeDropdown()}))});t.on("close",function(){r._hideDropdown();r._detachPositioningHandler(t)});this.$dropdownContainer.on("mousedown",function(n){n.stopPropagation()})},i.prototype.destroy=function(n){n.call(this);this.$dropdownContainer.remove()},i.prototype.position=function(n,t,i){t.attr("class",i.attr("class"));t.removeClass("select2");t.addClass("select2-container--open");t.css({position:"absolute",top:-999999});this.$container=i},i.prototype.render=function(t){var i=n("<span><\/span>"),r=t.call(this);return i.append(r),this.$dropdownContainer=i},i.prototype._hideDropdown=function(){this.$dropdownContainer.detach()},i.prototype._attachPositioningHandler=function(i,r){var u=this,f="scroll.select2."+r.id,o="resize.select2."+r.id,s="orientationchange.select2."+r.id,e=this.$container.parents().filter(t.hasScroll);e.each(function(){t.StoreData(this,"select2-scroll-position",{x:n(this).scrollLeft(),y:n(this).scrollTop()})});e.on(f,function(){var i=t.GetData(this,"select2-scroll-position");n(this).scrollTop(i.y)});n(window).on(f+" "+o+" "+s,function(){u._positionDropdown();u._resizeDropdown()})},i.prototype._detachPositioningHandler=function(i,r){var u="scroll.select2."+r.id,f="resize.select2."+r.id,e="orientationchange.select2."+r.id;this.$container.parents().filter(t.hasScroll).off(u);n(window).off(u+" "+f+" "+e)},i.prototype._positionDropdown=function(){var s=n(window),u=this.$dropdown.hasClass("select2-dropdown--above"),a=this.$dropdown.hasClass("select2-dropdown--below"),t=null,i=this.$container.offset(),r,o;i.bottom=i.top+this.$container.outerHeight(!1);r={height:this.$container.outerHeight(!1)};r.top=i.top;r.bottom=i.top+r.height;var h=this.$dropdown.outerHeight(!1),v=s.scrollTop(),y=s.scrollTop()+s.height(),c=v<i.top-h,l=y>i.bottom+h,f={left:i.left,top:r.bottom},e=this.$dropdownParent;"static"===e.css("position")&&(e=e.offsetParent());o=e.offset();f.top-=o.top;f.left-=o.left;u||a||(t="below");l||!c||u?!c&&l&&u&&(t="below"):t="above";("above"==t||u&&"below"!==t)&&(f.top=r.top-o.top-h);null!=t&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+t),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+t));this.$dropdownContainer.css(f)},i.prototype._resizeDropdown=function(){var n={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(n.minWidth=n.width,n.position="relative",n.width="auto");this.$dropdown.css(n)},i.prototype._showDropdown=function(){this.$dropdownContainer.appendTo(this.$dropdownParent);this._positionDropdown();this._resizeDropdown()},i}),t.define("select2/dropdown/minimumResultsForSearch",[],function(){function n(n,t,i,r){this.minimumResultsForSearch=i.get("minimumResultsForSearch");this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0);n.call(this,t,i,r)}return n.prototype.showSearch=function(n,t){return!(function n(t){for(var u,i=0,r=0;r<t.length;r++)u=t[r],u.children?i+=n(u.children):i++;return i}(t.data.results)<this.minimumResultsForSearch)&&n.call(this,t)},n}),t.define("select2/dropdown/selectOnClose",["../utils"],function(n){function t(){}return t.prototype.bind=function(n,t,i){var r=this;n.call(this,t,i);t.on("close",function(n){r._handleSelectOnClose(n)})},t.prototype._handleSelectOnClose=function(t,i){var u,f,r;i&&null!=i.originalSelect2Event&&(u=i.originalSelect2Event,"select"===u._type||"unselect"===u._type)||(f=this.getHighlightedResults(),f.length<1||(r=n.GetData(f[0],"data"),null!=r.element&&r.element.selected||null==r.element&&r.selected||this.trigger("select",{data:r})))},t}),t.define("select2/dropdown/closeOnSelect",[],function(){function n(){}return n.prototype.bind=function(n,t,i){var r=this;n.call(this,t,i);t.on("select",function(n){r._selectTriggered(n)});t.on("unselect",function(n){r._selectTriggered(n)})},n.prototype._selectTriggered=function(n,t){var i=t.originalEvent;i&&(i.ctrlKey||i.metaKey)||this.trigger("close",{originalEvent:i,originalSelect2Event:t})},n}),t.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(n){var t=n.input.length-n.maximum,i="Please delete "+t+" character";return 1!=t&&(i+="s"),i},inputTooShort:function(n){return"Please enter "+(n.minimum-n.input.length)+" or more characters"},loadingMore:function(){return"Loading more results"},maximumSelected:function(n){var t="You can only select "+n.maximum+" item";return 1!=n.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching"},removeAllItems:function(){return"Remove all items"}}}),t.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot){function st(){this.reset()}return st.prototype.apply=function(l){var vt,yt,pt,wt,bt,kt,ct,lt,st,ot,ht,dt,at;if(null==(l=n.extend(!0,{},this.defaults,l)).dataAdapter&&((l.dataAdapter=null!=l.ajax?y:null!=l.data?v:a,0<l.minimumInputLength&&(l.dataAdapter=h.Decorate(l.dataAdapter,b)),0<l.maximumInputLength&&(l.dataAdapter=h.Decorate(l.dataAdapter,k)),0<l.maximumSelectionLength&&(l.dataAdapter=h.Decorate(l.dataAdapter,d)),l.tags&&(l.dataAdapter=h.Decorate(l.dataAdapter,p)),null==l.tokenSeparators&&null==l.tokenizer||(l.dataAdapter=h.Decorate(l.dataAdapter,w)),null!=l.query)&&(vt=t(l.amdBase+"compat/query"),l.dataAdapter=h.Decorate(l.dataAdapter,vt)),null!=l.initSelection&&(yt=t(l.amdBase+"compat/initSelection"),l.dataAdapter=h.Decorate(l.dataAdapter,yt))),(null==l.resultsAdapter&&(l.resultsAdapter=i,null!=l.ajax&&(l.resultsAdapter=h.Decorate(l.resultsAdapter,it)),null!=l.placeholder&&(l.resultsAdapter=h.Decorate(l.resultsAdapter,tt)),l.selectOnClose&&(l.resultsAdapter=h.Decorate(l.resultsAdapter,ft))),null==l.dropdownAdapter)&&(l.multiple?l.dropdownAdapter=g:(pt=h.Decorate(g,nt),l.dropdownAdapter=pt),(0!==l.minimumResultsForSearch&&(l.dropdownAdapter=h.Decorate(l.dropdownAdapter,ut)),l.closeOnSelect&&(l.dropdownAdapter=h.Decorate(l.dropdownAdapter,et)),null!=l.dropdownCssClass||null!=l.dropdownCss||null!=l.adaptDropdownCssClass)&&(wt=t(l.amdBase+"compat/dropdownCss"),l.dropdownAdapter=h.Decorate(l.dropdownAdapter,wt)),l.dropdownAdapter=h.Decorate(l.dropdownAdapter,rt)),null==l.selectionAdapter&&((l.selectionAdapter=l.multiple?u:r,null!=l.placeholder&&(l.selectionAdapter=h.Decorate(l.selectionAdapter,f)),l.allowClear&&(l.selectionAdapter=h.Decorate(l.selectionAdapter,e)),l.multiple&&(l.selectionAdapter=h.Decorate(l.selectionAdapter,o)),null!=l.containerCssClass||null!=l.containerCss||null!=l.adaptContainerCssClass)&&(bt=t(l.amdBase+"compat/containerCss"),l.selectionAdapter=h.Decorate(l.selectionAdapter,bt)),l.selectionAdapter=h.Decorate(l.selectionAdapter,s)),"string"==typeof l.language&&(0<l.language.indexOf("-")?(kt=l.language.split("-")[0],l.language=[l.language,kt]):l.language=[l.language]),n.isArray(l.language)){for(ct=new c,l.language.push("en"),lt=l.language,st=0;st<lt.length;st++){ot=lt[st];ht={};try{ht=c.loadPath(ot)}catch(vt){try{ot=this.defaults.amdLanguageBase+ot;ht=c.loadPath(ot)}catch(vt){l.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+ot+'" could not be automatically loaded. A fallback will be used instead.');continue}}ct.extend(ht)}l.translations=ct}else dt=c.loadPath(this.defaults.amdLanguageBase+"en"),at=new c(l.language),at.extend(dt),l.translations=at;return l},st.prototype.reset=function(){function t(n){return n.replace(/[^\u0000-\u007E]/g,function(n){return l[n]||n})}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:h.escapeMarkup,language:ot,matcher:function ot(i,r){var u,f,e,o;if(""===n.trim(i.term))return r;if(r.children&&0<r.children.length){for(u=n.extend(!0,{},r),f=r.children.length-1;0<=f;f--)null==ot(i,r.children[f])&&u.children.splice(f,1);return 0<u.children.length?u:ot(i,u)}return e=t(r.text).toUpperCase(),o=t(i.term).toUpperCase(),-1<e.indexOf(o)?r:null},minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(n){return n},templateResult:function(n){return n.text},templateSelection:function(n){return n.text},theme:"default",width:"resolve"}},st.prototype.set=function(t,i){var r={},u;r[n.camelCase(t)]=i;u=h._convertData(r);n.extend(!0,this.defaults,u)},new st}),t.define("select2/options",["require","jquery","./defaults","./utils"],function(n,t,i,r){function u(t,u){if(this.options=t,null!=u&&this.fromElement(u),this.options=i.apply(this.options),u&&u.is("input")){var f=n(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=r.Decorate(this.options.dataAdapter,f)}}return u.prototype.fromElement=function(n){function a(n,t){return t.toUpperCase()}var l=["select2"],u,e,s,o,h,c,f,i;for(null==this.options.multiple&&(this.options.multiple=n.prop("multiple")),null==this.options.disabled&&(this.options.disabled=n.prop("disabled")),null==this.options.language&&(n.prop("lang")?this.options.language=n.prop("lang").toLowerCase():n.closest("[lang]").prop("lang")&&(this.options.language=n.closest("[lang]").prop("lang"))),null==this.options.dir&&(this.options.dir=n.prop("dir")?n.prop("dir"):n.closest("[dir]").prop("dir")?n.closest("[dir]").prop("dir"):"ltr"),n.prop("disabled",this.options.disabled),n.prop("multiple",this.options.multiple),r.GetData(n[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),r.StoreData(n[0],"data",r.GetData(n[0],"select2Tags")),r.StoreData(n[0],"tags",!0)),r.GetData(n[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),n.attr("ajax--url",r.GetData(n[0],"ajaxUrl")),r.StoreData(n[0],"ajax-Url",r.GetData(n[0],"ajaxUrl"))),u={},e=0;e<n[0].attributes.length;e++)s=n[0].attributes[e].name,o="data-",s.substr(0,o.length)==o&&(h=s.substring(o.length),c=r.GetData(n[0],h),u[h.replace(/-([a-z])/g,a)]=c);t.fn.jquery&&"1."==t.fn.jquery.substr(0,2)&&n[0].dataset&&(u=t.extend(!0,{},n[0].dataset,u));f=t.extend(!0,{},r.GetData(n[0]),u);for(i in f=r._convertData(f))-1<t.inArray(i,l)||(t.isPlainObject(this.options[i])?t.extend(this.options[i],f[i]):this.options[i]=f[i]);return this},u.prototype.get=function(n){return this.options[n]},u.prototype.set=function(n,t){this.options[n]=t},u}),t.define("select2/core",["jquery","./options","./utils","./keys"],function(n,t,i,r){var u=function(n,r){var e,o,f,s,h,c,l;null!=i.GetData(n[0],"select2")&&i.GetData(n[0],"select2").destroy();this.$element=n;this.id=this._generateId(n);r=r||{};this.options=new t(r,n);u.__super__.constructor.call(this);e=n.attr("tabindex")||0;i.StoreData(n[0],"old-tabindex",e);n.attr("tabindex","-1");o=this.options.get("dataAdapter");this.dataAdapter=new o(n,this.options);f=this.render();this._placeContainer(f);s=this.options.get("selectionAdapter");this.selection=new s(n,this.options);this.$selection=this.selection.render();this.selection.position(this.$selection,f);h=this.options.get("dropdownAdapter");this.dropdown=new h(n,this.options);this.$dropdown=this.dropdown.render();this.dropdown.position(this.$dropdown,f);c=this.options.get("resultsAdapter");this.results=new c(n,this.options,this.dataAdapter);this.$results=this.results.render();this.results.position(this.$results,this.$dropdown);l=this;this._bindAdapters();this._registerDomEvents();this._registerDataEvents();this._registerSelectionEvents();this._registerDropdownEvents();this._registerResultsEvents();this._registerEvents();this.dataAdapter.current(function(n){l.trigger("selection:update",{data:n})});n.addClass("select2-hidden-accessible");n.attr("aria-hidden","true");this._syncAttributes();i.StoreData(n[0],"select2",this);n.data("select2",this)};return i.Extend(u,i.Observable),u.prototype._generateId=function(n){return"select2-"+(null!=n.attr("id")?n.attr("id"):null!=n.attr("name")?n.attr("name")+"-"+i.generateChars(2):i.generateChars(4)).replace(/(:|\.|\[|\]|,)/g,"")},u.prototype._placeContainer=function(n){n.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&n.css("width",t)},u.prototype._resolveWidth=function(n,t){var r,u,f,i;if("resolve"==t)return r=this._resolveWidth(n,"style"),null!=r?r:this._resolveWidth(n,"element");if("element"==t)return u=n.outerWidth(!1),u<=0?"auto":u+"px";if("style"!=t)return"computedstyle"!=t?t:window.getComputedStyle(n[0]).width;if(f=n.attr("style"),"string"!=typeof f)return null;for(var o=f.split(";"),e=0,s=o.length;e<s;e+=1)if(i=o[e].replace(/\s/g,"").match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==i&&1<=i.length)return i[1];return null},u.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container);this.selection.bind(this,this.$container);this.dropdown.bind(this,this.$container);this.results.bind(this,this.$container)},u.prototype._registerDomEvents=function(){var t=this,r;this.$element.on("change.select2",function(){t.dataAdapter.current(function(n){t.trigger("selection:update",{data:n})})});this.$element.on("focus.select2",function(n){t.trigger("focus",n)});this._syncA=i.bind(this._syncAttributes,this);this._syncS=i.bind(this._syncSubtree,this);this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);r=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=r?(this._observer=new r(function(i){n.each(i,t._syncA);n.each(i,t._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},u.prototype._registerDataEvents=function(){var n=this;this.dataAdapter.on("*",function(t,i){n.trigger(t,i)})},u.prototype._registerSelectionEvents=function(){var t=this,i=["toggle","focus"];this.selection.on("toggle",function(){t.toggleDropdown()});this.selection.on("focus",function(n){t.focus(n)});this.selection.on("*",function(r,u){-1===n.inArray(r,i)&&t.trigger(r,u)})},u.prototype._registerDropdownEvents=function(){var n=this;this.dropdown.on("*",function(t,i){n.trigger(t,i)})},u.prototype._registerResultsEvents=function(){var n=this;this.results.on("*",function(t,i){n.trigger(t,i)})},u.prototype._registerEvents=function(){var n=this;this.on("open",function(){n.$container.addClass("select2-container--open")});this.on("close",function(){n.$container.removeClass("select2-container--open")});this.on("enable",function(){n.$container.removeClass("select2-container--disabled")});this.on("disable",function(){n.$container.addClass("select2-container--disabled")});this.on("blur",function(){n.$container.removeClass("select2-container--focus")});this.on("query",function(t){n.isOpen()||n.trigger("open",{});this.dataAdapter.query(t,function(i){n.trigger("results:all",{data:i,query:t})})});this.on("query:append",function(t){this.dataAdapter.query(t,function(i){n.trigger("results:append",{data:i,query:t})})});this.on("keypress",function(t){var i=t.which;n.isOpen()?i===r.ESC||i===r.TAB||i===r.UP&&t.altKey?(n.close(),t.preventDefault()):i===r.ENTER?(n.trigger("results:select",{}),t.preventDefault()):i===r.SPACE&&t.ctrlKey?(n.trigger("results:toggle",{}),t.preventDefault()):i===r.UP?(n.trigger("results:previous",{}),t.preventDefault()):i===r.DOWN&&(n.trigger("results:next",{}),t.preventDefault()):(i===r.ENTER||i===r.SPACE||i===r.DOWN&&t.altKey)&&(n.open(),t.preventDefault())})},u.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled"));this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},u.prototype._syncSubtree=function(n,t){var i=!1,u=this,r;if(!n||!n.target||"OPTION"===n.target.nodeName||"OPTGROUP"===n.target.nodeName){if(t)if(t.addedNodes&&0<t.addedNodes.length)for(r=0;r<t.addedNodes.length;r++)t.addedNodes[r].selected&&(i=!0);else t.removedNodes&&0<t.removedNodes.length&&(i=!0);else i=!0;i&&this.dataAdapter.current(function(n){u.trigger("selection:update",{data:n})})}},u.prototype.trigger=function(n,t){var r=u.__super__.trigger,f={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"},e,i;if((void 0===t&&(t={}),n in f)&&(e=f[n],i={prevented:!1,name:n,args:t},r.call(this,e,i),i.prevented))return void(t.prevented=!0);r.call(this,n,t)},u.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},u.prototype.open=function(){this.isOpen()||this.trigger("query",{})},u.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},u.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},u.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},u.prototype.focus=function(){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},u.prototype.enable=function(n){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.');null!=n&&0!==n.length||(n=[!0]);var t=!n[0];this.$element.prop("disabled",t)},u.prototype.data=function(){this.options.get("debug")&&0<arguments.length&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var n=[];return this.dataAdapter.current(function(t){n=t}),n},u.prototype.val=function(t){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==t||0===t.length)return this.$element.val();var i=t[0];n.isArray(i)&&(i=n.map(i,function(n){return n.toString()}));this.$element.val(i).trigger("change")},u.prototype.destroy=function(){this.$container.remove();this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA);null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1));this._syncA=null;this._syncS=null;this.$element.off(".select2");this.$element.attr("tabindex",i.GetData(this.$element[0],"old-tabindex"));this.$element.removeClass("select2-hidden-accessible");this.$element.attr("aria-hidden","false");i.RemoveData(this.$element[0]);this.$element.removeData("select2");this.dataAdapter.destroy();this.selection.destroy();this.dropdown.destroy();this.results.destroy();this.dataAdapter=null;this.selection=null;this.dropdown=null;this.results=null},u.prototype.render=function(){var t=n('<span class="select2 select2-container"><span class="selection"><\/span><span class="dropdown-wrapper" aria-hidden="true"><\/span><\/span>');return t.attr("dir",this.options.get("dir")),this.$container=t,this.$container.addClass("select2-container--"+this.options.get("theme")),i.StoreData(t[0],"element",this.$element),t},u}),t.define("jquery-mousewheel",["jquery"],function(n){return n}),t.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],function(n,t,i,r,u){if(null==n.fn.select2){var f=["open","close","destroy"];n.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each(function(){var r=n.extend(!0,{},t);new i(n(this),r)}),this;if("string"!=typeof t)throw new Error("Invalid arguments for Select2: "+t);var r,e=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=u.GetData(this,"select2");null==n&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2.");r=n[t].apply(n,e)}),-1<n.inArray(t,f)?this:r}}return null==n.fn.select2.defaults&&(n.fn.select2.defaults=r),i}),{define:t.define,require:t.require}}(),i=t.require("jquery.select2");return n.fn.select2.amd=t,i}),function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery"],n):typeof exports=="object"&&typeof module=="object"?module.exports=n(require("jquery")):n(jQuery)}(function(n,t){"use strict";function s(t,i,r,u){for(var e,f,h,c,a,v,o=[],s=0;s<t.length;s++)e=t[s],e?(f=tinycolor(e),h=f.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",h+=tinycolor.equals(i,e)?" sp-thumb-active":"",c=f.toString(u.preferredFormat||"rgb"),a=l?"background-color:"+f.toRgbString():"filter:"+f.toFilter(),o.push('<span title="'+c+'" data-color="'+f.toRgbString()+'" class="'+h+'"><span class="sp-thumb-inner" style="'+a+';" /><\/span>')):(v="sp-clear-display",o.push(n("<div />").append(n('<span data-color="" style="background-color:transparent;" class="'+v+'"><\/span>').attr("title",u.noColorSelectedText)).html()));return"<div class='sp-cf "+r+"'>"+o.join("")+"<\/div>"}function y(){for(var n=0;n<i.length;n++)i[n]&&i[n].hide()}function p(t,i){var r=n.extend({},c,t);return r.callbacks={move:f(r.move,i),change:f(r.change,i),show:f(r.show,i),hide:f(r.hide,i),beforeShow:f(r.beforeShow,i)},r}function w(u,f){function fr(){var t,i,r;if(h.showPaletteOnly&&(h.showPalette=!0),rr.text(h.showPaletteOnly?h.togglePaletteMoreText:h.togglePaletteLessText),h.palette)for(ai=h.palette.slice(0),ei=n.isArray(ai[0])?ai:[ai],vi={},t=0;t<ei.length;t++)for(i=0;i<ei[t].length;i++)r=tinycolor(ei[t][i]).toRgbString(),vi[r]=!0;c.toggleClass("sp-flat",ut);c.toggleClass("sp-input-disabled",!h.showInput);c.toggleClass("sp-alpha-enabled",h.showAlpha);c.toggleClass("sp-clear-enabled",ht);c.toggleClass("sp-buttons-disabled",!h.showButtons);c.toggleClass("sp-palette-buttons-disabled",!h.togglePaletteOnly);c.toggleClass("sp-palette-disabled",!h.showPalette);c.toggleClass("sp-palette-only",h.showPaletteOnly);c.toggleClass("sp-initial-disabled",!h.showInitial);c.addClass(h.className).addClass(h.containerClassName);at()}function pu(){function u(t){return t.data&&t.data.ignore?(ct(n(t.target).closest(".sp-thumb-el").data("color")),ni()):(ct(n(t.target).closest(".sp-thumb-el").data("color")),ni(),lt(!0),h.hideAfterPaletteSelect&&ot()),!1}var t,i;r&&c.find("*:not(input)").attr("unselectable","on");fr();ur&&w.after(bt).hide();ht||ir.hide();ut?w.after(c).hide():(t=h.appendTo==="parent"?w.parent():n(h.appendTo),t.length!==1&&(t=n("body")),t.append(c));nu();si.bind("click.spectrum touchstart.spectrum",function(t){nr||ru();t.stopPropagation();n(t.target).is("input")||t.preventDefault()});(w.is(":disabled")||h.disabled===!0)&&su();c.click(k);it.change(hr);it.bind("paste",function(){setTimeout(hr,1)});it.keydown(function(n){n.keyCode==13&&hr()});dr.text(h.cancelText);dr.bind("click.spectrum",function(n){n.stopPropagation();n.preventDefault();eu();ot()});ir.attr("title",h.clearText);ir.bind("click.spectrum",function(n){n.stopPropagation();n.preventDefault();et=!0;ni();ut&&lt(!0)});gr.text(h.chooseText);gr.bind("click.spectrum",function(n){n.stopPropagation();n.preventDefault();r&&it.is(":focus")&&it.trigger("change");bu()&&(lt(!0),ot())});rr.text(h.showPaletteOnly?h.togglePaletteMoreText:h.togglePaletteLessText);rr.bind("click.spectrum",function(n){n.stopPropagation();n.preventDefault();h.showPaletteOnly=!h.showPaletteOnly;h.showPaletteOnly||ut||c.css("left","-="+(au.outerWidth(!0)+5));fr()});o(wr,function(n,t,i){nt=n/gi;et=!1;i.shiftKey&&(nt=Math.round(nt*10)/10);ni()},or,sr);o(tr,function(n,t){ri=parseFloat(t/li);et=!1;h.showAlpha||(nt=1);ni()},or,sr);o(yi,function(n,t,i){var r,u;if(i.shiftKey){if(!ft){var f=ui*pt,e=rt-fi*rt,o=Math.abs(n-f)>Math.abs(t-e);ft=o?"x":"y"}}else ft=null;r=!ft||ft==="x";u=!ft||ft==="y";r&&(ui=parseFloat(n/pt));u&&(fi=parseFloat((rt-t)/rt));et=!1;h.showAlpha||(nt=1);ni()},or,sr);hi?(ct(hi),ti(),gt=h.preferredFormat||tinycolor(hi).format,er(hi)):ti();ut&&cr();i=r?"mousedown.spectrum":"click.spectrum touchstart.spectrum";br.delegate(".sp-thumb-el",i,u);kr.delegate(".sp-thumb-el:nth-child(1)",i,{ignore:!0},u)}function nu(){if(vt&&window.localStorage){try{var t=window.localStorage[vt].split(",#");t.length>1&&(delete window.localStorage[vt],n.each(t,function(n,t){er(t)}))}catch(i){}try{tt=window.localStorage[vt].split(";")}catch(i){}}}function er(t){if(hu){var i=tinycolor(t).toRgbString();if(!vi[i]&&n.inArray(i,tt)===-1)for(tt.push(i);tt.length>lu;)tt.shift();if(vt&&window.localStorage)try{window.localStorage[vt]=tt.join(";")}catch(r){}}}function wu(){var t=[],n,i;if(h.showPalette)for(n=0;n<tt.length;n++)i=tinycolor(tt[n]).toRgbString(),vi[i]||t.push(tt[n]);return t.reverse().slice(0,h.maxSelectionSize)}function tu(){var t=g(),i=n.map(ei,function(n,i){return s(n,t,"sp-palette-row sp-palette-row-"+i,h)});nu();tt&&i.push(s(wu(),t,"sp-palette-row sp-palette-row-selection",h));br.html(i.join(""))}function iu(){if(h.showInitial){var t=dt,n=g();kr.html(s([t,n],n,"sp-palette-row-initial",h))}}function or(){(rt<=0||pt<=0||li<=0)&&at();di=!0;c.addClass(pr);ft=null;w.trigger("dragstart.spectrum",[g()])}function sr(){di=!1;c.removeClass(pr);w.trigger("dragstop.spectrum",[g()])}function hr(){var n=it.val(),t;(n===null||n==="")&&ht?(ct(null),lt(!0)):(t=tinycolor(n),t.isValid()?(ct(t),lt(!0)):it.addClass("sp-validation-error"))}function ru(){yt?ot():cr()}function cr(){var t=n.Event("beforeShow.spectrum");if(yt){at();return}(w.trigger(t,[g()]),ii.beforeShow(g())===!1||t.isDefaultPrevented())||(y(),yt=!0,n(wt).bind("keydown.spectrum",uu),n(wt).bind("click.spectrum",fu),n(window).bind("resize.spectrum",ar),bt.addClass("sp-active"),c.removeClass("sp-hidden"),at(),ti(),dt=g(),iu(),ii.show(dt),w.trigger("show.spectrum",[dt]))}function uu(n){n.keyCode===27&&ot()}function fu(n){n.button!=2&&(di||(yu?lt(!0):eu(),ot()))}function ot(){yt&&!ut&&(yt=!1,n(wt).unbind("keydown.spectrum",uu),n(wt).unbind("click.spectrum",fu),n(window).unbind("resize.spectrum",ar),bt.removeClass("sp-active"),c.addClass("sp-hidden"),ii.hide(g()),w.trigger("hide.spectrum",[g()]))}function eu(){ct(dt,!0)}function ct(n,t){if(tinycolor.equals(n,g())){ti();return}var i,r;!n&&ht?et=!0:(et=!1,i=tinycolor(n),r=i.toHsv(),ri=r.h%360/360,ui=r.s,fi=r.v,nt=r.a);ti();i&&i.isValid()&&!t&&(gt=h.preferredFormat||i.getFormat())}function g(n){return(n=n||{},ht&&et)?null:tinycolor.fromRatio({h:ri,s:ui,v:fi,a:Math.round(nt*100)/100},{format:n.format||gt})}function bu(){return!it.hasClass("sp-validation-error")}function ni(){ti();ii.move(g());w.trigger("move.spectrum",[g()])}function ti(){var s,n,t,e,i,c,o,u,f;it.removeClass("sp-validation-error");ou();s=tinycolor.fromRatio({h:ri,s:1,v:1});yi.css("background-color",s.toHexString());n=gt;nt<1&&!(nt===0&&n==="name")&&(n==="hex"||n==="hex3"||n==="hex6"||n==="name")&&(n="rgb");t=g({format:n});e="";kt.removeClass("sp-clear-display");kt.css("background-color","transparent");!t&&ht?kt.addClass("sp-clear-display"):(i=t.toHexString(),c=t.toRgbString(),l||t.alpha===1?kt.css("background-color",c):(kt.css("background-color","transparent"),kt.css("filter",t.toFilter())),h.showAlpha&&(o=t.toRgb(),o.a=0,u=tinycolor(o).toRgbString(),f="linear-gradient(left, "+u+", "+i+")",r?oi.css("filter",tinycolor(u).toFilter({gradientType:1},i)):(oi.css("background","-webkit-"+f),oi.css("background","-moz-"+f),oi.css("background","-ms-"+f),oi.css("background","linear-gradient(to right, "+u+", "+i+")"))),e=t.toString(n));h.showInput&&it.val(e);h.showPalette&&tu();iu()}function ou(){var u=ui,f=fi,n,t,i,r;ht&&et?(bi.hide(),wi.hide(),pi.hide()):(bi.show(),wi.show(),pi.show(),n=u*pt,t=rt-f*rt,n=Math.max(-st,Math.min(pt-st,n-st)),t=Math.max(-st,Math.min(rt-st,t-st)),pi.css({top:t+"px",left:n+"px"}),i=nt*gi,bi.css({left:i-vr/2+"px"}),r=ri*li,wi.css({top:r-yr+"px"}))}function lt(n){var t=g(),i="",r=!tinycolor.equals(t,dt);t&&(i=t.toString(gt),er(t));ki&&w.val(i);n&&r&&(ii.change(t),w.trigger("change",[t]))}function at(){yt&&(pt=yi.width(),rt=yi.height(),st=pi.height(),cu=tr.width(),li=tr.height(),yr=wi.height(),gi=wr.width(),vr=bi.width(),ut||(c.css("position","absolute"),h.offset?c.offset(h.offset):c.offset(b(c,si))),ou(),h.showPalette&&tu(),w.trigger("reflow.spectrum"))}function ku(){w.show();si.unbind("click.spectrum touchstart.spectrum");c.remove();bt.remove();i[ci.id]=null}function du(i,r){if(i===t)return n.extend({},h);if(r===t)return h[i];h[i]=r;i==="preferredFormat"&&(gt=h.preferredFormat);fr()}function gu(){nr=!1;w.attr("disabled",!1);si.removeClass("sp-disabled")}function su(){ot();nr=!0;w.attr("disabled",!0);si.addClass("sp-disabled")}function nf(n){h.offset=n;at()}var h=p(f,u),ut=h.flat,hu=h.showSelectionPalette,vt=h.localStorageKey,lr=h.theme,ii=h.callbacks,ar=d(at,10),yt=!1,di=!1,pt=0,rt=0,st=0,li=0,cu=0,gi=0,vr=0,yr=0,ri=0,ui=0,fi=0,nt=1,ai=[],ei=[],vi={},tt=h.selectionPalette.slice(0),lu=h.maxSelectionSize,pr="sp-dragging",ft=null,wt=u.ownerDocument,tf=wt.body,w=n(u),nr=!1,c=n(v,wt).addClass(lr),au=c.find(".sp-picker-container"),yi=c.find(".sp-color"),pi=c.find(".sp-dragger"),tr=c.find(".sp-hue"),wi=c.find(".sp-slider"),oi=c.find(".sp-alpha-inner"),wr=c.find(".sp-alpha"),bi=c.find(".sp-alpha-handle"),it=c.find(".sp-input"),br=c.find(".sp-palette"),kr=c.find(".sp-initial"),dr=c.find(".sp-cancel"),ir=c.find(".sp-clear"),gr=c.find(".sp-choose"),rr=c.find(".sp-palette-toggle"),ki=w.is("input"),vu=ki&&w.attr("type")==="color"&&e(),ur=ki&&!ut,bt=ur?n(a).addClass(lr).addClass(h.className).addClass(h.replacerClassName):n([]),si=ur?bt:w,kt=bt.find(".sp-preview-inner"),hi=h.color||ki&&w.val(),dt=!1,gt=h.preferredFormat,yu=!h.showButtons||h.clickoutFiresChange,et=!hi,ht=h.allowEmpty&&!vu,ci;return pu(),ci={show:cr,hide:ot,toggle:ru,reflow:at,option:du,enable:gu,disable:su,offset:nf,set:function(n){ct(n);lt()},get:g,destroy:ku,container:c},ci.id=i.push(ci)-1,ci}function b(t,i){var s=0,u=t.outerWidth(),f=t.outerHeight(),h=i.outerHeight(),e=t[0].ownerDocument,c=e.documentElement,o=c.clientWidth+n(e).scrollLeft(),l=c.clientHeight+n(e).scrollTop(),r=i.offset();return r.top+=h,r.left-=Math.min(r.left,r.left+u>o&&o>u?Math.abs(r.left+u-o):0),r.top-=Math.min(r.top,r.top+f>l&&l>f?Math.abs(f+h-s):s),r}function u(){}function k(n){n.stopPropagation()}function f(n,t){var i=Array.prototype.slice,r=i.call(arguments,2);return function(){return n.apply(t,r.concat(i.call(arguments)))}}function o(t,i,u,f){function h(n){n.stopPropagation&&n.stopPropagation();n.preventDefault&&n.preventDefault();n.returnValue=!1}function v(n){if(s){if(r&&o.documentMode<9&&!n.button)return y();var u=n.originalEvent&&n.originalEvent.touches&&n.originalEvent.touches[0],f=u&&u.pageX||n.pageX,e=u&&u.pageY||n.pageY,v=Math.max(0,Math.min(f-c.left,a)),w=Math.max(0,Math.min(e-c.top,l));p&&h(n);i.apply(t,[v,w,n])}}function w(i){var r=i.which?i.which==3:i.button==2;r||s||u.apply(t,arguments)!==!1&&(s=!0,l=n(t).height(),a=n(t).width(),c=n(t).offset(),n(o).bind(e),n(o.body).addClass("sp-dragging"),v(i),h(i))}function y(){s&&(n(o).unbind(e),n(o.body).removeClass("sp-dragging"),setTimeout(function(){f.apply(t,arguments)},0));s=!1}i=i||function(){};u=u||function(){};f=f||function(){};var o=document,s=!1,c={},l=0,a=0,p="ontouchstart"in window,e={};e.selectstart=h;e.dragstart=h;e["touchmove mousemove"]=v;e["touchend mouseup"]=y;n(t).bind("touchstart mousedown",w)}function d(n,t,i){var r;return function(){var u=this,f=arguments,e=function(){r=null;n.apply(u,f)};i&&clearTimeout(r);(i||!r)&&(r=setTimeout(e,t))}}function e(){return n.fn.spectrum.inputTypeColorSupport()}var c={beforeShow:u,move:u,change:u,show:u,hide:u,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},i=[],r=!!/msie/i.exec(window.navigator.userAgent),l=function(){function t(n,t){return!!~(""+n).indexOf(t)}var i=document.createElement("div"),n=i.style;return n.cssText="background-color:rgba(0,0,0,.5)",t(n.backgroundColor,"rgba")||t(n.backgroundColor,"hsla")}(),a="<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'><\/div><\/div><div class='sp-dd'>&#9660;<\/div><\/div>",v=function(){var t="",n;if(r)for(n=1;n<=6;n++)t+="<div class='sp-"+n+"'><\/div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'><\/div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'><\/button>","<\/div>","<\/div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'><\/div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'><\/div>","<\/div>","<\/div>","<\/div>","<div class='sp-clear sp-clear-display'>","<\/div>","<div class='sp-hue'>","<div class='sp-slider'><\/div>",t,"<\/div>","<\/div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'><\/div><\/div><\/div>","<\/div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","<\/div>","<div class='sp-initial sp-thumb sp-cf'><\/div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'><\/a>","<button type='button' class='sp-choose'><\/button>","<\/div>","<\/div>","<\/div>"].join("")}(),h="spectrum.id";n.fn.spectrum=function(t){if(typeof t=="string"){var r=this,u=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=i[n(this).data(h)],e;if(f){if(e=f[t],!e)throw new Error("Spectrum: no such method: '"+t+"'");t=="get"?r=f.get():t=="container"?r=f.container:t=="option"?r=f.option.apply(f,u):t=="destroy"?(f.destroy(),n(this).removeData(h)):e.apply(f,u)}}),r}return this.spectrum("destroy").each(function(){var i=n.extend({},t,n(this).data()),r=w(this,i);n(this).data(h,r.id)})};n.fn.spectrum.load=!0;n.fn.spectrum.loadOpts={};n.fn.spectrum.draggable=o;n.fn.spectrum.defaults=c;n.fn.spectrum.inputTypeColorSupport=function e(){if(typeof e._cachedResult=="undefined"){var t=n("<input type='color'/>")[0];e._cachedResult=t.type==="color"&&t.value!==""}return e._cachedResult};n.spectrum={};n.spectrum.localization={};n.spectrum.palettes={};n.fn.spectrum.processNativeColorInputs=function(){var t=n("input[type=color]");t.length&&!e()&&t.spectrum({preferredFormat:"hex6"})},function(){function tt(n){var t={r:0,g:0,b:0},i=1,f=!1,e=!1;return typeof n=="string"&&(n=ii(n)),typeof n=="object"&&(n.hasOwnProperty("r")&&n.hasOwnProperty("g")&&n.hasOwnProperty("b")?(t=it(n.r,n.g,n.b),f=!0,e=String(n.r).substr(-1)==="%"?"prgb":"rgb"):n.hasOwnProperty("h")&&n.hasOwnProperty("s")&&n.hasOwnProperty("v")?(n.s=h(n.s),n.v=h(n.v),t=ut(n.h,n.s,n.v),f=!0,e="hsv"):n.hasOwnProperty("h")&&n.hasOwnProperty("s")&&n.hasOwnProperty("l")&&(n.s=h(n.s),n.l=h(n.l),t=rt(n.h,n.s,n.l),f=!0,e="hsl"),n.hasOwnProperty("a")&&(i=n.a)),i=k(i),{ok:f,format:n.format||e,r:r(255,u(t.r,0)),g:r(255,u(t.g,0)),b:r(255,u(t.b,0)),a:i}}function it(n,t,r){return{r:i(n,255)*255,g:i(t,255)*255,b:i(r,255)*255}}function v(n,t,f){var s;n=i(n,255);t=i(t,255);f=i(f,255);var e=u(n,t,f),h=r(n,t,f),o,c,l=(e+h)/2;if(e==h)o=c=0;else{s=e-h;c=l>.5?s/(2-e-h):s/(e+h);switch(e){case n:o=(t-f)/s+(t<f?6:0);break;case t:o=(f-n)/s+2;break;case f:o=(n-t)/s+4}o/=6}return{h:o,s:c,l:l}}function rt(n,t,r){function h(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var e,o,s,u,f;return n=i(n,360),t=i(t,100),r=i(r,100),t===0?e=o=s=r:(u=r<.5?r*(1+t):r+t-r*t,f=2*r-u,e=h(f,u,n+1/3),o=h(f,u,n),s=h(f,u,n-1/3)),{r:e*255,g:o*255,b:s*255}}function y(n,t,f){n=i(n,255);t=i(t,255);f=i(f,255);var e=u(n,t,f),h=r(n,t,f),o,c,l=e,s=e-h;if(c=e===0?0:s/e,e==h)o=0;else{switch(e){case n:o=(t-f)/s+(t<f?6:0);break;case t:o=(f-n)/s+2;break;case f:o=(n-t)/s+4}o/=6}return{h:o,s:c,v:l}}function ut(n,t,r){n=i(n,360)*6;t=i(t,100);r=i(r,100);var h=s.floor(n),c=n-h,u=r*(1-t),f=r*(1-c*t),e=r*(1-(1-c)*t),o=h%6,l=[r,f,u,u,e,r][o],a=[e,r,r,f,u,u][o],v=[u,u,e,r,r,f][o];return{r:l*255,g:a*255,b:v*255}}function p(n,i,r,u){var f=[o(t(n).toString(16)),o(t(i).toString(16)),o(t(r).toString(16))];return u&&f[0].charAt(0)==f[0].charAt(1)&&f[1].charAt(0)==f[1].charAt(1)&&f[2].charAt(0)==f[2].charAt(1)?f[0].charAt(0)+f[1].charAt(0)+f[2].charAt(0):f.join("")}function w(n,i,r,u){var f=[o(ni(u)),o(t(n).toString(16)),o(t(i).toString(16)),o(t(r).toString(16))];return f.join("")}function ft(t,i){i=i===0?0:i||10;var r=n(t).toHsl();return r.s-=i/100,r.s=l(r.s),n(r)}function et(t,i){i=i===0?0:i||10;var r=n(t).toHsl();return r.s+=i/100,r.s=l(r.s),n(r)}function ot(t){return n(t).desaturate(100)}function st(t,i){i=i===0?0:i||10;var r=n(t).toHsl();return r.l+=i/100,r.l=l(r.l),n(r)}function ht(i,f){f=f===0?0:f||10;var e=n(i).toRgb();return e.r=u(0,r(255,e.r-t(255*-(f/100)))),e.g=u(0,r(255,e.g-t(255*-(f/100)))),e.b=u(0,r(255,e.b-t(255*-(f/100)))),n(e)}function ct(t,i){i=i===0?0:i||10;var r=n(t).toHsl();return r.l-=i/100,r.l=l(r.l),n(r)}function lt(i,r){var u=n(i).toHsl(),f=(t(u.h)+r)%360;return u.h=f<0?360+f:f,n(u)}function at(t){var i=n(t).toHsl();return i.h=(i.h+180)%360,n(i)}function vt(t){var i=n(t).toHsl(),r=i.h;return[n(t),n({h:(r+120)%360,s:i.s,l:i.l}),n({h:(r+240)%360,s:i.s,l:i.l})]}function yt(t){var i=n(t).toHsl(),r=i.h;return[n(t),n({h:(r+90)%360,s:i.s,l:i.l}),n({h:(r+180)%360,s:i.s,l:i.l}),n({h:(r+270)%360,s:i.s,l:i.l})]}function pt(t){var i=n(t).toHsl(),r=i.h;return[n(t),n({h:(r+72)%360,s:i.s,l:i.l}),n({h:(r+216)%360,s:i.s,l:i.l})]}function wt(t,i,r){i=i||6;r=r||30;var u=n(t).toHsl(),f=360/r,e=[n(t)];for(u.h=(u.h-(f*i>>1)+720)%360;--i;)u.h=(u.h+f)%360,e.push(n(u));return e}function bt(t,i){i=i||6;for(var r=n(t).toHsv(),e=r.h,o=r.s,u=r.v,f=[],s=1/i;i--;)f.push(n({h:e,s:o,v:u})),u=(u+s)%1;return f}function kt(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[n[t]]=t);return i}function k(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function i(n,t){dt(n)&&(n="100%");var i=gt(n);return(n=r(t,u(0,parseFloat(n))),i&&(n=parseInt(n*t,10)/100),s.abs(n-t)<1e-6)?1:n%t/parseFloat(t)}function l(n){return r(1,u(0,n))}function f(n){return parseInt(n,16)}function dt(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function gt(n){return typeof n=="string"&&n.indexOf("%")!=-1}function o(n){return n.length==1?"0"+n:""+n}function h(n){return n<=1&&(n=n*100+"%"),n}function ni(n){return Math.round(parseFloat(n)*255).toString(16)}function ti(n){return f(n)/255}function ii(n){var i,t;if(n=n.replace(d,"").replace(g,"").toLowerCase(),i=!1,c[n])n=c[n],i=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(t=e.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=e.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=e.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=e.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=e.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=e.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=e.hex8.exec(n))?{a:ti(t[1]),r:f(t[2]),g:f(t[3]),b:f(t[4]),format:i?"name":"hex8"}:(t=e.hex6.exec(n))?{r:f(t[1]),g:f(t[2]),b:f(t[3]),format:i?"name":"hex"}:(t=e.hex3.exec(n))?{r:f(t[1]+""+t[1]),g:f(t[2]+""+t[2]),b:f(t[3]+""+t[3]),format:i?"name":"hex"}:!1}var d=/^[\s,#]+/,g=/\s+$/,nt=0,s=Math,t=s.round,r=s.min,u=s.max,a=s.random,n=function(i,r){if(i=i?i:"",r=r||{},i instanceof n)return i;if(!(this instanceof n))return new n(i,r);var u=tt(i);this._originalInput=i;this._r=u.r;this._g=u.g;this._b=u.b;this._a=u.a;this._roundA=t(100*this._a)/100;this._format=r.format||u.format;this._gradientType=r.gradientType;this._r<1&&(this._r=t(this._r));this._g<1&&(this._g=t(this._g));this._b<1&&(this._b=t(this._b));this._ok=u.ok;this._tc_id=nt++},c,b,e;n.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var n=this.toRgb();return(n.r*299+n.g*587+n.b*114)/1e3},setAlpha:function(n){return this._a=k(n),this._roundA=t(100*this._a)/100,this},toHsv:function(){var n=y(this._r,this._g,this._b);return{h:n.h*360,s:n.s,v:n.v,a:this._a}},toHsvString:function(){var n=y(this._r,this._g,this._b),i=t(n.h*360),r=t(n.s*100),u=t(n.v*100);return this._a==1?"hsv("+i+", "+r+"%, "+u+"%)":"hsva("+i+", "+r+"%, "+u+"%, "+this._roundA+")"},toHsl:function(){var n=v(this._r,this._g,this._b);return{h:n.h*360,s:n.s,l:n.l,a:this._a}},toHslString:function(){var n=v(this._r,this._g,this._b),i=t(n.h*360),r=t(n.s*100),u=t(n.l*100);return this._a==1?"hsl("+i+", "+r+"%, "+u+"%)":"hsla("+i+", "+r+"%, "+u+"%, "+this._roundA+")"},toHex:function(n){return p(this._r,this._g,this._b,n)},toHexString:function(n){return"#"+this.toHex(n)},toHex8:function(){return w(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:t(this._r),g:t(this._g),b:t(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+t(this._r)+", "+t(this._g)+", "+t(this._b)+")":"rgba("+t(this._r)+", "+t(this._g)+", "+t(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:t(i(this._r,255)*100)+"%",g:t(i(this._g,255)*100)+"%",b:t(i(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+t(i(this._r,255)*100)+"%, "+t(i(this._g,255)*100)+"%, "+t(i(this._b,255)*100)+"%)":"rgba("+t(i(this._r,255)*100)+"%, "+t(i(this._g,255)*100)+"%, "+t(i(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:b[p(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var i="#"+w(this._r,this._g,this._b,this._a),r=i,f=this._gradientType?"GradientType = 1, ":"",u;return t&&(u=n(t),r=u.toHex8String()),"progid:DXImageTransform.Microsoft.gradient("+f+"startColorstr="+i+",endColorstr="+r+")"},toString:function(n){var i=!!n;n=n||this._format;var t=!1,r=this._a<1&&this._a>=0,u=!i&&r&&(n==="hex"||n==="hex6"||n==="hex3"||n==="name");return u?n==="name"&&this._a===0?this.toName():this.toRgbString():(n==="rgb"&&(t=this.toRgbString()),n==="prgb"&&(t=this.toPercentageRgbString()),(n==="hex"||n==="hex6")&&(t=this.toHexString()),n==="hex3"&&(t=this.toHexString(!0)),n==="hex8"&&(t=this.toHex8String()),n==="name"&&(t=this.toName()),n==="hsl"&&(t=this.toHslString()),n==="hsv"&&(t=this.toHsvString()),t||this.toHexString())},_applyModification:function(n,t){var i=n.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(st,arguments)},brighten:function(){return this._applyModification(ht,arguments)},darken:function(){return this._applyModification(ct,arguments)},desaturate:function(){return this._applyModification(ft,arguments)},saturate:function(){return this._applyModification(et,arguments)},greyscale:function(){return this._applyModification(ot,arguments)},spin:function(){return this._applyModification(lt,arguments)},_applyCombination:function(n,t){return n.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(wt,arguments)},complement:function(){return this._applyCombination(at,arguments)},monochromatic:function(){return this._applyCombination(bt,arguments)},splitcomplement:function(){return this._applyCombination(pt,arguments)},triad:function(){return this._applyCombination(vt,arguments)},tetrad:function(){return this._applyCombination(yt,arguments)}};n.fromRatio=function(t,i){var u,r;if(typeof t=="object"){u={};for(r in t)t.hasOwnProperty(r)&&(u[r]=r==="a"?t[r]:h(t[r]));t=u}return n(t,i)};n.equals=function(t,i){return!t||!i?!1:n(t).toRgbString()==n(i).toRgbString()};n.random=function(){return n.fromRatio({r:a(),g:a(),b:a()})};n.mix=function(t,i,r){var s,l;r=r===0?0:r||50;var f=n(t).toRgb(),e=n(i).toRgb(),h=r/100,o=h*2-1,c=e.a-f.a,u;return u=o*c==-1?o:(o+c)/(1+o*c),u=(u+1)/2,s=1-u,l={r:e.r*u+f.r*s,g:e.g*u+f.g*s,b:e.b*u+f.b*s,a:e.a*h+f.a*(1-h)},n(l)};n.readability=function(t,i){var f=n(t),e=n(i),r=f.toRgb(),u=e.toRgb(),o=f.getBrightness(),s=e.getBrightness(),h=Math.max(r.r,u.r)-Math.min(r.r,u.r)+Math.max(r.g,u.g)-Math.min(r.g,u.g)+Math.max(r.b,u.b)-Math.min(r.b,u.b);return{brightness:Math.abs(o-s),color:h}};n.isReadable=function(t,i){var r=n.readability(t,i);return r.brightness>125&&r.color>500};n.mostReadable=function(t,i){for(var h=null,o=0,r=!1,u=0;u<i.length;u++){var f=n.readability(t,i[u]),e=f.brightness>125&&f.color>500,s=3*(f.brightness/125)+f.color/500;(e&&!r||e&&r&&s>o||!e&&!r&&s>o)&&(r=e,o=s,h=n(i[u]))}return h};c=n.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};b=n.hexNames=kt(c);e=function(){var n="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+t),hsva:new RegExp("hsva"+i),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=n}();n(function(){n.fn.spectrum.load&&n.fn.spectrum.processNativeColorInputs()})}),function(n){window.RacadTextBuilder={version:"0.0.1",canvas:undefined,settings:{unique_id:"",template_id:0,font_library:[],font_family_list:["Arial","Calibri","Times New Roman","Comic Sans MS","French Script MT"],handler_file:"",local_font_path:"",use_local_fonts:!1,load_default_fonts:!0,default_fonts_api:"https://draw.racadtech.com/api/font",default_message:"Enter Your Text",output_path:""},handler_actions:{save:"text_builder_save",load:"text_builder_load",load_fonts:"text_builder_load_fonts",load_fonts_css:"text_builder_load_fonts_css"},save:function(){let t=RacadTextBuilder.canvas.toJSON(["width","height"]);for(let n=0;n<t.objects.length;n++){let i=t.objects[n];for(let n in i)i[n]||(i[n]=0)}let i=[];RacadTextBuilder.canvas.getObjects().forEach(function(n){i.push(n)});let r=new fabric.Group(i),u=r.toDataURL();n.ajax({method:"POST",dataType:"json",url:RacadTextBuilder.settings.handler_file,data:{action:RacadTextBuilder.handler_actions.save,data:t,preview:u,output_path:RacadTextBuilder.settings.output_path,unique_id:RacadTextBuilder.settings.unique_id},success:function(t){n('[data-udrawTextBuilder="textBuilder"]').trigger({type:"json_saved",response:t})},error:function(n){console.error(n)}})},load:function(t){n.ajax({method:"POST",dataType:"json",url:RacadTextBuilder.settings.handler_file,data:{action:RacadTextBuilder.handler_actions.load,template_id:RacadTextBuilder.settings.template_id,unique_id:RacadTextBuilder.settings.unique_id},success:function(i){i.width&&i.width.length&&RacadTextBuilder.canvas.setWidth(i.width);i.height&&i.height.length&&RacadTextBuilder.canvas.setHeight(i.height);i.objects&&(i.objects.forEach(function(n){for(let t in n){let i=parseFloat(n[t]);isNaN(i)||(n[t]=i)}n.transformMatrix||(n.transformMatrix=null)}),RacadTextBuilder.canvas.loadFromJSON(i,function(){RacadTextBuilder.canvas.getObjects().forEach(function(n){if(n.id=RacadTextBuilder.generate_id(),n.setCoords(),n.is_text())n.on("selected",function(){RacadTextBuilder.updateTextUI()});RacadTextBuilder.Layers.add(n)});RacadTextBuilder.canvas.renderAll();console.log("Loaded Saved Design.");n('[data-udrawTextBuilder="textBuilder"]').trigger({type:"json_loaded"});typeof t=="function"&&t();return}));typeof t=="function"&&t()},error:function(n){console.error(n)}})},load_fonts:function(t){let r=n('[data-udrawTextBuilder="font_family"]'),i=RacadTextBuilder.settings,u=RacadTextBuilder.handler_actions;for(let t=0;t<i.font_family_list.length;t++){let u=i.font_family_list[t],f=n("<option><\/option>").val(u).html(u).css("font-family",u);r.append(f)}i.use_local_fonts?n.getJSON(i.handler_file+"?action="+u.load_fonts+"&local_fonts_path="+i.local_font_path,function(f){for(let n=0;n<f.length;n++){let t={name:f[n].name,path:f[n].path};i.font_library.push(t)}for(let t=0;t<i.font_library.length;t++){let u=i.font_library[t].name,f=n("<option><\/option>").val(u).html(u).css("font-family",u);r.append(f);i.font_family_list.indexOf(u)===-1&&i.font_family_list.push(u)}let e=[];for(let n=0;n<i.font_library.length;n++)e.push(`'${i.font_library[n].name}'`);WebFont.load({custom:{families:e,urls:[i.handler_file+"?action="+u.load_fonts_css+"&local_fonts_path="+i.local_font_path]},loading:function(){},active:function(){console.log("loaded local fonts");typeof t=="function"&&t()},inactive:function(){},fontloading:function(){},fontactive:function(){},fontinactive:function(){}})}):n.getJSON(i.default_fonts_api,function(u){if(i.load_default_fonts)for(let n=0;n<u.length;n++){let t={name:u[n].Fontname,path:u[n].TTFLocation};i.font_library.push(t)}for(let t=0;t<i.font_library.length;t++){let u=i.font_library[t].name,f=n("<option><\/option>").val(u).html(u).css("font-family",u);r.append(f);i.font_family_list.indexOf(u)===-1&&i.font_family_list.push(u)}let f=[];for(let n=0;n<i.font_library.length;n++)f.push(`'${i.font_library[n].name}'`);WebFont.load({custom:{families:f,urls:["https://draw.racadtech.com/service/css/default"]},loading:function(){},active:function(){console.log("Loaded default fonts");typeof t=="function"&&t()},inactive:function(){},fontloading:function(){},fontactive:function(){},fontinactive:function(){}})});n('[data-udrawTextBuilder="font_family"]').select2({width:"100%",templateSelection:function(t){return n(`<span style="font-family:${t.text};">${t.text}</span>`)},templateResult:function(t){return n(`<span style="font-family:${t.text};">${t.text}</span>`)}})},init:function(){n('[data-udrawTextBuilder="loading_overlay"]').addClass("active");let t="racadTextBuilderCanvas";n('[data-udrawTextBuilder="canvas"]').attr("id")?t=n('[data-udrawTextBuilder="canvas"]').attr("id"):n('[data-udrawTextBuilder="canvas"]').attr("id",t);RacadTextBuilder.canvas=new fabric.Canvas(t,{renderOnAddRemove:!1});n("div.textbuilder_modal").modal({backdrop:!1,show:!1}).draggable({stop:function(){RacadTextBuilder.handle_modal_boundaries(n(this))}});fabric.Object.prototype.setControlVisible("mtr",!1);fabric.Object.prototype.is_text=function(){return this.type==="i-text"||this.type==="text"||this.type==="textbox"?!0:!1};fabric.Object.prototype.lock=function(){this.get("is_locked")?this.set({hasControls:!0,lockMovementX:!1,lockMovementY:!1,is_locked:!1}):this.set({hasControls:!1,lockMovementX:!0,lockMovementY:!0,is_locked:!0})};n('[data-udrawTextBuilder="colourpicker"]').spectrum({preferredFormat:"rgb",showInput:!0,showAlpha:!0,showButtons:!1,move:function(n){let i=n.toRgbString(),t=RacadTextBuilder.canvas.getActiveObject();t&&(t.set("fill",i),RacadTextBuilder.canvas.renderAll())}});n('[data-udrawTextBuilder="stroke_colourpicker"]').spectrum({preferredFormat:"rgb",showInput:!0,showAlpha:!0,showButtons:!1,move:function(n){let i=n.toRgbString(),t=RacadTextBuilder.canvas.getActiveObject();t&&(t.set("stroke",i),RacadTextBuilder.canvas.renderAll())}});RacadTextBuilder.load_fonts(function(){n('[data-udrawTextBuilder="layers_modal"]').modal("show");RacadTextBuilder.settings.template_id&&RacadTextBuilder.settings.unique_id.length>0?RacadTextBuilder.load(function(){n('[data-udrawTextBuilder="textBuilder"]').trigger({type:"builder_loaded"})}):n('[data-udrawTextBuilder="textBuilder"]').trigger({type:"builder_loaded"})})},generate_id:function(){let n=Math.floor(Math.random()*1e4),t=!1;return(RacadTextBuilder.canvas.getObjects().forEach(function(i){if(i.id===n){t=!0;return}}),t)?RacadTextBuilder.generate_id():n},get_object:function(n){let t=null;return n&&RacadTextBuilder.canvas.getObjects().forEach(function(i){if(i.id===parseInt(n)){t=i;return}}),t},remove_object:function(t){t&&(RacadTextBuilder.canvas.remove(t),RacadTextBuilder.canvas.renderAll(),n(`[data-udrawTextBuilder="layers_list"] li[data-id="${t.id}"]`).remove())},handle_modal_boundaries:function(t){let i=n('[data-udrawtextbuilder="textBuilder"]'),r=i.offset().left,u=i.offset().top,f=i.height()+u,e=i.width()+r,o=t.offset().left,s=t.offset().top,h=t.height()+s,c=t.width()+o;o<=r&&t.css("left",r+1);s<=u&&t.css("top",u+1);h>=f&&t.css("top",f-t.height()-1);c>=e&&t.css("left",e-t.width()-1)},addText:function(t){let u=n('[data-udrawtextbuilder="font_family"]').val()||"Arial",f=parseFloat(n('[data-udrawtextbuilder="fontSize"]').val())||12,e=parseFloat(n('[data-udrawtextbuilder="lineHeight"]').val())||1,o=parseFloat(n('[data-udrawtextbuilder="charSpacing"]').val())*100||0,r={fontFamily:u,fontSize:f,lineHeight:e,charSpacing:o};if(t){let n={textAlign:"center",fontStyle:"normal",strokeWidth:0,lineHeight:1,curvedText:!0,radius:25,spacing:1,reverse:!1,lockScalingFlip:!0};for(let t in n)r[t]||(r[t]=n[t])}let i;t?(i=new fabric.Text(RacadTextBuilder.settings.default_message,r),i.hasControls=!1):i=new fabric.Textbox(RacadTextBuilder.settings.default_message,r);i.id=RacadTextBuilder.generate_id();i.is_locked=!1;RacadTextBuilder.canvas.setActiveObject(i);RacadTextBuilder.canvas.add(i);RacadTextBuilder.canvas.renderAll();i.on("selected",function(){RacadTextBuilder.updateTextUI()});RacadTextBuilder.Layers.add(i);n('[data-udrawTextBuilder="textBuilder"]').trigger({type:"text-added",object:i})},updateTextUI:function(){let t=RacadTextBuilder.canvas.getActiveObject();if(t&&t.is_text()){let r=t.get("fontFamily"),u=t.get("fontSize"),f=t.get("lineHeight"),i=t.get("charSpacing")===0?0:t.get("charSpacing")/100;if(t.curvedText&&(i=t.get("spacing")),n('[data-udrawTextBuilder="font_family"]').val(r).trigger("change"),n('[data-udrawTextBuilder="fontSize"]').val(u),n('[data-udrawTextBuilder="lineHeight"]').val(f),n('[data-udrawTextBuilder="charSpacing"]').val(i),n('[data-udrawTextBuilder="text"]').val(t.text),t.curvedText){let i=t.get("radius"),r=t.get("reverse");n('[data-udrawTextBuilder="radius"]').val(i);r?n('[data-udrawTextBuilder="flip_curve"]').addClass("active"):n('[data-udrawTextBuilder="flip_curve"]').removeClass("active");n('[data-udrawTextBuilder="text_editor"] div.curvedText').show()}else n('[data-udrawTextBuilder="text_editor"] div.curvedText').hide();let e=t.get("fill"),o=t.get("stroke")||"rgba(0,0,0,1)",s=t.get("strokeWidth");n('[data-udrawtextbuilder="colourpicker"]').spectrum("set",e);n('[data-udrawtextbuilder="stroke_colourpicker"]').spectrum("set",o);n('[data-udrawTextBuilder="stroke_width"]').val(s);n('[data-udrawTextBuilder="text_editor"]').modal("show")}else n('[data-udrawTextBuilder="text_editor"]').modal("hide")}};RacadTextBuilder.Layers={add:function(t){let i=n("<img />").addClass("layer_preview"),r=n("<a><\/a>").attr({href:"#","data-id":t.id}).addClass("delete").append('<i class="far fa-trash-alt"><\/i>').on("click",function(){let i=n(this).attr("data-id"),t=RacadTextBuilder.get_object(i);t&&window.confirm("Are you sure you want to delete this object?")&&RacadTextBuilder.remove_object(t)}),u=n("<a><\/a>").attr({href:"#","data-id":t.id}).append('<i class="fas fa-lock"><\/i>').on("click",function(){let i=n(this).attr("data-id"),t=RacadTextBuilder.get_object(i);t&&(t.lock(),RacadTextBuilder.canvas.renderAll(),t.get("is_locked")?(n(".fa-lock",this).removeClass("fa-lock").addClass("fa-unlock"),n(this).addClass("active")):(n(".fa-unlock",this).removeClass("fa-unlock").addClass("fa-lock"),n(this).removeClass("active")))}),f=n("<div><\/div>").append(u,r).addClass("layers_btn_container"),e=n("<li><\/li>").attr({"data-id":t.id}).addClass("layer").append(i,f);n('[data-udrawTextBuilder="layers_list"]').prepend(e);RacadTextBuilder.Layers.update_preview(t)},update_preview:function(t){let i=n(`[data-udrawTextBuilder="layers_list"] li[data-id="${t.id}"]`);if(i){let r=t.toDataURL();n("img",i).attr("src",r)}}}}(window.jQuery);jQuery(document).ready(function(n){RacadTextBuilder.init();n('[data-udrawTextBuilder="textBuilder"]').on("text-added",function(){RacadTextBuilder.updateTextUI()});RacadTextBuilder.canvas.on("selection:cleared",function(){n('[data-udrawTextBuilder="text_editor"]').modal("hide")});n('[data-udrawTextBuilder="text"]').on("input propertychange",function(){let i=n(this).val(),t=RacadTextBuilder.canvas.getActiveObject();t&&t.is_text()&&(t.set("text",i),RacadTextBuilder.canvas.renderAll(),RacadTextBuilder.Layers.update_preview(t))});n('[data-udrawTextBuilder="text_editor"] [data-udrawtextbuilder="font_family"]').on("change",function(){let i=n(this).val();n(this).css("font-family",i);let t=RacadTextBuilder.canvas.getActiveObject();t&&t.is_text()&&(t.set("fontFamily",i),RacadTextBuilder.canvas.renderAll(),RacadTextBuilder.Layers.update_preview(t))});n('[data-udrawTextBuilder="text_editor"] input[type="number"]').on("input propertychange mousewheel",function(){let t=RacadTextBuilder.canvas.getActiveObject(),r=n(this).attr("data-udrawtextbuilder"),i=parseFloat(n(this).val());r==="charSpacing"&&(t.curvedText?r="spacing":i=i*100);t&&t.is_text()&&!isNaN(i)&&(t.set(r,i),RacadTextBuilder.canvas.renderAll(),RacadTextBuilder.Layers.update_preview(t))});n('[data-udrawTextBuilder="flip_curve"]').on("click",function(){let t=RacadTextBuilder.canvas.getActiveObject();t&&t.is_text()&&t.curvedText&&(t.set("reverse",!t.get("reverse")),t.get("reverse")?n(this).addClass("active"):n(this).removeClass("active"),RacadTextBuilder.canvas.renderAll())});n('[data-udrawTextBuilder="delete"]').on("click",function(){let n=RacadTextBuilder.canvas.getActiveObject();n&&window.confirm("Are you sure you want to delete this object?")&&RacadTextBuilder.remove_object(n)});n('[data-udrawTextBuilder="text_editor"] a.close').on("click",function(){let n=RacadTextBuilder.canvas.getActiveObject();n&&(RacadTextBuilder.canvas.discardActiveObject(),RacadTextBuilder.canvas.renderAll())});n("a.font_style_btn").on("click",function(){let i=n(this).attr("data-fontStyle"),t=RacadTextBuilder.canvas.getActiveObject();if(t){switch(i){case"bold":let n=t.get("fontWeight")==="bold"?"normal":"bold";t.set("fontWeight",n);break;case"italic":let i=t.get("fontStyle")==="italic"?"normal":"italic";t.set("fontStyle",i);break;case"underline":let r=t.get("underline")?!1:!0;t.set("underline",r);break;case"strikethrough":let u=t.get("linethrough")?!1:!0;t.set("linethrough",u)}RacadTextBuilder.canvas.renderAll();RacadTextBuilder.updateTextUI();RacadTextBuilder.Layers.update_preview(t)}});n("a.text_align").on("click",function(){let i=n(this).attr("data-align"),t=RacadTextBuilder.canvas.getActiveObject();t&&(t.set("textAlign",i),RacadTextBuilder.canvas.renderAll(),RacadTextBuilder.Layers.update_preview(t))});n("a.object_align").on("click",function(){let r=n(this).attr("data-align"),u=n(this).attr("data-orientation"),i=RacadTextBuilder.canvas,t=i.getActiveObject();if(t){if(u==="horizontal"){let n=0;switch(r){case"middle":n=(i.width-t.width)/2;break;case"right":n=i.width-t.width}t.set("left",n)}else if(u==="vertical"){let n=0;switch(r){case"middle":n=(i.height-t.height)/2;break;case"bottom":n=i.height-t.height}t.set("top",n)}t.setCoords();RacadTextBuilder.canvas.renderAll()}});n('[data-udrawtextbuilder="stroke_width"]').on("input propertychange mousewheel",function(){let i=parseFloat(n(this).val()),t=RacadTextBuilder.canvas.getActiveObject();t&&t.is_text()&&!isNaN(i)&&(t.set("strokeWidth",i),RacadTextBuilder.canvas.renderAll(),RacadTextBuilder.Layers.update_preview(t))});n("a.minimize").on("click",function(){let t=n(this).closest("div.textbuilder_modal");t.hasClass("minimized")?(n("div.modal-body, div.modal-footer",t).show(),t.removeClass("minimized")):(n("div.modal-body, div.modal-footer",t).hide(),t.addClass("minimized"))});n('[data-udrawTextBuilder="settings"]').on("click",function(){n('[data-udrawTextBuilder="document_width"]').val(RacadTextBuilder.canvas.width);n('[data-udrawTextBuilder="document_height"]').val(RacadTextBuilder.canvas.height);n('[data-udrawTextBuilder="settings_modal"]').modal("show")});n('[data-udrawTextBuilder="apply_settings"]').on("click",function(){n('[data-udrawTextBuilder="settings_modal"] small.error').each(function(){n(this).removeClass("active")});let t=parseFloat(n('[data-udrawTextBuilder="document_width"]').val()),i=parseFloat(n('[data-udrawTextBuilder="document_height"]').val());isNaN(t)||isNaN(i)?(isNaN(t)&&n('[data-udrawTextBuilder="settings_modal"] div.width small.error').addClass("active"),isNaN(i)&&n('[data-udrawTextBuilder="settings_modal"] div.height small.error').addClass("active")):(RacadTextBuilder.canvas.setWidth(t),RacadTextBuilder.canvas.setHeight(i),RacadTextBuilder.canvas.renderAll(),n('[data-udrawTextBuilder="settings_modal"]').modal("hide"))});n('[data-udrawTextBuilder="save"]').on("click",function(){RacadTextBuilder.save()});n(window).on("resize",function(){n("div.textbuilder_modal").each(function(){RacadTextBuilder.handle_modal_boundaries(n(this))})});window.addEventListener("keydown",function(t){if((t.keyCode===8||t.keyCode===46)&&!n("input, textarea").is(":focus")){t.preventDefault();let n=RacadTextBuilder.canvas.getActiveObjects();n.length>0&&(n.forEach(function(n){RacadTextBuilder.canvas.remove(n)}),RacadTextBuilder.canvas.discardActiveObject(n),RacadTextBuilder.canvas.renderAll())}});n('[data-udrawTextBuilder="textBuilder"]').on("builder_loaded",function(){n('[data-udrawTextBuilder="loading_overlay"]').removeClass("active")})});